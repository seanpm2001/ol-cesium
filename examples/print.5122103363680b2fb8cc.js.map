{"version":3,"file":"print.5122103363680b2fb8cc.js","mappings":"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","sources":["webpack://ol-cesium/webpack/runtime/chunk loaded","webpack://ol-cesium/./src/olcs/print/drawCesiumMask.ts","webpack://ol-cesium/./src/olcs/print/computeRectangle.ts","webpack://ol-cesium/./examples/print.js","webpack://ol-cesium/./src/olcs/print/takeCesiumScreenshot.ts","webpack://ol-cesium/webpack/bootstrap","webpack://ol-cesium/webpack/runtime/define property getters","webpack://ol-cesium/webpack/runtime/hasOwnProperty shorthand","webpack://ol-cesium/webpack/runtime/runtimeId","webpack://ol-cesium/webpack/runtime/jsonp chunk loading","webpack://ol-cesium/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","import type {Scene} from 'cesium';\n\nlet postUnlistener: Function = null;\n\ninterface ProgramInfo {\n  program: WebGLProgram,\n  attribLocations: {\n    vertexPosition: number\n  },\n  uniformLocations: {\n    uScaling: WebGLUniformLocation\n  }\n}\n\n/**\n *\n */\nexport function autoDrawMask(scene: Scene, getScalings: () => number[]) {\n  const canvas = scene.canvas;\n  const ctx = canvas.getContext(\"webgl2\") || canvas.getContext(\"webgl\");\n\n  if (getScalings) {\n    if (!postUnlistener) {\n      const drawer = new MaskDrawer(ctx);\n      postUnlistener = scene.postRender.addEventListener(() => {\n        drawer.drawMask(getScalings());\n      });\n    }\n  }\n  else if (postUnlistener) {\n    postUnlistener();\n    // FIXME: destroy program\n    postUnlistener = null;\n  }\n  scene.requestRender();\n}\n\n\n// CC0 from https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample2\n\n\nexport class MaskDrawer {\n  private programInfo: ProgramInfo;\n  private positionBuffer: WebGLBuffer;\n\n  constructor(private gl: WebGL2RenderingContext | WebGLRenderingContext) {\n    const shaderProgram = this.initShaderProgram();\n\n    this.programInfo = {\n      program: shaderProgram,\n      attribLocations: {\n        vertexPosition: gl.getAttribLocation(shaderProgram, \"aVertexPosition\")\n      },\n      uniformLocations: {\n        uScaling: gl.getUniformLocation(\n          shaderProgram,\n          \"uScaling\"\n        )\n      }\n    };\n\n    this.positionBuffer = gl.createBuffer();\n    const positions = [1.0, 1.0, -1.0, 1.0, 1.0, -1.0, -1.0, -1.0];\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n  }\n\n  getVertexShaderSource() {\n    return `\n      attribute vec4 aVertexPosition;\n      uniform vec2 uScaling;\n      void main() {\n        gl_Position = vec4(aVertexPosition[0] * uScaling[0], aVertexPosition[1] * uScaling[1], -1.0, 1.0);\n      }\n    `;\n  }\n\n  getFragmentShaderSource() {\n    return `\n      precision highp float;\n      void main() {\n        gl_FragColor = vec4(.5, .5, .5, .6);\n      }\n  `;\n  }\n\n  /**\n   *\n   */\n  private initShaderProgram(): WebGLProgram {\n    const gl = this.gl;\n    const vsSource = this.getVertexShaderSource();\n    const fsSource = this.getFragmentShaderSource();\n    const vertexShader = MaskDrawer.loadShader(gl, gl.VERTEX_SHADER, vsSource),\n      fragmentShader = MaskDrawer.loadShader(gl, gl.FRAGMENT_SHADER, fsSource),\n      shaderProgram = gl.createProgram();\n\n    gl.attachShader(shaderProgram, vertexShader);\n    gl.attachShader(shaderProgram, fragmentShader);\n    gl.linkProgram(shaderProgram);\n\n    // If creating the shader program failed, alert\n\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n      throw new Error(\n        `Unable to initialize the shader program: ${gl.getProgramInfoLog(\n          shaderProgram\n        )}`\n      );\n    }\n\n    return shaderProgram;\n  }\n\n\n  /**\n   *\n   * @param {number[]} scaling scaling\n   */\n  drawMask(scaling: number[]) {\n    const gl = this.gl;\n    const programInfo = this.programInfo;\n    // Blend\n    gl.enable(gl.BLEND);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer);\n    gl.vertexAttribPointer(\n      programInfo.attribLocations.vertexPosition,\n      2,\n      gl.FLOAT,\n      false,\n      0,\n      0\n    );\n    gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);\n    gl.useProgram(programInfo.program);\n\n\n    // Draw a first time to fill the stencil area while keeping the destination color\n    gl.enable(gl.STENCIL_TEST);\n    gl.stencilFunc(\n      gl.ALWAYS,\n      1,\n      0xFF\n    );\n    gl.stencilOp(\n      gl.KEEP,\n      gl.KEEP,\n      gl.REPLACE\n    );\n    gl.uniform2fv(\n      programInfo.uniformLocations.uScaling,\n      scaling\n    );\n    gl.blendFunc(gl.ZERO, gl.ONE);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n\n\n    // Now draw again the whole viewport and darken the pixels that are not on the stencil\n    gl.stencilFunc(\n      gl.EQUAL,\n      0,\n      0xFF\n    );\n    gl.stencilOp(\n      gl.KEEP,\n      gl.KEEP,\n      gl.KEEP\n    );\n    gl.uniform2fv(\n      programInfo.uniformLocations.uScaling,\n      [1, 1]\n    );\n    gl.blendFunc(gl.ZERO, gl.SRC_ALPHA);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n\n\n  /**\n   */\n  private static loadShader(gl: WebGL2RenderingContext | WebGLRenderingContext, type: number, source: string): WebGLShader {\n    const shader = gl.createShader(type);\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        `An error occurred compiling the shaders: ${gl.getShaderInfoLog(shader)}`\n      );\n      // gl.deleteShader(shader);\n    }\n\n    return shader;\n  }\n}\n","export interface RectangleOutput {\n  scaling: [number, number];\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\nexport function computeRectangle(canvas: HTMLCanvasElement, tw: number, th: number): RectangleOutput {\n\n  const maskAspectRatio = tw / th;\n  let maskSize;\n\n  if (maskAspectRatio > 1) {\n    // landscape\n    maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    if (maskSize[1] > canvas.height) {\n      maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    }\n  }\n  else {\n    // portrait\n    maskSize = [canvas.height * maskAspectRatio, canvas.height];\n    if (maskSize[0] > canvas.width) {\n      maskSize = [canvas.width, canvas.width / maskAspectRatio];\n    }\n  }\n\n  return {\n    scaling: [maskSize[0] / canvas.width, maskSize[1] / canvas.height],\n    width: maskSize[0],\n    height: maskSize[1],\n    offsetX: (canvas.width - maskSize[0]) / 2,\n    offsetY: (canvas.height - maskSize[1]) / 2,\n  };\n}\n","/**\n * @module examples.print\n */\nimport OLCesium from 'olcs/OLCesium.ts';\nimport {transform} from 'ol/proj.js';\nimport olView from 'ol/View.js';\nimport {defaults as olControlDefaults} from 'ol/control.js';\nimport olSourceOSM from 'ol/source/OSM.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olMap from 'ol/Map.js';\nimport {OLCS_ION_TOKEN} from './_common.js';\nimport {takeScreenshot} from 'olcs/print/takeCesiumScreenshot.ts';\nimport {autoDrawMask} from 'olcs/print/drawCesiumMask.ts';\nimport {computeRectangle} from 'olcs/print/computeRectangle.ts';\n\nCesium.Ion.defaultAccessToken = OLCS_ION_TOKEN;\nconst ol2d = new olMap({\n  layers: [\n    new olLayerTile({\n      source: new olSourceOSM()\n    })\n  ],\n  controls: olControlDefaults({\n    attributionOptions: {\n      collapsible: false\n    }\n  }),\n  target: 'map',\n  view: new olView({\n    center: transform([25, 20], 'EPSG:4326', 'EPSG:3857'),\n    zoom: 3\n  })\n});\n\nconst ol3d = new OLCesium({\n  map: ol2d,\n});\nconst scene = ol3d.getCesiumScene();\nCesium.createWorldTerrainAsync().then(tp => scene.terrainProvider = tp);\nol3d.setEnabled(true);\n\n\ndocument.getElementById('enable').addEventListener('click', () => ol3d.setEnabled(!ol3d.getEnabled()));\ndocument.getElementById('printScale').addEventListener('change', evt => scaleGlobe(Number.parseFloat(evt.target.value)));\n\nfunction scalingOptions() {\n  const printValue = document.querySelector('#printValue').value;\n  const canvas = scene.canvas;\n  const v = Math.min(canvas.width, canvas.height);\n  switch (printValue) {\n    case 'portrait':\n      return computeRectangle(canvas, v / 4, v / 2);\n    default:\n      return computeRectangle(canvas, v / 2, v / 4);\n  }\n}\nautoDrawMask(scene, () => scalingOptions().scaling);\n\nfunction scaleGlobe(value) {\n  /**\n   * @type {HTMLCanvasElement}\n   */\n  const canvas = scene.canvas;\n  const currentScale = canvas.width / canvas.clientWidth;\n  if (Math.abs(currentScale - value) < 0.01) {\n    return;\n  }\n  canvas.width = canvas.clientWidth * value;\n  canvas.height = canvas.clientHeight * value;\n}\n\nwindow['takeScreenshot'] = async function() {\n  const r = scalingOptions();\n  console.log(r);\n  const value = await takeScreenshot(scene, r);\n  const img = new Image();\n  /**\n   * @type {HTMLCanvasElement}\n   */\n  const canvas = scene.canvas;\n  img.src = value;\n  img.width = r.width / (canvas.width / canvas.clientWidth);\n  img.height = r.height / (canvas.height / canvas.clientHeight);\n  document.body.append(img);\n};\n","import type {Scene} from 'cesium';\n\ninterface ScreenshotOptions {\n  offsetX: number;\n  offsetY: number;\n  width: number;\n  height: number;\n}\n\n/**\n */\nexport function takeScreenshot(scene: Scene, options: ScreenshotOptions): Promise<string> {\n  return new Promise((resolve, reject) => {\n  // preserveDrawingBuffers is false so we render on demand and immediately read the buffer\n      const remover = scene.postRender.addEventListener(() => {\n          remover();\n          try {\n              let url;\n\n              if (options) {\n                  const smallerCanvas = document.createElement(\"canvas\");\n\n                  smallerCanvas.width = options.width;\n                  smallerCanvas.height = options.height;\n                  smallerCanvas.getContext(\"2d\").drawImage(\n                      scene.canvas,\n                      options.offsetX, options.offsetY, options.width, options.height,\n                      0, 0, options.width, options.height);\n                  url = smallerCanvas.toDataURL();\n              }\n              else {\n                  url = scene.canvas.toDataURL();\n              }\n              resolve(url);\n          }\n          catch (e) {\n              reject(e);\n          }\n      });\n\n      scene.requestRender();\n  });\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.j = 740;","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t740: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkol_cesium\"] = self[\"webpackChunkol_cesium\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [351], () => (__webpack_require__(7911)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","postUnlistener","MaskDrawer","constructor","gl","shaderProgram","this","initShaderProgram","programInfo","program","attribLocations","vertexPosition","getAttribLocation","uniformLocations","uScaling","getUniformLocation","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","getVertexShaderSource","getFragmentShaderSource","vsSource","fsSource","vertexShader","loadShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","Error","getProgramInfoLog","drawMask","scaling","enable","BLEND","vertexAttribPointer","FLOAT","enableVertexAttribArray","useProgram","STENCIL_TEST","stencilFunc","ALWAYS","stencilOp","KEEP","REPLACE","uniform2fv","blendFunc","ZERO","ONE","drawArrays","TRIANGLE_STRIP","EQUAL","SRC_ALPHA","type","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","computeRectangle","canvas","tw","th","maskAspectRatio","maskSize","width","height","offsetX","offsetY","Cesium","Ion","defaultAccessToken","ol2d","layers","controls","attributionOptions","collapsible","target","view","center","zoom","ol3d","OLCesium","map","scene","getCesiumScene","scalingOptions","printValue","document","querySelector","value","v","Math","min","createWorldTerrainAsync","then","tp","terrainProvider","setEnabled","getElementById","addEventListener","getEnabled","evt","currentScale","clientWidth","abs","clientHeight","scaleGlobe","Number","parseFloat","getScalings","ctx","getContext","drawer","postRender","requestRender","autoDrawMask","window","async","r","options","Promise","resolve","reject","remover","url","smallerCanvas","createElement","drawImage","toDataURL","e","takeScreenshot","img","Image","src","body","append","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call","m","O","result","chunkIds","fn","priority","notFulfilled","Infinity","i","length","fulfilled","j","Object","keys","every","key","splice","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","data","moreModules","runtime","some","id","chunkLoadingGlobal","self","forEach","bind","push","__webpack_exports__"],"sourceRoot":""}