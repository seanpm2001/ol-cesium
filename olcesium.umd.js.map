{"version":3,"file":"olcesium.umd.js","mappings":"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","sources":["webpack://olcs/webpack/universalModuleDefinition","webpack://olcs/external umd \"ol/Observable.js\"","webpack://olcs/external umd \"ol/Overlay.js\"","webpack://olcs/external umd \"ol/easing.js\"","webpack://olcs/external umd \"ol/extent.js\"","webpack://olcs/external umd \"ol/format/MVT.js\"","webpack://olcs/external umd \"ol/geom/Geometry.js\"","webpack://olcs/external umd \"ol/geom/Point.js\"","webpack://olcs/external umd \"ol/geom/Polygon.js\"","webpack://olcs/external umd \"ol/geom/SimpleGeometry.js\"","webpack://olcs/external umd \"ol/layer/BaseVector.js\"","webpack://olcs/external umd \"ol/layer/Group.js\"","webpack://olcs/external umd \"ol/layer/Image.js\"","webpack://olcs/external umd \"ol/layer/Layer.js\"","webpack://olcs/external umd \"ol/layer/Tile.js\"","webpack://olcs/external umd \"ol/layer/Vector.js\"","webpack://olcs/external umd \"ol/layer/VectorTile.js\"","webpack://olcs/external umd \"ol/proj.js\"","webpack://olcs/external umd \"ol/render.js\"","webpack://olcs/external umd \"ol/source.js\"","webpack://olcs/external umd \"ol/source/Cluster.js\"","webpack://olcs/external umd \"ol/source/Image.js\"","webpack://olcs/external umd \"ol/source/ImageStatic.js\"","webpack://olcs/external umd \"ol/source/ImageWMS.js\"","webpack://olcs/external umd \"ol/source/TileImage.js\"","webpack://olcs/external umd \"ol/source/TileWMS.js\"","webpack://olcs/external umd \"ol/source/Vector.js\"","webpack://olcs/external umd \"ol/source/VectorTile.js\"","webpack://olcs/external umd \"ol/structs/LRUCache.js\"","webpack://olcs/external umd \"ol/style/Icon.js\"","webpack://olcs/external umd \"ol/style/Stroke.js\"","webpack://olcs/external umd \"ol/style/Style.js\"","webpack://olcs/external umd \"ol/tilegrid.js\"","webpack://olcs/external umd \"ol/tileurlfunction.js\"","webpack://olcs/external umd \"ol/util.js\"","webpack://olcs/webpack/bootstrap","webpack://olcs/webpack/runtime/compat get default export","webpack://olcs/webpack/runtime/define property getters","webpack://olcs/webpack/runtime/hasOwnProperty shorthand","webpack://olcs/webpack/runtime/make namespace object","webpack://olcs/./src/olcs/util.js","webpack://olcs/./src/olcs/core/OLImageryProvider.js","webpack://olcs/./src/olcs/MVTImageryProvider.js","webpack://olcs/./src/olcs/core.ts","webpack://olcs/./src/olcs/AutoRenderLoop.js","webpack://olcs/./src/olcs/math.js","webpack://olcs/./src/olcs/Camera.js","webpack://olcs/./src/olcs/AbstractSynchronizer.ts","webpack://olcs/./src/olcs/RasterSynchronizer.ts","webpack://olcs/./src/olcs/core/VectorLayerCounterpart.ts","webpack://olcs/./src/olcs/FeatureConverter.js","webpack://olcs/./src/olcs/VectorSynchronizer.ts","webpack://olcs/./src/olcs/SynchronizedOverlay.js","webpack://olcs/./src/olcs/OverlaySynchronizer.js","webpack://olcs/./src/olcs/OLCesium.ts","webpack://olcs/./src/olcs/contrib/LazyLoader.js","webpack://olcs/./src/olcs/contrib/Manager.js","webpack://olcs/./src/index.library.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"ol/geom/Point.js\"), require(\"ol/easing.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Image.js\"), require(\"ol/proj.js\"), require(\"ol/source/ImageStatic.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/VectorTile.js\"), require(\"ol/source/Image.js\"), require(\"ol/source.js\"), require(\"ol/format/MVT.js\"), require(\"ol/style/Style.js\"), require(\"ol/style/Stroke.js\"), require(\"ol/render.js\"), require(\"ol/util.js\"), require(\"ol/structs/LRUCache.js\"), require(\"ol/tilegrid.js\"), require(\"ol/tileurlfunction.js\"), require(\"ol/layer/VectorTile.js\"), require(\"ol/extent.js\"), require(\"ol/Observable.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/BaseVector.js\"), require(\"ol/source/Vector.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/geom/Geometry.js\"), require(\"ol/style/Icon.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/Overlay.js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"ol/geom/Point.js\", \"ol/easing.js\", \"ol/layer/Tile.js\", \"ol/layer/Image.js\", \"ol/proj.js\", \"ol/source/ImageStatic.js\", \"ol/source/ImageWMS.js\", \"ol/source/TileImage.js\", \"ol/source/TileWMS.js\", \"ol/source/VectorTile.js\", \"ol/source/Image.js\", \"ol/source.js\", \"ol/format/MVT.js\", \"ol/style/Style.js\", \"ol/style/Stroke.js\", \"ol/render.js\", \"ol/util.js\", \"ol/structs/LRUCache.js\", \"ol/tilegrid.js\", \"ol/tileurlfunction.js\", \"ol/layer/VectorTile.js\", \"ol/extent.js\", \"ol/Observable.js\", \"ol/layer/Group.js\", \"ol/layer/BaseVector.js\", \"ol/source/Vector.js\", \"ol/layer/Layer.js\", \"ol/source/Cluster.js\", \"ol/layer/Vector.js\", \"ol/geom/Geometry.js\", \"ol/style/Icon.js\", \"ol/geom/Polygon.js\", \"ol/geom/SimpleGeometry.js\", \"ol/Overlay.js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"olcs\"] = factory(require(\"ol/geom/Point.js\"), require(\"ol/easing.js\"), require(\"ol/layer/Tile.js\"), require(\"ol/layer/Image.js\"), require(\"ol/proj.js\"), require(\"ol/source/ImageStatic.js\"), require(\"ol/source/ImageWMS.js\"), require(\"ol/source/TileImage.js\"), require(\"ol/source/TileWMS.js\"), require(\"ol/source/VectorTile.js\"), require(\"ol/source/Image.js\"), require(\"ol/source.js\"), require(\"ol/format/MVT.js\"), require(\"ol/style/Style.js\"), require(\"ol/style/Stroke.js\"), require(\"ol/render.js\"), require(\"ol/util.js\"), require(\"ol/structs/LRUCache.js\"), require(\"ol/tilegrid.js\"), require(\"ol/tileurlfunction.js\"), require(\"ol/layer/VectorTile.js\"), require(\"ol/extent.js\"), require(\"ol/Observable.js\"), require(\"ol/layer/Group.js\"), require(\"ol/layer/BaseVector.js\"), require(\"ol/source/Vector.js\"), require(\"ol/layer/Layer.js\"), require(\"ol/source/Cluster.js\"), require(\"ol/layer/Vector.js\"), require(\"ol/geom/Geometry.js\"), require(\"ol/style/Icon.js\"), require(\"ol/geom/Polygon.js\"), require(\"ol/geom/SimpleGeometry.js\"), require(\"ol/Overlay.js\"));\n\telse\n\t\troot[\"olcs\"] = factory(root[\"ol/geom/Point.js\"], root[\"ol/easing.js\"], root[\"ol/layer/Tile.js\"], root[\"ol/layer/Image.js\"], root[\"ol/proj.js\"], root[\"ol/source/ImageStatic.js\"], root[\"ol/source/ImageWMS.js\"], root[\"ol/source/TileImage.js\"], root[\"ol/source/TileWMS.js\"], root[\"ol/source/VectorTile.js\"], root[\"ol/source/Image.js\"], root[\"ol/source.js\"], root[\"ol/format/MVT.js\"], root[\"ol/style/Style.js\"], root[\"ol/style/Stroke.js\"], root[\"ol/render.js\"], root[\"ol/util.js\"], root[\"ol/structs/LRUCache.js\"], root[\"ol/tilegrid.js\"], root[\"ol/tileurlfunction.js\"], root[\"ol/layer/VectorTile.js\"], root[\"ol/extent.js\"], root[\"ol/Observable.js\"], root[\"ol/layer/Group.js\"], root[\"ol/layer/BaseVector.js\"], root[\"ol/source/Vector.js\"], root[\"ol/layer/Layer.js\"], root[\"ol/source/Cluster.js\"], root[\"ol/layer/Vector.js\"], root[\"ol/geom/Geometry.js\"], root[\"ol/style/Icon.js\"], root[\"ol/geom/Polygon.js\"], root[\"ol/geom/SimpleGeometry.js\"], root[\"ol/Overlay.js\"]);\n})(self, (__WEBPACK_EXTERNAL_MODULE__206__, __WEBPACK_EXTERNAL_MODULE__177__, __WEBPACK_EXTERNAL_MODULE__164__, __WEBPACK_EXTERNAL_MODULE__330__, __WEBPACK_EXTERNAL_MODULE__24__, __WEBPACK_EXTERNAL_MODULE__606__, __WEBPACK_EXTERNAL_MODULE__469__, __WEBPACK_EXTERNAL_MODULE__623__, __WEBPACK_EXTERNAL_MODULE__886__, __WEBPACK_EXTERNAL_MODULE__622__, __WEBPACK_EXTERNAL_MODULE__673__, __WEBPACK_EXTERNAL_MODULE__432__, __WEBPACK_EXTERNAL_MODULE__401__, __WEBPACK_EXTERNAL_MODULE__193__, __WEBPACK_EXTERNAL_MODULE__51__, __WEBPACK_EXTERNAL_MODULE__817__, __WEBPACK_EXTERNAL_MODULE__280__, __WEBPACK_EXTERNAL_MODULE__750__, __WEBPACK_EXTERNAL_MODULE__628__, __WEBPACK_EXTERNAL_MODULE__423__, __WEBPACK_EXTERNAL_MODULE__996__, __WEBPACK_EXTERNAL_MODULE__235__, __WEBPACK_EXTERNAL_MODULE__911__, __WEBPACK_EXTERNAL_MODULE__604__, __WEBPACK_EXTERNAL_MODULE__515__, __WEBPACK_EXTERNAL_MODULE__830__, __WEBPACK_EXTERNAL_MODULE__582__, __WEBPACK_EXTERNAL_MODULE__63__, __WEBPACK_EXTERNAL_MODULE__425__, __WEBPACK_EXTERNAL_MODULE__229__, __WEBPACK_EXTERNAL_MODULE__962__, __WEBPACK_EXTERNAL_MODULE__253__, __WEBPACK_EXTERNAL_MODULE__988__, __WEBPACK_EXTERNAL_MODULE__312__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__911__;","module.exports = __WEBPACK_EXTERNAL_MODULE__312__;","module.exports = __WEBPACK_EXTERNAL_MODULE__177__;","module.exports = __WEBPACK_EXTERNAL_MODULE__235__;","module.exports = __WEBPACK_EXTERNAL_MODULE__401__;","module.exports = __WEBPACK_EXTERNAL_MODULE__229__;","module.exports = __WEBPACK_EXTERNAL_MODULE__206__;","module.exports = __WEBPACK_EXTERNAL_MODULE__253__;","module.exports = __WEBPACK_EXTERNAL_MODULE__988__;","module.exports = __WEBPACK_EXTERNAL_MODULE__515__;","module.exports = __WEBPACK_EXTERNAL_MODULE__604__;","module.exports = __WEBPACK_EXTERNAL_MODULE__330__;","module.exports = __WEBPACK_EXTERNAL_MODULE__582__;","module.exports = __WEBPACK_EXTERNAL_MODULE__164__;","module.exports = __WEBPACK_EXTERNAL_MODULE__425__;","module.exports = __WEBPACK_EXTERNAL_MODULE__996__;","module.exports = __WEBPACK_EXTERNAL_MODULE__24__;","module.exports = __WEBPACK_EXTERNAL_MODULE__817__;","module.exports = __WEBPACK_EXTERNAL_MODULE__432__;","module.exports = __WEBPACK_EXTERNAL_MODULE__63__;","module.exports = __WEBPACK_EXTERNAL_MODULE__673__;","module.exports = __WEBPACK_EXTERNAL_MODULE__606__;","module.exports = __WEBPACK_EXTERNAL_MODULE__469__;","module.exports = __WEBPACK_EXTERNAL_MODULE__623__;","module.exports = __WEBPACK_EXTERNAL_MODULE__886__;","module.exports = __WEBPACK_EXTERNAL_MODULE__830__;","module.exports = __WEBPACK_EXTERNAL_MODULE__622__;","module.exports = __WEBPACK_EXTERNAL_MODULE__750__;","module.exports = __WEBPACK_EXTERNAL_MODULE__962__;","module.exports = __WEBPACK_EXTERNAL_MODULE__51__;","module.exports = __WEBPACK_EXTERNAL_MODULE__193__;","module.exports = __WEBPACK_EXTERNAL_MODULE__628__;","module.exports = __WEBPACK_EXTERNAL_MODULE__423__;","module.exports = __WEBPACK_EXTERNAL_MODULE__280__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * @module olcs.util\n */\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexport function obj(param) {\n  return param;\n}\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nlet supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nlet imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexport function supportsImageRenderingPixelated() {\n  if (supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (supportsImageRenderingPixelatedResult_) {\n      imageRenderingValueResult_ = tmp;\n    }\n  }\n  return supportsImageRenderingPixelatedResult_;\n}\n\n\n/**\n * @return {string}\n */\nexport function imageRenderingValue() {\n  supportsImageRenderingPixelated();\n  return imageRenderingValueResult_ || '';\n}\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexport function getSourceProjection(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n  || source.getProjection();\n}\n\n\n/**\n * @param {ol.Observable} observable\n * @param {string} type\n * @param {Function} listener\n * @return {!ol.events.EventsKey}\n */\nexport function olcsListen(observable, type, listener) {\n  // See https://github.com/openlayers/openlayers/pull/8481\n  // ol.events.listen is internal so we use `on` instead.\n  // And since `on` as a convoluted API (can return an EventsKey or an array of them)\n  // we use a cast here.\n  return /** @type {!ol.events.EventsKey} */ (observable.on(type, listener));\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\n/**\n * Sort the passed array such that the relative order of equal elements is preverved.\n * See https://en.wikipedia.org/wiki/Sorting_algorithm#Stability for details.\n * @param {Array<*>} arr The array to sort (modifies original).\n * @param {!function(*, *): number} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  for (let i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort((a, b) => compareFnc(a.value, b.value) || a.index - b.index);\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\n/**\n * @param {Cesium.Scene} scene The scene.\n */\nexport function isGroundPolylinePrimitiveSupported(scene) {\n  const obj = Cesium.GroundPolylinePrimitive;\n  return obj && obj.isSupported(scene);\n}\n\n\nexport function waitReady(object) {\n  const p = object.readyPromise;\n  if (p) {\n    return p;\n  }\n  if (object.ready !== undefined) {\n    if (object.ready) {\n      return Promise.resolve(object);\n    }\n    return new Promise((resolve, _) => {\n      // FIXME: this is crazy\n      // alternative: intercept _ready = true\n      // altnerative: pass a timeout\n      const stopper = setInterval(() => {\n        if (object.ready) {\n          clearInterval(stopper);\n          resolve(object);\n        }\n      }, 20);\n    });\n  }\n  return Promise.reject('Not a readyable object');\n}\n\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport {getSourceProjection} from '../util.js';\nimport {Tile as TileSource} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core.ts';\n\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.Map} olMap\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(olMap, source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(); // cesium v107+ don't wait for ready anymore\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = olMap;\n\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_(frameState) {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  '_ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","import MVT from 'ol/format/MVT.js';\nimport Style from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\n\n\nconst format = new MVT();\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider {\n  constructor(options) {\n    this.urls = options.urls;\n    this.ready = true;\n    this.readyPromise = Promise.resolve(true);\n    this.tileWidth = 256;\n    this.tileHeight = 256;\n    this.maximumLevel = options.maximumLevel || 20;\n    this.minimumLevel = options.minimumLevel || 0;\n    this.tilingScheme = new Cesium.WebMercatorTilingScheme;\n    this.rectangle = options.rectangle || this.tilingScheme.rectangle;\n    this.errorEvent = new Cesium.Event();\n    this.credit = options.credit;\n    this.hasAlphaChannel = true;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.projection_ = getProjection('EPSG:3857');\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n    this.tileRectangle_ = new Cesium.Rectangle();\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    // to avoid too frequent cache grooming we allow x2 capacity\n\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  getTileCredits() {\n    return [];\n  }\n\n  pickFeatures() {\n  }\n\n\n  getTileFeatures(z, x, y) {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer) {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: format.dataProjection,\n        featureProjection: format.dataProjection\n      };\n    }\n    const features = format.readFeatures(buffer, options);\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  getUrl_(z, x, y) {\n    const url = this.tileFunction_([z, x, y]);\n    return url;\n  }\n\n  getCacheKey_(z, x, y) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x, y, z, request) {\n    if (z < this.minimumLevel) {\n      return this.emptyCanvas_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      this.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features, styleFunction, resolution) {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        styles.forEach((style) => {\n          vectorContext.setStyle(style);\n          vectorContext.drawGeometry(f);\n        });\n      }\n    });\n    return canvas;\n  }\n}\n","/**\n * @module olcs.core\n */\nimport {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, type ProjectionLike, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport {getSourceProjection} from './util.js';\nimport MVTImageryProvider from './MVTImageryProvider.js';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {type Extent, getCenter as getExtentCenter} from 'ol/extent.js';\nimport BaseLayer from 'ol/layer/Base.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport type {\n  BoundingSphere,\n  Camera,\n  Cartesian2,\n  Cartesian3,\n  Cartographic,\n  Color, ImageMaterialProperty,\n  ImageryLayer,\n  Matrix4,\n  Ray,\n  Rectangle,\n  Scene,\n  SingleTileImageryProvider\n} from 'cesium';\nimport Geometry from 'ol/geom/Geometry.js';\nimport type {Coordinate} from 'ol/coordinate.js';\nimport Source from 'ol/source/Source.js';\n// eslint-disable-next-line no-duplicate-imports\nimport type {Attribution} from 'ol/source/Source.js';\n\nimport Map from 'ol/Map.js';\nimport Projection from 'ol/proj/Projection.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport View from 'ol/View.js';\n\ntype CesiumUrlDefinition = {\n    url: string,\n    subdomains: string\n}\n\n\n/**\n * Options for rotate around axis core function.\n */\ntype RotateAroundAxisOption = {\n  duration?: number,\n  easing?: (value: number) => number,\n  callback: () => void\n}\n\n\nexport type LayerWithParents = {\n  layer: BaseLayer,\n  parents: LayerGroup[] | BaseLayer[]\n}\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n */\nexport function computePixelSizeAtCoordinate(scene: Scene, target: Cartesian3): Cartesian2 {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  // @ts-ignore TS2341\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight, distance, scene.pixelRatio, new Cesium.Cartesian2());\n}\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexport function computeBoundingBoxAtTarget(scene: Scene, target: Cartesian3, amount: number): Cartographic[] {\n  const pixelSize = computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n}\n\nexport function applyHeightOffsetToGeometry(geometry: Geometry, height: number) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n}\n\nexport function createMatrixAtCoordinates(\n    coordinates: Coordinate,\n    rotation = 0,\n    translation = Cesium.Cartesian3.ZERO,\n    scale = new Cesium.Cartesian3(1, 1, 1)\n): Matrix4 {\n  const position = ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n}\n\nexport function rotateAroundAxis(camera: Camera, angle: number, axis: Cartesian3, transform: Matrix4,\n    opt_options?: RotateAroundAxisOption) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options: RotateAroundAxisOption = opt_options;\n  const duration = defaultValue(options?.duration, 500); // ms\n  const easing = defaultValue(options?.easing, linearEasing);\n  const callback = options?.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n}\n\nexport function setHeadingUsingBottomCenter(\n    scene: Scene,\n    heading: number,\n    bottomCenter: Cartesian3,\n    options?: RotateAroundAxisOption\n) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  rotateAroundAxis(camera, heading, zenith, transform, options);\n}\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n */\nexport function pickOnTerrainOrEllipsoid(scene: Scene, pixel: Cartesian2): Cartesian3 {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n}\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n */\nexport function pickBottomPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return pickOnTerrainOrEllipsoid(scene, bottom);\n}\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n */\nexport function pickCenterPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return pickOnTerrainOrEllipsoid(scene, center);\n}\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n */\nexport function computeSignedTiltAngleOnGlobe(scene: Scene): number | undefined {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n}\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n */\nexport function bottomFovRay(scene: Scene): Ray {\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n}\n\n\n/**\n * Compute the angle between two Cartesian3.\n */\nexport function signedAngleBetween(first: Cartesian3, second: Cartesian3, normal: Cartesian3): number {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n}\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n */\nexport function computeAngleToZenith(scene: Scene, pivot: Cartesian3): number {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fy = camera.frustum.fovy / 2;\n  const ray = bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = signedAngleBetween(normal, direction, left);\n  return a + fy;\n}\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n */\nexport function extentToRectangle(extent: Extent, projection: ProjectionLike) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n}\n\nexport function sourceToImageryProvider(\n    olMap: Map,\n    source: Source,\n    viewProj: Projection,\n    olLayer: BaseLayer\n): olcsCoreOLImageryProvider | MVTImageryProvider | SingleTileImageryProvider {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n  source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n    // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (isCesiumProjection(projection)) {\n      const rectangle: Rectangle = Cesium.Rectangle.fromDegrees(\n          source.getImageExtent()[0],\n          source.getImageExtent()[1],\n          source.getImageExtent()[2],\n          source.getImageExtent()[3],\n          new Cesium.Rectangle()\n      )\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile && olLayer instanceof VectorTileLayer) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n    // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      // @ts-ignore TS2341\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|Imageexport function are currently not supported\n    return null;\n  }\n  return provider;\n}\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and export function images\n */\nexport function tileLayerToImageryLayer(olMap: Map, olLayer: BaseLayer, viewProj: Projection): ImageryLayer | null  {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n  !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions: {rectangle?: Rectangle} = {};\n\n  const forcedExtent = (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n}\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n */\nexport function updateCesiumLayerProperties(olLayerWithParents: LayerWithParents, csLayer: ImageryLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible = visible && layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n}\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n */\nexport function ol4326CoordinateToCesiumCartesian(coordinate: Coordinate): Cartesian3 {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n}\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n */\nexport function ol4326CoordinateArrayToCsCartesians(coordinates: Coordinate[]): Cartesian3[] {\n  console.assert(coordinates !== null);\n  const toCartesian = ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n}\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n */\nexport function olGeometryCloneTo4326<T>(geometry: Geometry, projection: ProjectionLike): T | Geometry {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n}\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n */\nexport function convertColorToCesium(olColor: OLColor | CanvasGradient | CanvasPattern | string): Color | ImageMaterialProperty {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n}\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n */\nexport function convertUrlToCesium(url: string): CesiumUrlDefinition {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n}\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n */\nexport function resetToNorthZenith(map: Map, scene: Scene): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options: RotateAroundAxisOption = {\n      callback: () => {\n        const view = map.getView();\n        normalizeView(view);\n        resolve(undefined);\n      }\n    };\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexport function rotateAroundBottomCenter(scene: Scene, angle: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options: RotateAroundAxisOption = {callback: () => resolve(undefined)};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n */\nexport function normalizeView(view: View, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n\n  // @ts-ignore TS2341\n  if (view.constrainResolution) {\n    // @ts-ignore TS2341\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n}\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n */\nexport function isCesiumProjection(projection: Projection): boolean {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n}\n\nexport function attributionsFunctionToCredits(\n    attributionsFunction: Attribution | null,\n    zoom: number,\n    center: Coordinate,\n    extent: Extent\n) {\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction({\n    viewState: {zoom, center, projection: undefined, resolution: undefined, rotation: undefined},\n    extent,\n  });\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n */\nexport function calcDistanceForResolution(\n    resolution: number,\n    latitude: number,\n    scene: Scene,\n    projection: Projection\n): number {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n */\nexport function calcResolutionForDistance(distance: number, latitude: number, scene: Scene, projection: Projection): number {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n\n/**\n * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n * Near the ground the allowed distance is shorter.\n */\nexport function limitCameraToBoundingSphere(camera: Camera, boundingSphere: BoundingSphere, ratio: (height: number) => number): () => void {\n  let blockLimiter = false;\n  return function () {\n    if (!blockLimiter) {\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      if (Cesium.Cartesian3.distance(boundingSphere.center, position) > boundingSphere.radius * ratio(carto.height)) {\n        // @ts-ignore TS2339: FIXME, there is no flying property in Camera\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          blockLimiter = true;\n          const unblockLimiter = () => (blockLimiter = false);\n          camera.flyToBoundingSphere(boundingSphere, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter,\n          });\n        }\n      }\n    }\n  };\n}\n","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport {pickCenterPoint, calcDistanceForResolution, calcResolutionForDistance} from './core.ts';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  destroy() {\n    olObservableUnByKey(this.viewListenKey_);\n    this.viewListenKey_ = null;\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport {getUid, olcsListen} from './util.js';\nimport Map from 'ol/Map.js';\nimport type {Scene, ImageryLayer} from 'cesium';\nimport View from 'ol/View.js';\nimport Collection from 'ol/Collection.js';\nimport BaseLayer from 'ol/layer/Base.js';\nimport type {EventsKey} from 'ol/events.js';\nimport type {LayerWithParents} from './core.js';\nimport VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n\nabstract class AbstractSynchronizer<T extends ImageryLayer | VectorLayerCounterpart> {\n  protected map: Map;\n  protected view: View;\n  protected scene: Scene;\n  protected olLayers: Collection<BaseLayer>;\n  mapLayerGroup: LayerGroup;\n  /**\n   * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n   * Null value means, that we are unable to create equivalent layers.\n   */\n  protected layerMap: Record<string, Array<T>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer layers ids (from getUid).\n   */\n  protected  olLayerListenKeys: Record<string, Array<EventsKey>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer groups ids (from getUid).\n   */\n  private olGroupListenKeys_: Record<string, Array<EventsKey>> = {};\n\n  protected constructor(map: Map, scene: Scene) {\n    this.map = map;\n    this.view = map.getView();\n    this.scene = scene;\n    this.olLayers = map.getLayerGroup().getLayers();\n    this.mapLayerGroup = map.getLayerGroup();\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   */\n  protected orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   */\n  private addLayers_(root: BaseLayer) {\n    const fifo: LayerWithParents[] = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof LayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents: LayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = () => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   */\n  private addCesiumObjects_(cesiumObjects: Array<T>, layerId: string, layer: BaseLayer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   */\n  private removeAndDestroySingleLayer_(layer: BaseLayer): boolean {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   */\n  private unlistenSingleGroup_(group: LayerGroup) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   */\n  private removeLayer_(root: BaseLayer) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof LayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   */\n  private listenForGroupChanges_(group: LayerGroup) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray: EventsKey[] = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys: EventsKey[] = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   */\n  public destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   */\n  protected abstract addCesiumObject(object: T): void;\n\n  protected abstract destroyCesiumObject(object: T): void;\n\n  /**\n   * Remove single Cesium object from the collection.\n   */\n  protected abstract removeSingleCesiumObject(object: T, destroy: boolean): void;\n\n  protected abstract removeAllCesiumObjects(destroy: boolean): void;\n\n  protected abstract createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): Array<T>;\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport Map from 'ol/Map.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport {type LayerWithParents, tileLayerToImageryLayer, updateCesiumLayerProperties} from './core';\nimport type {Scene, ImageryLayer, ImageryLayerCollection} from 'cesium';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport BaseVectorLayer from 'ol/layer/BaseVector.js';\nimport LayerGroup from 'ol/layer/Group.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer<ImageryLayer> {\n  private cesiumLayers_: ImageryLayerCollection;\n  private ourLayers_: ImageryLayerCollection;\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   */\n  constructor(map: Map, scene: Scene) {\n    super(map, scene);\n\n    this.cesiumLayers_ = scene.imageryLayers;\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  addCesiumObject(object: ImageryLayer): void {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  destroyCesiumObject(object: ImageryLayer): void {\n    object.destroy();\n  }\n\n  removeSingleCesiumObject(object: ImageryLayer, destroy: boolean): void {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  removeAllCesiumObjects(destroy: boolean): void {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   */\n  protected convertLayerToCesiumImageries(olLayer: BaseLayer, viewProj: Projection): ImageryLayer[] {\n    const result = tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): ImageryLayer[] {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer instanceof BaseVectorLayer) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            // @ts-ignore TS2341\n            if (csObj._imageryCache) {\n              // @ts-ignore TS2341\n              csObj._imageryCache = {};\n            }\n\n            const ip = csObj.imageryProvider;\n            if (ip) {\n               // @ts-ignore TS2341\n               ip.tileCache?.clear();\n               // @ts-ignore TS2341\n               ip.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices: Record<number, number> = {};\n    const queue: Array<BaseLayer | LayerGroup> = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof LayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  raiseToTop(counterpart: ImageryLayer) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Billboard, BillboardCollection, Primitive, PrimitiveCollection, Scene} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n\n/**\n * Context for feature conversion.\n */\nexport type OlFeatureToCesiumContext = {\n  projection: Projection | string,\n  billboards: BillboardCollection,\n  featureToCesiumMap: Record<number, Array<Primitive | Billboard>>,\n  primitives: PrimitiveCollection\n};\n\nexport type PrimitiveCollectionCounterpart = PrimitiveCollection & {counterpart: VectorLayerCounterpart};\n\n\nclass VectorLayerCounterpart {\n  olListenKeys: EventsKey[] = []\n  context: OlFeatureToCesiumContext;\n  private rootCollection_: PrimitiveCollection;\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  */\n  constructor(layerProjection: Projection | string, scene: Scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  getRootPrimitive(): PrimitiveCollection {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport {convertColorToCesium, olGeometryCloneTo4326, ol4326CoordinateToCesiumCartesian, ol4326CoordinateArrayToCsCartesians} from './core.ts';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.ts';\nimport {obj, getUid, isGroundPolylinePrimitiveSupported, waitReady} from './util.js';\n\n\n/**\n * @typedef {Object} ModelStyle\n * @property {Cesium.Matrix4} [debugModelMatrix]\n * @property {Cesium.ModelFromGltfOptions} cesiumOptions\n */\n\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true,\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.MaterialAppearance({\n        ...options,\n        material: new Cesium.Material({\n          translucent: color.alpha !== 1,\n          fabric: {\n            type: 'Color',\n            uniforms: {\n              color,\n            }\n          }\n        })\n      });\n      if (feature.get('olcs_shadows') || layer.get('olcs_shadows')) {\n        primitive.shadows = 1;\n      }\n    }\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = ol4326CoordinateToCesiumCartesian(center);\n    point = ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          waitReady(outlinePrimitive).then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        waitReady(outlinePrimitive).then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      const featureExtrudedHeight = feature.getProperty('olcs_extruded_height');\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            waitReady(outlinePrimitive).then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true,\n          extrudedHeight: featureExtrudedHeight,\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      });\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2((image.width / 2 - anchor[0]) * scale, (image.height / 2 - anchor[1]) * scale);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        if (Cesium.Model.fromGltf) {\n          // pre Cesium v107\n          const model = Cesium.Model.fromGltf(options);\n          modelPrimitive.add(model);\n        } else {\n          Cesium.Model.fromGltfAsync(options).then((model) => {\n            modelPrimitive.add(model);\n          });\n        }\n\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector, {VectorSourceEvent} from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport olcsFeatureConverter from './FeatureConverter.js';\nimport VectorLayerCounterpart, {\n  type OlFeatureToCesiumContext,\n  type PrimitiveCollectionCounterpart\n} from './core/VectorLayerCounterpart';\nimport type Map from 'ol/Map.js';\nimport {type LayerWithParents} from './core';\nimport Feature from 'ol/Feature.js';\nimport BaseLayer from 'ol/layer/Base.js';\nimport {Primitive, PrimitiveCollection, Scene} from 'cesium';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer<VectorLayerCounterpart> {\n  protected converter: olcsFeatureConverter;\n  private csAllPrimitives_: PrimitiveCollection\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   */\n  constructor(map: Map, scene: Scene, opt_converter?: olcsFeatureConverter) {\n    super(map, scene);\n\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  addCesiumObject(counterpart: VectorLayerCounterpart) {\n    console.assert(counterpart);\n    const collection = <PrimitiveCollectionCounterpart>counterpart.getRootPrimitive()\n    collection.counterpart = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  destroyCesiumObject(object: VectorLayerCounterpart) {\n    object.getRootPrimitive().destroy();\n  }\n\n  removeSingleCesiumObject(object: VectorLayerCounterpart, destroy: boolean) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  removeAllCesiumObjects(destroy: boolean) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   */\n  updateLayerVisibility(olLayerWithParents: LayerWithParents, csPrimitive: PrimitiveCollection) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible = visible && layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): VectorLayerCounterpart[] {\n    const olLayer: BaseLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap: Record<number, Primitive> = {};\n    const counterpart: VectorLayerCounterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature: Feature) {\n      const context = counterpart.context;\n      const prim: Primitive = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature: Feature) {\n      const id = getUid(feature);\n      const context: OlFeatureToCesiumContext = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e: VectorSourceEvent) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Options for SynchronizedOverlay\n * @typedef {Object} SynchronizedOverlayOptions\n * @property {!Cesium.Scene} scene\n * @property {olOverlay} parent\n * @property {!import('olsc/OverlaySynchronizer.js').default} synchronizer\n */\n\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (node.nodeName === 'CANVAS') {\n        const ctx = clone.getContext('2d');\n        ctx.drawImage(node, 0, 0);\n      }\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(overlay); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {supportsImageRenderingPixelated, imageRenderingValue} from './util.js';\nimport {ol4326CoordinateToCesiumCartesian} from './core';\nimport {getTransform, type TransformFunction} from 'ol/proj.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer';\nimport olcsVectorSynchronizer from './VectorSynchronizer';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\nimport Map from 'ol/Map.js';\nimport Interaction from 'ol/interaction/Interaction.js';\nimport {Group} from 'ol/layer.js';\nimport Feature from 'ol/Feature.js';\nimport View from 'ol/View.js';\nimport type {\n  BoundingSphere, ContextOptions,\n  DataSourceCollection,\n  DataSourceDisplay,\n  Entity,\n  EntityView,\n  Globe,\n  JulianDate, MapMode2D, MapProjection, PerspectiveFrustum,\n  Scene,\n  ImageryLayer\n} from 'cesium';\nimport type AbstractSynchronizer from './AbstractSynchronizer';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n/**\n * Moved from Cesium\n * The state of a BoundingSphere computation being performed by a {@link Visualizer}.\n */\nconst BoundingSphereState: Record<string, number> = {\n  /**\n   * The BoundingSphere has been computed.\n   */\n  DONE: 0,\n  /**\n   * The BoundingSphere is still being computed.\n   */\n  PENDING: 1,\n  /**\n   * The BoundingSphere does not exist.\n   */\n  FAILED: 2,\n}\n\ntype SceneOptions = {\n  canvas: HTMLCanvasElement;\n  contextOptions?: ContextOptions;\n  creditContainer?: Element;\n  creditViewport?: Element;\n  mapProjection?: MapProjection;\n  orderIndependentTranslucency?: boolean;\n  scene3DOnly?: boolean;\n  shadows?: boolean;\n  mapMode2D?: MapMode2D;\n  requestRenderMode?: boolean;\n  maximumRenderTimeChange?: number;\n  depthPlaneEllipsoidOffset?: number;\n  msaaSamples?: number;\n}\n\ntype OLCesiumOptions = {\n  map: Map,\n  time: () => JulianDate,\n  target: Element | string,\n  createSynchronizers: (map: Map, scene: Scene, dataSourceCollection: DataSourceCollection) => AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>[],\n  stopOpenLayersEventsPropagation: boolean,\n  sceneOptions: SceneOptions\n}\n\n// FIXME: remove this when all the synchronizers are migrated to typescript.\ntype SynchronizerType = AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>;\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\nclass OLCesium {\n  private autoRenderLoop_: olcsAutoRenderLoop | null = null;\n  private map_: Map;\n  private time_: () => JulianDate;\n  private to4326Transform_: TransformFunction;\n  private resolutionScale_ = 1.0;\n  private canvasClientWidth_ = 0.0;\n  private canvasClientHeight_ = 0.0;\n  private resolutionScaleChanged_ = true; // force resize\n  private container_: HTMLElement;\n  private isOverMap_: boolean;\n  private canvas_: HTMLCanvasElement;\n  private enabled_ = false;\n  private pausedInteractions_: Interaction[] = [];\n  private hiddenRootGroup_: Group | null = null;\n  private scene_: Scene;\n  private camera_: olcsCamera;\n  private globe_: Globe;\n  private dataSourceCollection_: DataSourceCollection;\n  private dataSourceDisplay_: DataSourceDisplay;\n  /** Time of the last rendered frame, as returned by `performance.now()`. */\n  private lastFrameTime_ = 0;\n  /** The identifier returned by `requestAnimationFrame`. */\n  private renderId_: number | undefined;\n  /** Target frame rate for the render loop.  */\n  private targetFrameRate_ = Number.POSITIVE_INFINITY;\n  /** If the Cesium render loop is being blocked. */\n  private blockCesiumRendering_ = false;\n  /** If the warmup routine is active. */\n  private warmingUp_ = false;\n  private trackedFeature_: Feature | null = null;\n  private trackedEntity_: Entity | null = null;\n  private entityView_: EntityView | null = null;\n  private needTrackedEntityUpdate_ = false;\n  private boundingSphereScratch_: BoundingSphere = new Cesium.BoundingSphere();\n  private synchronizers_: SynchronizerType[];\n\n  constructor(options: OLCesiumOptions) {\n    this.map_ = options.map;\n\n    this.time_ = options.time || function () {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none';\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n    this.canvas_ = document.createElement<'canvas'>('canvas');\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function () {\n      return false;\n    };\n    this.canvas_.onselectstart = function () {\n      return false;\n    };\n\n    this.container_.appendChild(this.canvas_);\n\n    const sceneOptions: SceneOptions = options.sceneOptions !== undefined ?\n      {...options.sceneOptions, canvas: this.canvas_, scene3DOnly: true} :\n      {canvas: this.canvas_, scene3DOnly: true};\n\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    if (!Array.isArray(sscc.tiltEventTypes)) {\n      console.log('sscc is not an array');\n    } else {\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.SHIFT\n      });\n\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.ALT\n      });\n    }\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      tileHeight: 1,\n      tileWidth: 1,\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    this.synchronizers_ = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ] as unknown as SynchronizerType[];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = this.synchronizers_.length - 1; i >= 0; --i) {\n      this.synchronizers_[i].synchronize();\n    }\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n  }\n\n  /**\n   * Destroys the Cesium resources held by this object.\n   */\n  destroy() {\n    cancelAnimationFrame(this.renderId_);\n    this.renderId_ = undefined;\n    this.synchronizers_.forEach(synchronizer => synchronizer.destroyAll());\n    this.camera_.destroy();\n    this.scene_.destroy();\n    // @ts-ignore TS2341\n    this.scene_._postRender = null;\n    this.container_.remove();\n  }\n\n  /**\n   * Render the Cesium scene.\n   */\n  private render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   */\n  private onAnimationFrame_(frameTime: number) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    // initializeFrame private property\n    // @ts-ignore TS2341\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      // getBoundingSphere private property\n      // @ts-ignore TS2341\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  private updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    // getBoundingSphere private property\n    // @ts-ignore TS2341\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  private handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 || height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    (<PerspectiveFrustum>this.scene_.camera.frustum).aspectRatio = width / height;\n  }\n\n  getCamera(): olcsCamera {\n    return this.camera_;\n  }\n\n  getOlMap(): Map {\n    return this.map_;\n  }\n\n  getOlView(): View {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  getCesiumScene(): Scene {\n    return this.scene_;\n  }\n\n  getDataSources(): DataSourceCollection {\n    return this.dataSourceCollection_;\n  }\n\n  getDataSourceDisplay(): DataSourceDisplay {\n    return this.dataSourceDisplay_;\n  }\n\n  getEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   */\n  setEnabled(enable: boolean) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = (interaction) => {\n          let interactionRemoved = false\n          this.pausedInteractions_ = this.pausedInteractions_.filter((i) => {\n            const removed = i !== interaction;\n            if(!interactionRemoved) interactionRemoved = removed\n            return removed\n          })\n          return interactionRemoved ? interaction : undefined;\n        }\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n  */\n  warmUp(height: number, timeout: number) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n  */\n  setBlockCesiumRendering(block: boolean) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n  */\n  getAutoRenderLoop(): olcsAutoRenderLoop {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   */\n  setResolutionScale(value: number) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   */\n  setTargetFrameRate(value: number) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   */\n  private throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  get trackedFeature(): Feature {\n    return this.trackedFeature_;\n  }\n\n  set trackedFeature(feature: Feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry instanceof olGeomPoint ? geometry.getCoordinates() : [];\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independent of the primitive/geometry created by the vector synchronizer.\n      const options: Entity.ConstructorOptions = {\n        // @ts-ignore according to Cesium types, not possible to pass CallbackProperty\n        position: new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        point: {\n          pixelSize: 1,\n          color: Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n\nexport default OLCesium;\n","/**\n * @module olcs.contrib.LazyLoader\n */\nexport default class LazyLoader {\n  /**\n   * @param {string} url\n   * @api\n   */\n  constructor(url) {\n    /**\n     * @type {Promise<undefined>}\n     * @protected\n     */\n    this.promise;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = url;\n  }\n\n  /**\n   * @return {Promise<undefined>}\n   * @api\n   */\n  load() {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n","/**\n * @module olcs.contrib.Manager\n */\nimport olcsContribLazyLoader from '../contrib/LazyLoader.js';\nimport OLCesium from '../OLCesium.ts';\nimport {resetToNorthZenith, rotateAroundBottomCenter, computeSignedTiltAngleOnGlobe, pickBottomPoint, setHeadingUsingBottomCenter, limitCameraToBoundingSphere} from '../core.ts';\nimport {toRadians} from '../math.js';\nimport olObservable from 'ol/Observable.js';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nconst Manager = class extends olObservable {\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken} = {}) {\n\n    super();\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumUrl_ = cesiumUrl;\n\n    /**\n     * @type {ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.Extent}\n     * @protected\n     */\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n\n    /**\n     * @private\n     * @type {Cesium.BoundingSphere}\n     */\n    this.boundingSphere_;\n\n    /**\n     * @type {Promise.<olcs.OLCesium>}\n     * @private\n     */\n    this.promise_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n\n    /**\n     * @type {olcs.OLCesium}\n     * @protected\n     */\n    this.ol3d;\n\n    /**\n     * @const {number} Tilt angle in radians\n     * @private\n     */\n    this.cesiumInitialTilt_ = toRadians(50);\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogDensity = 0.0001;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogSSEFactor = 25;\n\n    /**\n     * Limit the minimum distance to the terrain to 2m.\n     * @protected\n     * @type {number}\n     */\n    this.minimumZoomDistance = 2;\n\n    /**\n     * Limit the maximum distance to the earth to 10'000km.\n     * @protected\n     * @type {number}\n     */\n    this.maximumZoomDistance = 10000000;\n\n    // when closer to 3000m, restrict the available positions harder\n    /**\n     * @protected\n     * @param {number} height\n     */\n    this.limitCameraToBoundingSphereRatio = height => (height > 3000 ? 9 : 3);\n  }\n\n\n  /**\n   * @return {Promise.<olcs.OLCesium>}\n   */\n  load() {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * @protected\n   * @return {olcs.OLCesium}\n   */\n  onCesiumLoaded() {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   * @return {olcs.OLCesium}\n   */\n  instantiateOLCesium() {\n    console.assert(this.map);\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    if (Cesium.createWorldTerrain) {\n      const terrainProvider = Cesium.createWorldTerrain();\n      scene.terrainProvider = terrainProvider;\n    } else {\n      // v107+\n      Cesium.createWorldTerrainAsync().then(tp => scene.terrainProvider = tp);\n    }\n\n    return ol3d;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForPerformance(scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForUsability(scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this));\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   * @protected\n   */\n  limitCameraToBoundingSphere() {\n    const scene = this.ol3d.getCesiumScene();\n    limitCameraToBoundingSphere(scene.camera, this.boundingSphere_, this.limitCameraToBoundingSphereRatio);\n  }\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   * @export\n   * @return {Promise<undefined>}\n   */\n  toggle3d() {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   *\n   * @export\n   * @param {number} lon\n   * @param {number} lat\n   * @param {number} elevation\n   * @param {number} headingDeg Heading value in degrees.\n   * @param {number} pitchDeg Pitch value in degrees.\n   * @returns {Promise<undefined>}\n   */\n  set3dWithView(lon, lat, elevation, headingDeg, pitchDeg) {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * @export\n   * @return {boolean}\n   */\n  is3dEnabled() {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading() {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * @param {number} angle\n   */\n  setHeading(angle) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = pickBottomPoint(scene);\n    if (bottom) {\n      setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  /**\n   * @export\n   * @return {olcs.OLCesium}\n   */\n  getOl3d() {\n    return this.ol3d;\n  }\n\n  /**\n   * @export\n   * @return {!ol.View}\n   */\n  getOlView() {\n    const view = this.map.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @export\n   * @return {Cesium.Matrix4}\n   */\n  getCesiumViewMatrix() {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  /**\n   * @export\n   * @return {!Cesium.Scene}\n   */\n  getCesiumScene() {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * @export\n   * @param {!Cesium.Rectangle} rectangle\n   * @param {number=} offset in meters\n   * @return {Promise<undefined>}\n   */\n  flyToRectangle(rectangle, offset = 0) {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n\n  /**\n   * @protected\n   * @return {Cesium.Rectangle|undefined}\n   */\n  getCameraExtentRectangle() {\n    if (this.cameraExtentInRadians) {\n      return new Cesium.Rectangle(...this.cameraExtentInRadians);\n    }\n  }\n};\n\n\nexport default Manager;\n","import OLCesium from './olcs/OLCesium.ts';\n\nimport AbstractSynchronizer from './olcs/AbstractSynchronizer.ts';\nimport RasterSynchronizer from './olcs/RasterSynchronizer.ts';\nimport VectorSynchronizer from './olcs/VectorSynchronizer.ts';\n\nimport * as core from './olcs/core.ts';\nimport OLImageryProvider from './olcs/core/OLImageryProvider.js';\nimport VectorLayerCounterpart from './olcs/core/VectorLayerCounterpart.ts';\n\nimport LazyLoader from './olcs/contrib/LazyLoader.js';\nimport Manager from './olcs/contrib/Manager.js';\n\n\nexport default OLCesium;\n\nconst olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nolcs.core = core;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nolcs.contrib.LazyLoader = LazyLoader;\nolcs.contrib.Manager = Manager;\n"],"names":["root","factory","exports","module","require","define","amd","self","__WEBPACK_EXTERNAL_MODULE__206__","__WEBPACK_EXTERNAL_MODULE__177__","__WEBPACK_EXTERNAL_MODULE__164__","__WEBPACK_EXTERNAL_MODULE__330__","__WEBPACK_EXTERNAL_MODULE__24__","__WEBPACK_EXTERNAL_MODULE__606__","__WEBPACK_EXTERNAL_MODULE__469__","__WEBPACK_EXTERNAL_MODULE__623__","__WEBPACK_EXTERNAL_MODULE__886__","__WEBPACK_EXTERNAL_MODULE__622__","__WEBPACK_EXTERNAL_MODULE__673__","__WEBPACK_EXTERNAL_MODULE__432__","__WEBPACK_EXTERNAL_MODULE__401__","__WEBPACK_EXTERNAL_MODULE__193__","__WEBPACK_EXTERNAL_MODULE__51__","__WEBPACK_EXTERNAL_MODULE__817__","__WEBPACK_EXTERNAL_MODULE__280__","__WEBPACK_EXTERNAL_MODULE__750__","__WEBPACK_EXTERNAL_MODULE__628__","__WEBPACK_EXTERNAL_MODULE__423__","__WEBPACK_EXTERNAL_MODULE__996__","__WEBPACK_EXTERNAL_MODULE__235__","__WEBPACK_EXTERNAL_MODULE__911__","__WEBPACK_EXTERNAL_MODULE__604__","__WEBPACK_EXTERNAL_MODULE__515__","__WEBPACK_EXTERNAL_MODULE__830__","__WEBPACK_EXTERNAL_MODULE__582__","__WEBPACK_EXTERNAL_MODULE__63__","__WEBPACK_EXTERNAL_MODULE__425__","__WEBPACK_EXTERNAL_MODULE__229__","__WEBPACK_EXTERNAL_MODULE__962__","__WEBPACK_EXTERNAL_MODULE__253__","__WEBPACK_EXTERNAL_MODULE__988__","__WEBPACK_EXTERNAL_MODULE__312__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","supportsImageRenderingPixelatedResult_","imageRenderingValueResult_","supportsImageRenderingPixelated","canvas","document","createElement","setAttribute","tmp","style","getSourceProjection","source","getProjection","olcsListen","observable","type","listener","on","uidCounter_","getUid","olcs_uid","isGroundPolylinePrimitiveSupported","scene","Cesium","GroundPolylinePrimitive","isSupported","waitReady","object","p","readyPromise","ready","Promise","resolve","_","stopper","setInterval","clearInterval","reject","olUseNewCoordinates","tileCoord","TileSource","projection","wrapX","getTileCoordForTileUrlFunction","OLImageryProvider","constructor","olMap","opt_fallbackProj","this","source_","projection_","fallbackProj_","ready_","tilingScheme_","WebMercatorTilingScheme","rectangle_","map_","shouldRequestNextLevel","proxy","proxy_","DefaultProxy","errorEvent_","Event","emptyCanvas_","width","height","e","handleSourceChanged_","frameState","getState","options","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","tileGrid","forEachTileCoord","getExtent","_ref","zoom","xIndex","yIndex","getCode","GeographicTilingScheme","rectangle","getTileCredits","x","y","level","attributionsFunction","getAttributions","extent","getView","calculateExtent","getSize","center","getCenter","attributionsFunctionToCredits","requestImage","tileUrlFunction","getTileUrlFunction","z_","y_","url","getURL","ImageryProvider","loadImage","defineProperties","tg","getTileGrid","Array","isArray","getTileSize","getMaxZoom","format","MVT","styles","Style","stroke","Stroke","color","MVTImageryProvider","urls","tileWidth","tileHeight","maximumLevel","minimumLevel","tilingScheme","errorEvent","credit","hasAlphaChannel","styleFunction_","styleFunction","tileRectangle_","Rectangle","cacheSize","tileCache","LRUCache","featureCache","getTilegridForProjection","tileFunction_","createTileUrlFunctions","pickFeatures","getTileFeatures","z","cacheKey","getCacheKey_","promise","containsKey","getUrl_","fetch","then","ok","arrayBuffer","buffer","readFeaturesFromBuffer","set","getCount","highWaterMark","canExpireCache","pop","OL_VERSION","dataProjection","featureProjection","features","readFeatures","scaleFactor","forEach","f","flatCoordinates","getFlatCoordinates","flip","i","length","request","tileXYToNativeRectangle","resolution","east","west","rasterizeFeatures","raiseEvent","vectorContext","toContext","getContext","size","setStyle","drawGeometry","computePixelSizeAtCoordinate","target","camera","frustum","distance","Cartesian3","magnitude","subtract","position","getPixelDimensions","clientWidth","clientHeight","pixelRatio","Cartesian2","computeBoundingBoxAtTarget","amount","pixelSize","transform","Transforms","eastNorthUpToFixedFrame","bottomLeft","Matrix4","multiplyByPoint","topRight","Ellipsoid","WGS84","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","geometry","applyTransform","input","output","stride","createMatrixAtCoordinates","coordinates","rotation","translation","scale","ZERO","ol4326CoordinateToCesiumCartesian","rawMatrix","quaternion","Quaternion","fromAxisAngle","UNIT_Z","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","angle","axis","opt_options","clamp","Math","defaultValue","duration","easing","linearEasing","callback","lastProgress","oldTransform","start","Date","now","step","timestamp","progress","clone","stepAngle","lookAtTransform","rotate","window","requestAnimationFrame","setHeadingUsingBottomCenter","heading","bottomCenter","angleToZenith","computeAngleToZenith","right","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","add","fromTranslation","pickOnTerrainOrEllipsoid","pixel","ray","getPickRay","globe","pick","pickEllipsoid","pickBottomPoint","pickCenterPoint","computeSignedTiltAngleOnGlobe","Ray","direction","ellipsoid","IntersectionTests","rayEllipsoid","getPoint","normal","geocentricSurfaceNormal","signedAngleBetween","PI","convertLongitudeRange","bottomFovRay","fovy2","fovy","matrix","first","second","b","c","normalize","cross","cosine","dot","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","ext","transformExtent","fromDegrees","sourceToImageryProvider","viewProj","olLayer","skip","provider","olSourceImageWMS","getUrl","getImageLoadFunction","defaultImageLoadFunction","sourceProps","olSourceTileWMS","attributions","params","getParams","setProperties","olSourceTileImage","isCesiumProjection","olcsCoreOLImageryProvider","olSourceImageStatic","olSourceVectorTile","VectorTileLayer","fromCode","split","map","u","replace","getStyleFunction","getExtentCenter","getImageExtent","SingleTileImageryProvider","tileLayerToImageryLayer","olLayerTile","olLayerImage","getSource","layerOptions","ImageryLayer","updateCesiumLayerProperties","olLayerWithParents","csLayer","opacity","visible","layer","concat","parents","layerOpacity","getOpacity","layerVisible","getVisible","alpha","show","coordinate","coo","ol4326CoordinateArrayToCsCartesians","toCartesian","cartesians","push","olGeometryCloneTo4326","proj4326","proj","properties","getProperties","convertColorToCesium","olColor","Color","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","ctx","fillStyle","fillRect","ImageMaterialProperty","image","convertUrlToCesium","subdomains","re","match","exec","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","resetToNorthZenith","currentHeading","getRotation","normalizeView","rotateAroundBottomCenter","view","getResolution","setRotation","constrainResolution","setResolution","getConstrainedResolution","is3857","is4326","viewState","html","Credit","calcDistanceForResolution","latitude","metersPerUnit","getMetersPerUnit","cos","abs","tan","calcResolutionForDistance","limitCameraToBoundingSphere","boundingSphere","ratio","blockLimiter","carto","Cartographic","fromCartesian","radius","flying","unblockLimiter","flyToBoundingSphere","complete","cancel","ol3d","scene_","getCesiumScene","canvas_","_boundNotifyRepaintRequired","notifyRepaintRequired","bind","repaintEventNames_","enable","requestRenderMode","maximumRenderTimeChange","repaintKey","addEventListener","getOlMap","getLayerGroup","disable","removeEventListener","un","restartRenderLoop","requestRender","toDegrees","angleInRadians","toRadians","angleInDegrees","Camera","cam_","view_","viewListenKey_","toLonLat_","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","destroy","olObservableUnByKey","opt_output","opt_dimension","dim","toLonLat","getTransform","fromLonLat","handleViewEvent_","readFromView","setHeading","getHeading","setTilt","tilt","updateCamera_","getTilt","setDistance","updateView","getDistance","setCenter","setPosition","ll","getAltitude","setView","destination","cartographicToCartesian","getPosition","cartesianToCartographic","longitude","setAltitude","altitude","getHeight","orientation","pitch","PI_OVER_TWO","roll","moveBackward","checkCameraChange","bestTarget","positionCartographic","bestTargetCartographic","pos","targetNormal","targetToCamera","up","angleBetween","tiltAngle","acos","isNaN","opt_dontSync","old","current","viewMatrix","equalsEpsilon","layerMap","olLayerListenKeys","olGroupListenKeys_","olLayers","getLayers","mapLayerGroup","synchronize","destroyAll","addLayers_","orderLayers","fifo","splice","olLayerId","toString","cesiumObjects","LayerGroup","listenForGroupChanges_","createSingleLayerCounterparts","l","newOlLayerWithParents","layerId","layerWithParents","onLayerChange","cesiumObjs","addCesiumObjects_","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","removeLayer_","done","uuid","listenKeyArray","contentKeys","listenAddRemove","collection","event","element","el","indexOf","objKey","removeAllCesiumObjects","olcsAbstractSynchronizer","super","cesiumLayers_","imageryLayers","ourLayers_","ImageryLayerCollection","remove","removeAll","convertLayerToCesiumImageries","result","olLayerItem","BaseVectorLayer","previousStyleFunction","currentStyleFunction","csObj","_imageryCache","ip","imageryProvider","_ip$tileCache","clear","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","arr","compareFnc","index","sort","stableSort","layer1","layer2","raiseToTop","layerProjection","olListenKeys","billboards","BillboardCollection","primitives","PrimitiveCollection","rootCollection_","context","featureToCesiumMap","getRootPrimitive","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","evt","cancellers","feature","id","canceller","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","opt_lineWidth","flat","renderState","depthTest","enabled","lineWidth","instances","instance","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","createInstance","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","GroundPrimitive","geometryInstances","Primitive","dataUri","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","uniforms","translucent","shadows","extractColorFromOlStyle","outline","fillColor","getFill","getColor","strokeColor","getStroke","extractLineWidthFromOlStyle","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","p1","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","bbOptions","eyeOffset","bb","olCircleGeometryToCesium","point","slice","getRadius","CircleGeometry","outlinePrimitive","positions","olCreateCircularPolygon","getLinearRing","getCoordinates","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","_primitive","createStackedGroundCorridors","CircleOutlineGeometry","extrudedHeight","max","previousDistance","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","linePositions","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","heightReference","primitiveOptions","PolylineGeometry","olPolygonGeometryToCesium","boundingExtent","maxHeight","featureExtrudedHeight","getProperty","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","holes","PolygonGeometry","perPositionHeight","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","olStyleIcon","load","getImage","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","getScale","assign","anchor","getAnchor","pixelOffset","src","naturalHeight","naturalWidth","isImageLoaded","cancelled","fuid","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","cesiumOptions","Model","fromGltf","model","fromGltfAsync","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","accumulate","geometries","functor","subgeos","getType","getPoints","getLineStrings","getPolygons","labels","LabelCollection","extentCenter","olGeomSimpleGeometry","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","labelStyle","horizontalOrigin","font","getFont","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getGeometryFromFeature","opt_geom","geom3d","olGeomGeometry","geomFuncRes","getGeometryFunction","getGeometry","olFeatureToCesium","geom","newBillboardAddedCallback","featureBb","getGeometries","prims","bbs","result2","Error","olVectorLayerToCesium","olView","featurePrimitiveMap","olSourceCluster","getFeatures","olcsCoreVectorLayerCounterpart","layerStyle","prim","convert","opt_converter","converter","olcsFeatureConverter","csAllPrimitives_","destroyPrimitives","updateLayerVisibility","csPrimitive","olLayerVector","olLayerVectorTile","csPrimitives","onAddFeature","onRemoveFeature","Billboard","olOverlay","parent","getOptions","scenePostRenderListenerRemover_","synchronizer_","synchronizer","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","getScene","parentNode","removeChild","postRender","updatePixelPosition","container","stopEvent","getOverlayContainerStopEvent","getOverlayContainer","insertFirst","insertBefore","appendChild","handlePositionChanged","sourceProjection","getMap","cloneNode","nodeName","drawImage","Node","TEXT_NODE","dispatchEvent","MouseEvent","stopPropagation","nodes","lastChild","removeChildren","getElement","clonedNode","setVisible","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","BoundingSphere","Occluder","isPointVisible","computeCullingVolume","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","mapSize","updateRenderedPosition","removeNode","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","olcsSynchronizedOverlay","overlayId","removedOverlay","removeOverlay","csOverlay","keys","BoundingSphereState","OLCesium","autoRenderLoop_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","enabled_","pausedInteractions_","hiddenRootGroup_","lastFrameTime_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","time_","time","JulianDate","to4326Transform_","fillArea","container_","containerAttribute","createAttribute","setAttributeNode","targetElement","getViewport","getElementById","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","canvasAttribute","oncontextmenu","onselectstart","sceneOptions","scene3DOnly","Scene","sscc","screenSpaceCameraController","tiltEventTypes","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","constrainedAxis","camera_","olcsCamera","globe_","Globe","baseColor","WHITE","skyAtmosphere","SkyAtmosphere","firstImageryProvider","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers_","createSynchronizers","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","handleResize_","EventHelper","updateTrackedEntity_","cancelAnimationFrame","renderId_","_postRender","render_","onAnimationFrame_","frameTime","interval","julianDate","initializeFrame","update","trackedEntity","getBoundingSphere","render","state","enableTilt","bs","EntityView","mapProjection","resolutionScale","devicePixelRatio","aspectRatio","getCamera","getOlView","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","interactions","visibility","throwOnUnitializedMap_","getInteractions","addInteraction","interaction","removeInteraction","interactionRemoved","filter","removed","rootGroup","classList","warmUp","timeout","csCamera","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","olcsAutoRenderLoop","getAutoRenderLoop","setResolutionScale","setTargetFrameRate","isDef","trackedFeature","defaultDataSource","entities","IDENTITY","to4326Transform","toCesiumPosition","olGeomPoint","CallbackProperty","TRANSPARENT","LazyLoader","url_","script","onload","onerror","head","olObservable","cesiumUrl","_temp","cameraExtentInRadians","cesiumIonDefaultAccessToken","cesiumUrl_","boundingSphere_","promise_","cesiumIonDefaultAccessToken_","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumLazyLoader","olcsContribLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","fromRectangle3D","Ion","defaultAccessToken","instantiateOLCesium","configureForUsability","configureForPerformance","createWorldTerrain","terrainProvider","createWorldTerrainAsync","tp","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","toggle3d","is3DCurrentlyEnabled","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","bottom","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","multiplyByScalar","flyTo","endTransform","getCameraExtentRectangle","olcs","AbstractSynchronizer","RasterSynchronizer","VectorSynchronizer","core","VectorLayerCounterpart","contrib","Manager"],"sourceRoot":""}