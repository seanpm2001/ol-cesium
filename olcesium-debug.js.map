{"version":3,"file":"olcesium-debug.js","mappings":"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","sources":["webpack://olcs_unused_var/./src/olcs/AbstractSynchronizer.ts","webpack://olcs_unused_var/./src/olcs/OLCesium.ts","webpack://olcs_unused_var/./src/olcs/RasterSynchronizer.ts","webpack://olcs_unused_var/./src/olcs/VectorSynchronizer.ts","webpack://olcs_unused_var/./src/olcs/core.ts","webpack://olcs_unused_var/./src/olcs/core/VectorLayerCounterpart.ts","webpack://olcs_unused_var/external var \"ol.Observable\"","webpack://olcs_unused_var/external var \"ol.Overlay\"","webpack://olcs_unused_var/external var \"ol.easing\"","webpack://olcs_unused_var/external var \"ol.extent\"","webpack://olcs_unused_var/external var \"ol.format.MVT\"","webpack://olcs_unused_var/external var \"ol.geom.Geometry\"","webpack://olcs_unused_var/external var \"ol.geom.Point\"","webpack://olcs_unused_var/external var \"ol.geom.Polygon\"","webpack://olcs_unused_var/external var \"ol.geom.SimpleGeometry\"","webpack://olcs_unused_var/external var \"ol.layer.BaseVector\"","webpack://olcs_unused_var/external var \"ol.layer.Group\"","webpack://olcs_unused_var/external var \"ol.layer.Image\"","webpack://olcs_unused_var/external var \"ol.layer.Layer\"","webpack://olcs_unused_var/external var \"ol.layer.Tile\"","webpack://olcs_unused_var/external var \"ol.layer.Vector\"","webpack://olcs_unused_var/external var \"ol.layer.VectorTile\"","webpack://olcs_unused_var/external var \"ol.proj\"","webpack://olcs_unused_var/external var \"ol.render\"","webpack://olcs_unused_var/external var \"ol.source\"","webpack://olcs_unused_var/external var \"ol.source.Cluster\"","webpack://olcs_unused_var/external var \"ol.source.Image\"","webpack://olcs_unused_var/external var \"ol.source.ImageStatic\"","webpack://olcs_unused_var/external var \"ol.source.ImageWMS\"","webpack://olcs_unused_var/external var \"ol.source.TileImage\"","webpack://olcs_unused_var/external var \"ol.source.TileWMS\"","webpack://olcs_unused_var/external var \"ol.source.Vector\"","webpack://olcs_unused_var/external var \"ol.source.VectorTile\"","webpack://olcs_unused_var/external var \"ol.structs.LRUCache\"","webpack://olcs_unused_var/external var \"ol.style.Icon\"","webpack://olcs_unused_var/external var \"ol.style.Stroke\"","webpack://olcs_unused_var/external var \"ol.style.Style\"","webpack://olcs_unused_var/external var \"ol.tilegrid\"","webpack://olcs_unused_var/external var \"ol.tileurlfunction\"","webpack://olcs_unused_var/external var \"ol.util\"","webpack://olcs_unused_var/./src/olcs/AutoRenderLoop.js","webpack://olcs_unused_var/./src/olcs/Camera.js","webpack://olcs_unused_var/./src/olcs/FeatureConverter.js","webpack://olcs_unused_var/./src/olcs/MVTImageryProvider.js","webpack://olcs_unused_var/./src/olcs/OverlaySynchronizer.js","webpack://olcs_unused_var/./src/olcs/SynchronizedOverlay.js","webpack://olcs_unused_var/./src/olcs/contrib/LazyLoader.js","webpack://olcs_unused_var/./src/olcs/contrib/Manager.js","webpack://olcs_unused_var/./src/olcs/core/OLImageryProvider.js","webpack://olcs_unused_var/./src/olcs/math.js","webpack://olcs_unused_var/./src/olcs/util.js","webpack://olcs_unused_var/webpack/bootstrap","webpack://olcs_unused_var/webpack/runtime/compat get default export","webpack://olcs_unused_var/webpack/runtime/define property getters","webpack://olcs_unused_var/webpack/runtime/hasOwnProperty shorthand","webpack://olcs_unused_var/webpack/runtime/make namespace object","webpack://olcs_unused_var/./src/index.library.js"],"sourcesContent":["/**\n * @module olcs.AbstractSynchronizer\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport {getUid, olcsListen} from './util.js';\nimport Map from 'ol/Map.js';\nimport type {Scene, ImageryLayer} from 'cesium';\nimport View from 'ol/View.js';\nimport Collection from 'ol/Collection.js';\nimport BaseLayer from 'ol/layer/Base.js';\nimport type {EventsKey} from 'ol/events.js';\nimport type {LayerWithParents} from './core.js';\nimport VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n\nabstract class AbstractSynchronizer<T extends ImageryLayer | VectorLayerCounterpart> {\n  protected map: Map;\n  protected view: View;\n  protected scene: Scene;\n  protected olLayers: Collection<BaseLayer>;\n  mapLayerGroup: LayerGroup;\n  /**\n   * Map of OpenLayers layer ids (from getUid) to the Cesium ImageryLayers.\n   * Null value means, that we are unable to create equivalent layers.\n   */\n  protected layerMap: Record<string, Array<T>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer layers ids (from getUid).\n   */\n  protected  olLayerListenKeys: Record<string, Array<EventsKey>> = {};\n  /**\n   * Map of listen keys for OpenLayers layer groups ids (from getUid).\n   */\n  private olGroupListenKeys_: Record<string, Array<EventsKey>> = {};\n\n  protected constructor(map: Map, scene: Scene) {\n    this.map = map;\n    this.view = map.getView();\n    this.scene = scene;\n    this.olLayers = map.getLayerGroup().getLayers();\n    this.mapLayerGroup = map.getLayerGroup();\n  }\n\n  /**\n   * Destroy all and perform complete synchronization of the layers.\n   */\n  synchronize() {\n    this.destroyAll();\n    this.addLayers_(this.mapLayerGroup);\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   */\n  protected orderLayers() {\n    // Ordering logics is handled in subclasses.\n  }\n\n  /**\n   * Add a layer hierarchy.\n   */\n  private addLayers_(root: BaseLayer) {\n    const fifo: LayerWithParents[] = [{\n      layer: root,\n      parents: []\n    }];\n    while (fifo.length > 0) {\n      const olLayerWithParents = fifo.splice(0, 1)[0];\n      const olLayer = olLayerWithParents.layer;\n      const olLayerId = getUid(olLayer).toString();\n      this.olLayerListenKeys[olLayerId] = [];\n      console.assert(!this.layerMap[olLayerId]);\n\n      let cesiumObjects = null;\n      if (olLayer instanceof LayerGroup) {\n        this.listenForGroupChanges_(olLayer);\n        if (olLayer !== this.mapLayerGroup) {\n          cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        }\n        if (!cesiumObjects) {\n          olLayer.getLayers().forEach((l) => {\n            if (l) {\n              const newOlLayerWithParents: LayerWithParents = {\n                layer: l,\n                parents: olLayer === this.mapLayerGroup ?\n                  [] :\n                  [olLayerWithParents.layer].concat(olLayerWithParents.parents)\n              };\n              fifo.push(newOlLayerWithParents);\n            }\n          });\n        }\n      } else {\n        cesiumObjects = this.createSingleLayerCounterparts(olLayerWithParents);\n        if (!cesiumObjects) {\n          // keep an eye on the layers that once failed to be added (might work when the layer is updated)\n          // for example when a source is set after the layer is added to the map\n          const layerId = olLayerId;\n          const layerWithParents = olLayerWithParents;\n          const onLayerChange = () => {\n            const cesiumObjs = this.createSingleLayerCounterparts(layerWithParents);\n            if (cesiumObjs) {\n              // unsubscribe event listener\n              layerWithParents.layer.un('change', onLayerChange);\n              this.addCesiumObjects_(cesiumObjs, layerId, layerWithParents.layer);\n              this.orderLayers();\n            }\n          };\n          this.olLayerListenKeys[olLayerId].push(olcsListen(layerWithParents.layer, 'change', onLayerChange));\n        }\n      }\n      // add Cesium layers\n      if (cesiumObjects) {\n        this.addCesiumObjects_(cesiumObjects, olLayerId, olLayer);\n      }\n    }\n\n    this.orderLayers();\n  }\n\n  /**\n   * Add Cesium objects.\n   */\n  private addCesiumObjects_(cesiumObjects: Array<T>, layerId: string, layer: BaseLayer) {\n    this.layerMap[layerId] = cesiumObjects;\n    this.olLayerListenKeys[layerId].push(olcsListen(layer, 'change:zIndex', () => this.orderLayers()));\n    cesiumObjects.forEach((cesiumObject) => {\n      this.addCesiumObject(cesiumObject);\n    });\n  }\n\n  /**\n   * Remove and destroy a single layer.\n   * @param {ol.layer.Layer} layer\n   * @return {boolean} counterpart destroyed\n   */\n  private removeAndDestroySingleLayer_(layer: BaseLayer): boolean {\n    const uid = getUid(layer).toString();\n    const counterparts = this.layerMap[uid];\n    if (!!counterparts) {\n      counterparts.forEach((counterpart) => {\n        this.removeSingleCesiumObject(counterpart, false);\n        this.destroyCesiumObject(counterpart);\n      });\n      this.olLayerListenKeys[uid].forEach(olObservableUnByKey);\n      delete this.olLayerListenKeys[uid];\n    }\n    delete this.layerMap[uid];\n    return !!counterparts;\n  }\n\n  /**\n   * Unlisten a single layer group.\n   */\n  private unlistenSingleGroup_(group: LayerGroup) {\n    if (group === this.mapLayerGroup) {\n      return;\n    }\n    const uid = getUid(group).toString();\n    const keys = this.olGroupListenKeys_[uid];\n    keys.forEach((key) => {\n      olObservableUnByKey(key);\n    });\n    delete this.olGroupListenKeys_[uid];\n    delete this.layerMap[uid];\n  }\n\n  /**\n   * Remove layer hierarchy.\n   */\n  private removeLayer_(root: BaseLayer) {\n    if (!!root) {\n      const fifo = [root];\n      while (fifo.length > 0) {\n        const olLayer = fifo.splice(0, 1)[0];\n        const done = this.removeAndDestroySingleLayer_(olLayer);\n        if (olLayer instanceof LayerGroup) {\n          this.unlistenSingleGroup_(olLayer);\n          if (!done) {\n            // No counterpart for the group itself so removing\n            // each of the child layers.\n            olLayer.getLayers().forEach((l) => {\n              fifo.push(l);\n            });\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Register listeners for single layer group change.\n   */\n  private listenForGroupChanges_(group: LayerGroup) {\n    const uuid = getUid(group).toString();\n\n    console.assert(this.olGroupListenKeys_[uuid] === undefined);\n\n    const listenKeyArray: EventsKey[] = [];\n    this.olGroupListenKeys_[uuid] = listenKeyArray;\n\n    // only the keys that need to be relistened when collection changes\n    let contentKeys: EventsKey[] = [];\n    const listenAddRemove = (function() {\n      const collection = group.getLayers();\n      if (collection) {\n        contentKeys = [\n          collection.on('add', (event) => {\n            this.addLayers_(event.element);\n          }),\n          collection.on('remove', (event) => {\n            this.removeLayer_(event.element);\n          })\n        ];\n        listenKeyArray.push(...contentKeys);\n      }\n    }).bind(this);\n\n    listenAddRemove();\n\n    listenKeyArray.push(group.on('change:layers', (e) => {\n      contentKeys.forEach((el) => {\n        const i = listenKeyArray.indexOf(el);\n        if (i >= 0) {\n          listenKeyArray.splice(i, 1);\n        }\n        olObservableUnByKey(el);\n      });\n      listenAddRemove();\n    }));\n  }\n\n  /**\n   * Destroys all the created Cesium objects.\n   */\n  public destroyAll() {\n    this.removeAllCesiumObjects(true); // destroy\n    let objKey;\n    for (objKey in this.olGroupListenKeys_) {\n      const keys = this.olGroupListenKeys_[objKey];\n      keys.forEach(olObservableUnByKey);\n    }\n    for (objKey in this.olLayerListenKeys) {\n      this.olLayerListenKeys[objKey].forEach(olObservableUnByKey);\n    }\n    this.olGroupListenKeys_ = {};\n    this.olLayerListenKeys = {};\n    this.layerMap = {};\n  }\n\n  /**\n   * Adds a single Cesium object to the collection.\n   */\n  protected abstract addCesiumObject(object: T): void;\n\n  protected abstract destroyCesiumObject(object: T): void;\n\n  /**\n   * Remove single Cesium object from the collection.\n   */\n  protected abstract removeSingleCesiumObject(object: T, destroy: boolean): void;\n\n  protected abstract removeAllCesiumObjects(destroy: boolean): void;\n\n  protected abstract createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): Array<T>;\n}\n\n\nexport default AbstractSynchronizer;\n","/**\n * @module olcs.OLCesium\n */\nimport olGeomPoint from 'ol/geom/Point.js';\nimport {supportsImageRenderingPixelated, imageRenderingValue} from './util.js';\nimport {ol4326CoordinateToCesiumCartesian} from './core';\nimport {getTransform, type TransformFunction} from 'ol/proj.js';\nimport olcsAutoRenderLoop from './AutoRenderLoop.js';\nimport olcsCamera from './Camera.js';\nimport olcsRasterSynchronizer from './RasterSynchronizer';\nimport olcsVectorSynchronizer from './VectorSynchronizer';\nimport olcsOverlaySynchronizer from './OverlaySynchronizer.js';\nimport Map from 'ol/Map.js';\nimport Interaction from 'ol/interaction/Interaction.js';\nimport {Group} from 'ol/layer.js';\nimport Feature from 'ol/Feature.js';\nimport View from 'ol/View.js';\nimport type {\n  BoundingSphere, ContextOptions,\n  DataSourceCollection,\n  DataSourceDisplay,\n  Entity,\n  EntityView,\n  Globe,\n  JulianDate, MapMode2D, MapProjection, PerspectiveFrustum,\n  Scene,\n  ImageryLayer\n} from 'cesium';\nimport type AbstractSynchronizer from './AbstractSynchronizer';\nimport type VectorLayerCounterpart from './core/VectorLayerCounterpart';\n\n/**\n * Moved from Cesium\n * The state of a BoundingSphere computation being performed by a {@link Visualizer}.\n */\nconst BoundingSphereState: Record<string, number> = {\n  /**\n   * The BoundingSphere has been computed.\n   */\n  DONE: 0,\n  /**\n   * The BoundingSphere is still being computed.\n   */\n  PENDING: 1,\n  /**\n   * The BoundingSphere does not exist.\n   */\n  FAILED: 2,\n}\n\ntype SceneOptions = {\n  canvas: HTMLCanvasElement;\n  contextOptions?: ContextOptions;\n  creditContainer?: Element;\n  creditViewport?: Element;\n  mapProjection?: MapProjection;\n  orderIndependentTranslucency?: boolean;\n  scene3DOnly?: boolean;\n  shadows?: boolean;\n  mapMode2D?: MapMode2D;\n  requestRenderMode?: boolean;\n  maximumRenderTimeChange?: number;\n  depthPlaneEllipsoidOffset?: number;\n  msaaSamples?: number;\n}\n\ntype OLCesiumOptions = {\n  map: Map,\n  time: () => JulianDate,\n  target: Element | string,\n  createSynchronizers: (map: Map, scene: Scene, dataSourceCollection: DataSourceCollection) => AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>[],\n  stopOpenLayersEventsPropagation: boolean,\n  sceneOptions: SceneOptions\n}\n\n// FIXME: remove this when all the synchronizers are migrated to typescript.\ntype SynchronizerType = AbstractSynchronizer<ImageryLayer | VectorLayerCounterpart>;\n\n/**\n * @typedef {Object} OLCesiumOptions\n * @property {import('ol/Map.js').default} map The OpenLayers map we want to show on a Cesium scene.\n * @property {Element|string} [target] Target element for the Cesium scene.\n * @property {function(!import('ol/Map.js').default, !Cesium.Scene, !Cesium.DataSourceCollection): Array<import('olcs/AbstractSynchronizer.js').default>}\n *      [createSynchronizers] Callback function which will be called by the {@link olcs.OLCesium}\n *      constructor to create custom synchronizers. Receives an `ol.Map` and a `Cesium.Scene` as arguments,\n *      and needs to return an array of {@link import('olcs/AbstractSynchronizer.js').default}.\n * @property {function(): Cesium.JulianDate} [time] Control the current time used by Cesium.\n * @property {boolean} [stopOpenLayersEventsPropagation] Prevent propagation of mouse/touch events to\n *      OpenLayers when Cesium is active.\n * @property {Cesium.SceneOptions} [sceneOptions] Allows the passing of property value to the\n *      `Cesium.Scene`.\n */\nclass OLCesium {\n  private autoRenderLoop_: olcsAutoRenderLoop | null = null;\n  private map_: Map;\n  private time_: () => JulianDate;\n  private to4326Transform_: TransformFunction;\n  private resolutionScale_ = 1.0;\n  private canvasClientWidth_ = 0.0;\n  private canvasClientHeight_ = 0.0;\n  private resolutionScaleChanged_ = true; // force resize\n  private container_: HTMLElement;\n  private isOverMap_: boolean;\n  private canvas_: HTMLCanvasElement;\n  private enabled_ = false;\n  private pausedInteractions_: Interaction[] = [];\n  private hiddenRootGroup_: Group | null = null;\n  private scene_: Scene;\n  private camera_: olcsCamera;\n  private globe_: Globe;\n  private dataSourceCollection_: DataSourceCollection;\n  private dataSourceDisplay_: DataSourceDisplay;\n  /** Time of the last rendered frame, as returned by `performance.now()`. */\n  private lastFrameTime_ = 0;\n  /** The identifier returned by `requestAnimationFrame`. */\n  private renderId_: number | undefined;\n  /** Target frame rate for the render loop.  */\n  private targetFrameRate_ = Number.POSITIVE_INFINITY;\n  /** If the Cesium render loop is being blocked. */\n  private blockCesiumRendering_ = false;\n  /** If the warmup routine is active. */\n  private warmingUp_ = false;\n  private trackedFeature_: Feature | null = null;\n  private trackedEntity_: Entity | null = null;\n  private entityView_: EntityView | null = null;\n  private needTrackedEntityUpdate_ = false;\n  private boundingSphereScratch_: BoundingSphere = new Cesium.BoundingSphere();\n  private synchronizers_: SynchronizerType[];\n\n  constructor(options: OLCesiumOptions) {\n    this.map_ = options.map;\n\n    this.time_ = options.time || function () {\n      return Cesium.JulianDate.now();\n    };\n\n    /**\n     * No change of the view projection.\n     */\n    this.to4326Transform_ = getTransform(this.map_.getView().getProjection(), 'EPSG:4326');\n\n    const fillArea = 'position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none';\n    this.container_ = document.createElement('DIV');\n    const containerAttribute = document.createAttribute('style');\n    containerAttribute.value = `${fillArea}visibility:hidden;`;\n    this.container_.setAttributeNode(containerAttribute);\n\n    let targetElement = options.target || this.map_.getViewport();\n    if (typeof targetElement === 'string') {\n      targetElement = document.getElementById(targetElement);\n    }\n    targetElement.appendChild(this.container_);\n\n    /**\n     * Whether the Cesium container is placed over the ol map.\n     * a target => side by side mode\n     * no target => over map mode\n     */\n    this.isOverMap_ = !options.target;\n\n\n    if (this.isOverMap_ && options.stopOpenLayersEventsPropagation) {\n      const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n      for (let i = 0, ii = overlayEvents.length; i < ii; ++i) {\n        this.container_.addEventListener(overlayEvents[i], evt => evt.stopPropagation());\n      }\n    }\n\n    this.canvas_ = document.createElement<'canvas'>('canvas');\n    const canvasAttribute = document.createAttribute('style');\n    canvasAttribute.value = fillArea;\n    this.canvas_.setAttributeNode(canvasAttribute);\n\n    if (supportsImageRenderingPixelated()) {\n      // non standard CSS4\n      this.canvas_.style['imageRendering'] = imageRenderingValue();\n    }\n\n    this.canvas_.oncontextmenu = function () {\n      return false;\n    };\n    this.canvas_.onselectstart = function () {\n      return false;\n    };\n\n    this.container_.appendChild(this.canvas_);\n\n    const sceneOptions: SceneOptions = options.sceneOptions !== undefined ?\n      {...options.sceneOptions, canvas: this.canvas_, scene3DOnly: true} :\n      {canvas: this.canvas_, scene3DOnly: true};\n\n    this.scene_ = new Cesium.Scene(sceneOptions);\n\n    const sscc = this.scene_.screenSpaceCameraController;\n\n    if (!Array.isArray(sscc.tiltEventTypes)) {\n      console.log('sscc is not an array');\n    } else {\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.SHIFT\n      });\n\n      sscc.tiltEventTypes.push({\n        'eventType': Cesium.CameraEventType.LEFT_DRAG,\n        'modifier': Cesium.KeyboardEventModifier.ALT\n      });\n    }\n\n    sscc.enableLook = false;\n\n    this.scene_.camera.constrainedAxis = Cesium.Cartesian3.UNIT_Z;\n\n    this.camera_ = new olcsCamera(this.scene_, this.map_);\n\n    this.globe_ = new Cesium.Globe(Cesium.Ellipsoid.WGS84);\n    this.globe_.baseColor = Cesium.Color.WHITE;\n    this.scene_.globe = this.globe_;\n    this.scene_.skyAtmosphere = new Cesium.SkyAtmosphere();\n\n    // The first layer of Cesium is special; using a 1x1 transparent image to workaround it.\n    // See https://github.com/AnalyticalGraphicsInc/cesium/issues/1323 for details.\n    const firstImageryProvider = new Cesium.SingleTileImageryProvider({\n      tileHeight: 1,\n      tileWidth: 1,\n      url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=',\n      rectangle: Cesium.Rectangle.fromDegrees(0, 0, 1, 1) // the Rectangle dimensions are arbitrary\n    });\n    this.globe_.imageryLayers.addImageryProvider(firstImageryProvider, 0);\n\n    this.dataSourceCollection_ = new Cesium.DataSourceCollection();\n    this.dataSourceDisplay_ = new Cesium.DataSourceDisplay({\n      scene: this.scene_,\n      dataSourceCollection: this.dataSourceCollection_\n    });\n\n    this.synchronizers_ = options.createSynchronizers ?\n      options.createSynchronizers(this.map_, this.scene_, this.dataSourceCollection_) : [\n        new olcsRasterSynchronizer(this.map_, this.scene_),\n        new olcsVectorSynchronizer(this.map_, this.scene_),\n        new olcsOverlaySynchronizer(this.map_, this.scene_)\n      ] as unknown as SynchronizerType[];\n\n    // Assures correct canvas size after initialisation\n    this.handleResize_();\n\n    for (let i = this.synchronizers_.length - 1; i >= 0; --i) {\n      this.synchronizers_[i].synchronize();\n    }\n\n    const eventHelper = new Cesium.EventHelper();\n    eventHelper.add(this.scene_.postRender, OLCesium.prototype.updateTrackedEntity_, this);\n  }\n\n  /**\n   * Destroys the Cesium resources held by this object.\n   */\n  destroy() {\n    cancelAnimationFrame(this.renderId_);\n    this.renderId_ = undefined;\n    this.synchronizers_.forEach(synchronizer => synchronizer.destroyAll());\n    this.camera_.destroy();\n    this.scene_.destroy();\n    // @ts-ignore TS2341\n    this.scene_._postRender = null;\n    this.container_.remove();\n  }\n\n  /**\n   * Render the Cesium scene.\n   */\n  private render_() {\n    // if a call to `requestAnimationFrame` is pending, cancel it\n    if (this.renderId_ !== undefined) {\n      cancelAnimationFrame(this.renderId_);\n      this.renderId_ = undefined;\n    }\n\n    // only render if Cesium is enabled/warming and rendering hasn't been blocked\n    if ((this.enabled_ || this.warmingUp_) && !this.blockCesiumRendering_) {\n      this.renderId_ = requestAnimationFrame(this.onAnimationFrame_.bind(this));\n    }\n  }\n\n  /**\n   * Callback for `requestAnimationFrame`.\n   * @param {number} frameTime The frame time, from `performance.now()`.\n   */\n  private onAnimationFrame_(frameTime: number) {\n    this.renderId_ = undefined;\n\n    // check if a frame was rendered within the target frame rate\n    const interval = 1000.0 / this.targetFrameRate_;\n    const delta = frameTime - this.lastFrameTime_;\n    if (delta < interval) {\n      // too soon, don't render yet\n      this.render_();\n      return;\n    }\n\n    // time to render a frame, save the time\n    this.lastFrameTime_ = frameTime;\n\n    const julianDate = this.time_();\n    // initializeFrame private property\n    // @ts-ignore TS2341\n    this.scene_.initializeFrame();\n    this.handleResize_();\n    this.dataSourceDisplay_.update(julianDate);\n\n    // Update tracked entity\n    if (this.entityView_) {\n      const trackedEntity = this.trackedEntity_;\n      // getBoundingSphere private property\n      // @ts-ignore TS2341\n      const trackedState = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n      if (trackedState === BoundingSphereState.DONE) {\n        this.boundingSphereScratch_.radius = 1; // a radius of 1 is enough for tracking points\n        this.entityView_.update(julianDate, this.boundingSphereScratch_);\n      }\n    }\n\n    this.scene_.render(julianDate);\n    this.camera_.checkCameraChange();\n\n    // request the next render call after this one completes to ensure the browser doesn't get backed up\n    this.render_();\n  }\n\n  private updateTrackedEntity_() {\n    if (!this.needTrackedEntityUpdate_) {\n      return;\n    }\n\n    const trackedEntity = this.trackedEntity_;\n    const scene = this.scene_;\n\n    // getBoundingSphere private property\n    // @ts-ignore TS2341\n    const state = this.dataSourceDisplay_.getBoundingSphere(trackedEntity, false, this.boundingSphereScratch_);\n    if (state === BoundingSphereState.PENDING) {\n      return;\n    }\n\n    scene.screenSpaceCameraController.enableTilt = false;\n\n    const bs = state !== BoundingSphereState.FAILED ? this.boundingSphereScratch_ : undefined;\n    if (bs) {\n      bs.radius = 1;\n    }\n    this.entityView_ = new Cesium.EntityView(trackedEntity, scene, scene.mapProjection.ellipsoid);\n    this.entityView_.update(this.time_(), bs);\n    this.needTrackedEntityUpdate_ = false;\n  }\n\n  private handleResize_() {\n    let width = this.canvas_.clientWidth;\n    let height = this.canvas_.clientHeight;\n\n    if (width === 0 || height === 0) {\n      // The canvas DOM element is not ready yet.\n      return;\n    }\n\n    if (width === this.canvasClientWidth_ &&\n        height === this.canvasClientHeight_ &&\n        !this.resolutionScaleChanged_) {\n      return;\n    }\n\n    let resolutionScale = this.resolutionScale_;\n    if (!supportsImageRenderingPixelated()) {\n      resolutionScale *= window.devicePixelRatio || 1.0;\n    }\n    this.resolutionScaleChanged_ = false;\n\n    this.canvasClientWidth_ = width;\n    this.canvasClientHeight_ = height;\n\n    width *= resolutionScale;\n    height *= resolutionScale;\n\n    this.canvas_.width = width;\n    this.canvas_.height = height;\n    (<PerspectiveFrustum>this.scene_.camera.frustum).aspectRatio = width / height;\n  }\n\n  getCamera(): olcsCamera {\n    return this.camera_;\n  }\n\n  getOlMap(): Map {\n    return this.map_;\n  }\n\n  getOlView(): View {\n    const view = this.map_.getView();\n    console.assert(view);\n    return view;\n  }\n\n  getCesiumScene(): Scene {\n    return this.scene_;\n  }\n\n  getDataSources(): DataSourceCollection {\n    return this.dataSourceCollection_;\n  }\n\n  getDataSourceDisplay(): DataSourceDisplay {\n    return this.dataSourceDisplay_;\n  }\n\n  getEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Enables/disables the Cesium.\n   * This modifies the visibility style of the container element.\n   */\n  setEnabled(enable: boolean) {\n    if (this.enabled_ === enable) {\n      return;\n    }\n    this.enabled_ = enable;\n\n    // some Cesium operations are operating with canvas.clientWidth,\n    // so we can't remove it from DOM or even make display:none;\n    this.container_.style.visibility = this.enabled_ ? 'visible' : 'hidden';\n    let interactions;\n    if (this.enabled_) {\n      this.throwOnUnitializedMap_();\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        interactions.forEach((el, i, arr) => {\n          this.pausedInteractions_.push(el);\n        });\n        interactions.clear();\n\n        this.map_.addInteraction = interaction => this.pausedInteractions_.push(interaction);\n        this.map_.removeInteraction = (interaction) => {\n          let interactionRemoved = false\n          this.pausedInteractions_ = this.pausedInteractions_.filter((i) => {\n            const removed = i !== interaction;\n            if(!interactionRemoved) interactionRemoved = removed\n            return removed\n          })\n          return interactionRemoved ? interaction : undefined;\n        }\n\n        const rootGroup = this.map_.getLayerGroup();\n        if (rootGroup.getVisible()) {\n          this.hiddenRootGroup_ = rootGroup;\n          this.hiddenRootGroup_.setVisible(false);\n        }\n\n        this.map_.getOverlayContainer().classList.add('olcs-hideoverlay');\n      }\n\n      this.camera_.readFromView();\n      this.render_();\n    } else {\n      if (this.isOverMap_) {\n        interactions = this.map_.getInteractions();\n        this.pausedInteractions_.forEach((interaction) => {\n          interactions.push(interaction);\n        });\n        this.pausedInteractions_.length = 0;\n\n        this.map_.addInteraction = interaction => this.map_.getInteractions().push(interaction);\n        this.map_.removeInteraction = interaction => this.map_.getInteractions().remove(interaction);\n\n        this.map_.getOverlayContainer().classList.remove('olcs-hideoverlay');\n        if (this.hiddenRootGroup_) {\n          this.hiddenRootGroup_.setVisible(true);\n          this.hiddenRootGroup_ = null;\n        }\n      }\n\n      this.camera_.updateView();\n    }\n  }\n\n  /**\n   * Preload Cesium so that it is ready when transitioning from 2D to 3D.\n   * @param {number} height Target height of the camera\n   * @param {number} timeout Milliseconds after which the warming will stop\n  */\n  warmUp(height: number, timeout: number) {\n    if (this.enabled_) {\n      // already enabled\n      return;\n    }\n    this.throwOnUnitializedMap_();\n    this.camera_.readFromView();\n    const ellipsoid = this.globe_.ellipsoid;\n    const csCamera = this.scene_.camera;\n    const position = ellipsoid.cartesianToCartographic(csCamera.position);\n    if (position.height < height) {\n      position.height = height;\n      csCamera.position = ellipsoid.cartographicToCartesian(position);\n    }\n\n    this.warmingUp_ = true;\n    this.render_();\n\n    setTimeout(() => {\n      this.warmingUp_ = false;\n    }, timeout);\n  }\n\n  /**\n   * Block Cesium rendering to save resources.\n   * @param {boolean} block True to block.\n  */\n  setBlockCesiumRendering(block: boolean) {\n    if (this.blockCesiumRendering_ !== block) {\n      this.blockCesiumRendering_ = block;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Render the globe only when necessary in order to save resources.\n   * Experimental.\n   */\n  enableAutoRenderLoop() {\n    if (!this.autoRenderLoop_) {\n      this.autoRenderLoop_ = new olcsAutoRenderLoop(this);\n    }\n  }\n\n  /**\n   * Get the autorender loop.\n  */\n  getAutoRenderLoop(): olcsAutoRenderLoop {\n    return this.autoRenderLoop_;\n  }\n\n  /**\n   * The 3D Cesium globe is rendered in a canvas with two different dimensions:\n   * clientWidth and clientHeight which are the dimension on the screen and\n   * width and height which are the dimensions of the drawing buffer.\n   *\n   * By using a resolution scale lower than 1.0, it is possible to render the\n   * globe in a buffer smaller than the canvas client dimensions and improve\n   * performance, at the cost of quality.\n   *\n   * Pixel ratio should also be taken into account; by default, a device with\n   * pixel ratio of 2.0 will have a buffer surface 4 times bigger than the client\n   * surface.\n   */\n  setResolutionScale(value: number) {\n    value = Math.max(0, value);\n    if (value !== this.resolutionScale_) {\n      this.resolutionScale_ = Math.max(0, value);\n      this.resolutionScaleChanged_ = true;\n      if (this.autoRenderLoop_) {\n        this.autoRenderLoop_.restartRenderLoop();\n      }\n    }\n  }\n\n  /**\n   * Set the target frame rate for the renderer. Set to `Number.POSITIVE_INFINITY`\n   * to render as quickly as possible.\n   * @param {number} value The frame rate, in frames per second.\n   */\n  setTargetFrameRate(value: number) {\n    if (this.targetFrameRate_ !== value) {\n      this.targetFrameRate_ = value;\n\n      // reset the render loop\n      this.render_();\n    }\n  }\n\n  /**\n   * Check if OpenLayers map is not properly initialized.\n   */\n  private throwOnUnitializedMap_() {\n    const map = this.map_;\n    const view = map.getView();\n    const center = view.getCenter();\n    if (!view.isDef() || isNaN(center[0]) || isNaN(center[1])) {\n      throw new Error(`The OpenLayers map is not properly initialized: ${center} / ${view.getResolution()}`);\n    }\n  }\n\n  get trackedFeature(): Feature {\n    return this.trackedFeature_;\n  }\n\n  set trackedFeature(feature: Feature) {\n    if (this.trackedFeature_ !== feature) {\n\n      const scene = this.scene_;\n\n      //Stop tracking\n      if (!feature || !feature.getGeometry()) {\n        this.needTrackedEntityUpdate_ = false;\n        scene.screenSpaceCameraController.enableTilt = true;\n\n        if (this.trackedEntity_) {\n          this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_);\n        }\n        this.trackedEntity_ = null;\n        this.trackedFeature_ = null;\n        this.entityView_ = null;\n        scene.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);\n        return;\n      }\n\n      this.trackedFeature_ = feature;\n\n      //We can't start tracking immediately, so we set a flag and start tracking\n      //when the bounding sphere is ready (most likely next frame).\n      this.needTrackedEntityUpdate_ = true;\n\n      const to4326Transform = this.to4326Transform_;\n      const toCesiumPosition = function() {\n        const geometry = feature.getGeometry();\n        console.assert(geometry instanceof olGeomPoint);\n        const coo = geometry instanceof olGeomPoint ? geometry.getCoordinates() : [];\n        const coo4326 = to4326Transform(coo, undefined, coo.length);\n        return ol4326CoordinateToCesiumCartesian(coo4326);\n      };\n\n      // Create an invisible point entity for tracking.\n      // It is independent of the primitive/geometry created by the vector synchronizer.\n      const options: Entity.ConstructorOptions = {\n        // @ts-ignore according to Cesium types, not possible to pass CallbackProperty\n        position: new Cesium.CallbackProperty((time, result) => toCesiumPosition(), false),\n        point: {\n          pixelSize: 1,\n          color: Cesium.Color.TRANSPARENT\n        }\n      };\n\n      this.trackedEntity_ = this.dataSourceDisplay_.defaultDataSource.entities.add(options);\n    }\n  }\n}\n\nexport default OLCesium;\n","/**\n * @module olcs.RasterSynchronizer\n */\nimport Map from 'ol/Map.js';\nimport {getUid, stableSort} from './util.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport {type LayerWithParents, tileLayerToImageryLayer, updateCesiumLayerProperties} from './core';\nimport type {Scene, ImageryLayer, ImageryLayerCollection} from 'cesium';\nimport type BaseLayer from 'ol/layer/Base.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport BaseVectorLayer from 'ol/layer/BaseVector.js';\nimport LayerGroup from 'ol/layer/Group.js';\n\nclass RasterSynchronizer extends olcsAbstractSynchronizer<ImageryLayer> {\n  private cesiumLayers_: ImageryLayerCollection;\n  private ourLayers_: ImageryLayerCollection;\n  /**\n   * This object takes care of one-directional synchronization of\n   * Openlayers raster layers to the given Cesium globe.\n   */\n  constructor(map: Map, scene: Scene) {\n    super(map, scene);\n\n    this.cesiumLayers_ = scene.imageryLayers;\n    this.ourLayers_ = new Cesium.ImageryLayerCollection();\n  }\n\n  addCesiumObject(object: ImageryLayer): void {\n    this.cesiumLayers_.add(object);\n    this.ourLayers_.add(object);\n  }\n\n  destroyCesiumObject(object: ImageryLayer): void {\n    object.destroy();\n  }\n\n  removeSingleCesiumObject(object: ImageryLayer, destroy: boolean): void {\n    this.cesiumLayers_.remove(object, destroy);\n    this.ourLayers_.remove(object, false);\n  }\n\n  removeAllCesiumObjects(destroy: boolean): void {\n    for (let i = 0; i < this.ourLayers_.length; ++i) {\n      this.cesiumLayers_.remove(this.ourLayers_.get(i), destroy);\n    }\n    this.ourLayers_.removeAll(false);\n  }\n\n  /**\n   * Creates an array of Cesium.ImageryLayer.\n   * May be overriden by child classes to implement custom behavior.\n   * The default implementation handles tiled imageries in EPSG:4326 or\n   * EPSG:3859.\n   */\n  protected convertLayerToCesiumImageries(olLayer: BaseLayer, viewProj: Projection): ImageryLayer[] {\n    const result = tileLayerToImageryLayer(this.map, olLayer, viewProj);\n    return result ? [result] : null;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): ImageryLayer[] {\n    const olLayer = olLayerWithParents.layer;\n    const uid = getUid(olLayer).toString();\n    const viewProj = this.view.getProjection();\n    console.assert(viewProj);\n    const cesiumObjects = this.convertLayerToCesiumImageries(olLayer, viewProj);\n    if (cesiumObjects) {\n      const listenKeyArray = [];\n      [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n        listenKeyArray.push(olLayerItem.on(['change:opacity', 'change:visible'], () => {\n          // the compiler does not seem to be able to infer this\n          console.assert(cesiumObjects);\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n          }\n        }));\n      });\n\n      if (olLayer instanceof BaseVectorLayer) {\n        let previousStyleFunction = olLayer.getStyleFunction();\n        // there is no convenient way to detect a style function change in OL\n        listenKeyArray.push(olLayer.on('change', () => {\n          const currentStyleFunction = olLayer.getStyleFunction();\n          if (previousStyleFunction === currentStyleFunction) {\n            return;\n          }\n          previousStyleFunction = currentStyleFunction;\n          for (let i = 0; i < cesiumObjects.length; ++i) {\n            const csObj = cesiumObjects[i];\n            // clear cache and set new style\n            // @ts-ignore TS2341\n            if (csObj._imageryCache) {\n              // @ts-ignore TS2341\n              csObj._imageryCache = {};\n            }\n\n            const ip = csObj.imageryProvider;\n            if (ip) {\n               // @ts-ignore TS2341\n               ip.tileCache?.clear();\n               // @ts-ignore TS2341\n               ip.styleFunction_ = currentStyleFunction;\n            }\n          }\n          this.scene.requestRender();\n        }));\n      }\n\n      for (let i = 0; i < cesiumObjects.length; ++i) {\n        updateCesiumLayerProperties(olLayerWithParents, cesiumObjects[i]);\n      }\n\n      // there is no way to modify Cesium layer extent,\n      // we have to recreate when OpenLayers layer extent changes:\n      listenKeyArray.push(olLayer.on('change:extent', (e) => {\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          this.cesiumLayers_.remove(cesiumObjects[i], true); // destroy\n          this.ourLayers_.remove(cesiumObjects[i], false);\n        }\n        delete this.layerMap[getUid(olLayer)]; // invalidate the map entry\n        this.synchronize();\n      }));\n\n      listenKeyArray.push(olLayer.on('change', (e) => {\n        // when the source changes, re-add the layer to force update\n        for (let i = 0; i < cesiumObjects.length; ++i) {\n          const position = this.cesiumLayers_.indexOf(cesiumObjects[i]);\n          if (position >= 0) {\n            this.cesiumLayers_.remove(cesiumObjects[i], false);\n            this.cesiumLayers_.add(cesiumObjects[i], position);\n          }\n        }\n      }));\n\n      this.olLayerListenKeys[uid].push(...listenKeyArray);\n    }\n\n    return Array.isArray(cesiumObjects) ? cesiumObjects : null;\n  }\n\n  /**\n   * Order counterparts using the same algorithm as the Openlayers renderer:\n   * z-index then original sequence order.\n   * @override\n   * @protected\n   */\n  orderLayers() {\n    const layers = [];\n    const zIndices: Record<number, number> = {};\n    const queue: Array<BaseLayer | LayerGroup> = [this.mapLayerGroup];\n\n    while (queue.length > 0) {\n      const olLayer = queue.splice(0, 1)[0];\n      layers.push(olLayer);\n      zIndices[getUid(olLayer)] = olLayer.getZIndex() || 0;\n\n      if (olLayer instanceof LayerGroup) {\n        const sublayers = olLayer.getLayers();\n        if (sublayers) {\n          // Prepend queue with sublayers in order\n          queue.unshift(...sublayers.getArray());\n        }\n      }\n    }\n\n    stableSort(layers, (layer1, layer2) =>\n      zIndices[getUid(layer1)] - zIndices[getUid(layer2)]\n    );\n\n    layers.forEach((olLayer) => {\n      const olLayerId = getUid(olLayer).toString();\n      const cesiumObjects = this.layerMap[olLayerId];\n      if (cesiumObjects) {\n        cesiumObjects.forEach((cesiumObject) => { this.raiseToTop(cesiumObject); });\n      }\n    });\n  }\n\n  raiseToTop(counterpart: ImageryLayer) {\n    this.cesiumLayers_.raiseToTop(counterpart);\n  }\n}\n\n\nexport default RasterSynchronizer;\n","/**\n * @module olcs.VectorSynchronizer\n */\nimport olSourceVector, {VectorSourceEvent} from 'ol/source/Vector.js';\nimport olLayerLayer from 'ol/layer/Layer.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {olcsListen, getUid} from './util.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olLayerVectorTile from 'ol/layer/VectorTile.js';\nimport olcsAbstractSynchronizer from './AbstractSynchronizer';\nimport olcsFeatureConverter from './FeatureConverter.js';\nimport VectorLayerCounterpart, {\n  type OlFeatureToCesiumContext,\n  type PrimitiveCollectionCounterpart\n} from './core/VectorLayerCounterpart';\nimport type Map from 'ol/Map.js';\nimport {type LayerWithParents} from './core';\nimport Feature from 'ol/Feature.js';\nimport BaseLayer from 'ol/layer/Base.js';\nimport {Primitive, PrimitiveCollection, Scene} from 'cesium';\n\nclass VectorSynchronizer extends olcsAbstractSynchronizer<VectorLayerCounterpart> {\n  protected converter: olcsFeatureConverter;\n  private csAllPrimitives_: PrimitiveCollection\n  /**\n   * Unidirectionally synchronize OpenLayers vector layers to Cesium.\n   */\n  constructor(map: Map, scene: Scene, opt_converter?: olcsFeatureConverter) {\n    super(map, scene);\n\n    this.converter = opt_converter || new olcsFeatureConverter(scene);\n    this.csAllPrimitives_ = new Cesium.PrimitiveCollection();\n    scene.primitives.add(this.csAllPrimitives_);\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  addCesiumObject(counterpart: VectorLayerCounterpart) {\n    console.assert(counterpart);\n    const collection = <PrimitiveCollectionCounterpart>counterpart.getRootPrimitive()\n    collection.counterpart = counterpart;\n    this.csAllPrimitives_.add(counterpart.getRootPrimitive());\n  }\n\n  destroyCesiumObject(object: VectorLayerCounterpart) {\n    object.getRootPrimitive().destroy();\n  }\n\n  removeSingleCesiumObject(object: VectorLayerCounterpart, destroy: boolean) {\n    object.destroy();\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    this.csAllPrimitives_.remove(object.getRootPrimitive());\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  removeAllCesiumObjects(destroy: boolean) {\n    this.csAllPrimitives_.destroyPrimitives = destroy;\n    if (destroy) {\n      for (let i = 0; i < this.csAllPrimitives_.length; ++i) {\n        this.csAllPrimitives_.get(i)['counterpart'].destroy();\n      }\n    }\n    this.csAllPrimitives_.removeAll();\n    this.csAllPrimitives_.destroyPrimitives = false;\n  }\n\n  /**\n   * Synchronizes the layer visibility properties\n   * to the given Cesium Primitive.\n   */\n  updateLayerVisibility(olLayerWithParents: LayerWithParents, csPrimitive: PrimitiveCollection) {\n    let visible = true;\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n      const layerVisible = olLayer.getVisible();\n      if (layerVisible !== undefined) {\n        visible = visible && layerVisible;\n      } else {\n        visible = false;\n      }\n    });\n    csPrimitive.show = visible;\n  }\n\n  createSingleLayerCounterparts(olLayerWithParents: LayerWithParents): VectorLayerCounterpart[] {\n    const olLayer: BaseLayer = olLayerWithParents.layer;\n    if (!(olLayer instanceof olLayerVector) || olLayer instanceof olLayerVectorTile) {\n      return null;\n    }\n    console.assert(olLayer instanceof olLayerLayer);\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    if (!source) {\n      return null;\n    }\n\n    console.assert(source instanceof olSourceVector);\n    console.assert(this.view);\n\n    const view = this.view;\n    const featurePrimitiveMap: Record<number, Primitive> = {};\n    const counterpart: VectorLayerCounterpart = this.converter.olVectorLayerToCesium(olLayer, view,\n        featurePrimitiveMap);\n    const csPrimitives = counterpart.getRootPrimitive();\n    const olListenKeys = counterpart.olListenKeys;\n\n    [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayerItem) => {\n      olListenKeys.push(olcsListen(olLayerItem, 'change:visible', () => {\n        this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n      }));\n    });\n    this.updateLayerVisibility(olLayerWithParents, csPrimitives);\n\n    const onAddFeature = (function(feature: Feature) {\n      const context = counterpart.context;\n      const prim: Primitive = this.converter.convert(olLayer, view, feature, context);\n      if (prim) {\n        featurePrimitiveMap[getUid(feature)] = prim;\n        csPrimitives.add(prim);\n      }\n    }).bind(this);\n\n    const onRemoveFeature = (function(feature: Feature) {\n      const id = getUid(feature);\n      const context: OlFeatureToCesiumContext = counterpart.context;\n      const bbs = context.featureToCesiumMap[id];\n      if (bbs) {\n        delete context.featureToCesiumMap[id];\n        bbs.forEach((bb) => {\n          if (bb instanceof Cesium.Billboard) {\n            context.billboards.remove(bb);\n          }\n        });\n      }\n      const csPrimitive = featurePrimitiveMap[id];\n      delete featurePrimitiveMap[id];\n      if (csPrimitive) {\n        csPrimitives.remove(csPrimitive);\n      }\n    }).bind(this);\n\n    olListenKeys.push(olcsListen(source, 'addfeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onAddFeature(e.feature);\n    }));\n\n    olListenKeys.push(olcsListen(source, 'removefeature', (e: VectorSourceEvent) => {\n      console.assert(e.feature);\n      onRemoveFeature(e.feature);\n    }));\n\n    olListenKeys.push(olcsListen(source, 'changefeature', (e: VectorSourceEvent) => {\n      const feature = e.feature;\n      console.assert(feature);\n      onRemoveFeature(feature);\n      onAddFeature(feature);\n    }));\n\n    return counterpart ? [counterpart] : null;\n  }\n}\n\nexport default VectorSynchronizer;\n","/**\n * @module olcs.core\n */\nimport {linear as linearEasing} from 'ol/easing.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerImage from 'ol/layer/Image.js';\nimport {get as getProjection, type ProjectionLike, transformExtent} from 'ol/proj.js';\nimport olSourceImageStatic from 'ol/source/ImageStatic.js';\nimport olSourceImageWMS from 'ol/source/ImageWMS.js';\nimport olSourceTileImage from 'ol/source/TileImage.js';\nimport olSourceTileWMS from 'ol/source/TileWMS.js';\nimport olSourceVectorTile from 'ol/source/VectorTile.js';\nimport {defaultImageLoadFunction} from 'ol/source/Image.js';\nimport olcsCoreOLImageryProvider from './core/OLImageryProvider.js';\nimport {getSourceProjection} from './util.js';\nimport MVTImageryProvider from './MVTImageryProvider.js';\nimport VectorTileLayer from 'ol/layer/VectorTile.js';\nimport {type Extent, getCenter as getExtentCenter} from 'ol/extent.js';\nimport BaseLayer from 'ol/layer/Base.js';\nimport LayerGroup from 'ol/layer/Group.js';\nimport type {\n  BoundingSphere,\n  Camera,\n  Cartesian2,\n  Cartesian3,\n  Cartographic,\n  Color, ImageMaterialProperty,\n  ImageryLayer,\n  Matrix4,\n  Ray,\n  Rectangle,\n  Scene,\n  SingleTileImageryProvider\n} from 'cesium';\nimport Geometry from 'ol/geom/Geometry.js';\nimport type {Coordinate} from 'ol/coordinate.js';\nimport Source from 'ol/source/Source.js';\n// eslint-disable-next-line no-duplicate-imports\nimport type {Attribution} from 'ol/source/Source.js';\n\nimport Map from 'ol/Map.js';\nimport Projection from 'ol/proj/Projection.js';\nimport type {Color as OLColor} from 'ol/color.js';\nimport View from 'ol/View.js';\n\ntype CesiumUrlDefinition = {\n    url: string,\n    subdomains: string\n}\n\n\n/**\n * Options for rotate around axis core function.\n */\ntype RotateAroundAxisOption = {\n  duration?: number,\n  easing?: (value: number) => number,\n  callback: () => void\n}\n\n\nexport type LayerWithParents = {\n  layer: BaseLayer,\n  parents: LayerGroup[] | BaseLayer[]\n}\n\n\n/**\n * Compute the pixel width and height of a point in meters using the\n * camera frustum.\n */\nexport function computePixelSizeAtCoordinate(scene: Scene, target: Cartesian3): Cartesian2 {\n  const camera = scene.camera;\n  const canvas = scene.canvas;\n  const frustum = camera.frustum;\n  const distance = Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(\n      camera.position, target, new Cesium.Cartesian3()));\n  // @ts-ignore TS2341\n  return frustum.getPixelDimensions(canvas.clientWidth, canvas.clientHeight, distance, scene.pixelRatio, new Cesium.Cartesian2());\n}\n\n\n/**\n * Compute bounding box around a target point.\n * @param {!Cesium.Scene} scene\n * @param {!Cesium.Cartesian3} target\n * @param {number} amount Half the side of the box, in pixels.\n * @return {Array<Cesium.Cartographic>} bottom left and top right\n * coordinates of the box\n */\nexport function computeBoundingBoxAtTarget(scene: Scene, target: Cartesian3, amount: number): Cartographic[] {\n  const pixelSize = computePixelSizeAtCoordinate(scene, target);\n  const transform = Cesium.Transforms.eastNorthUpToFixedFrame(target);\n\n  const bottomLeft = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(-pixelSize.x * amount, -pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  const topRight = Cesium.Matrix4.multiplyByPoint(\n      transform,\n      new Cesium.Cartesian3(pixelSize.x * amount, pixelSize.y * amount, 0),\n      new Cesium.Cartesian3());\n\n  return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray(\n      [bottomLeft, topRight]);\n}\n\nexport function applyHeightOffsetToGeometry(geometry: Geometry, height: number) {\n  geometry.applyTransform((input, output, stride) => {\n    console.assert(input === output);\n    if (stride !== undefined && stride >= 3) {\n      for (let i = 0; i < output.length; i += stride) {\n        output[i + 2] = output[i + 2] + height;\n      }\n    }\n    return output;\n  });\n}\n\nexport function createMatrixAtCoordinates(\n    coordinates: Coordinate,\n    rotation = 0,\n    translation = Cesium.Cartesian3.ZERO,\n    scale = new Cesium.Cartesian3(1, 1, 1)\n): Matrix4 {\n  const position = ol4326CoordinateToCesiumCartesian(coordinates);\n  const rawMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position);\n  const quaternion = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, -rotation);\n  const rotationMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(translation, quaternion, scale);\n  return Cesium.Matrix4.multiply(rawMatrix, rotationMatrix, new Cesium.Matrix4());\n}\n\nexport function rotateAroundAxis(camera: Camera, angle: number, axis: Cartesian3, transform: Matrix4,\n    opt_options?: RotateAroundAxisOption) {\n  const clamp = Cesium.Math.clamp;\n  const defaultValue = Cesium.defaultValue;\n\n  const options: RotateAroundAxisOption = opt_options;\n  const duration = defaultValue(options?.duration, 500); // ms\n  const easing = defaultValue(options?.easing, linearEasing);\n  const callback = options?.callback;\n\n  let lastProgress = 0;\n  const oldTransform = new Cesium.Matrix4();\n\n  const start = Date.now();\n  const step = function() {\n    const timestamp = Date.now();\n    const timeDifference = timestamp - start;\n    const progress = easing(clamp(timeDifference / duration, 0, 1));\n    console.assert(progress >= lastProgress);\n\n    camera.transform.clone(oldTransform);\n    const stepAngle = (progress - lastProgress) * angle;\n    lastProgress = progress;\n    camera.lookAtTransform(transform);\n    camera.rotate(axis, stepAngle);\n    camera.lookAtTransform(oldTransform);\n\n    if (progress < 1) {\n      window.requestAnimationFrame(step);\n    } else {\n      if (callback) {\n        callback();\n      }\n    }\n  };\n  window.requestAnimationFrame(step);\n}\n\nexport function setHeadingUsingBottomCenter(\n    scene: Scene,\n    heading: number,\n    bottomCenter: Cartesian3,\n    options?: RotateAroundAxisOption\n) {\n  const camera = scene.camera;\n  // Compute the camera position to zenith quaternion\n  const angleToZenith = computeAngleToZenith(scene, bottomCenter);\n  const axis = camera.right;\n  const quaternion = Cesium.Quaternion.fromAxisAngle(axis, angleToZenith);\n  const rotation = Cesium.Matrix3.fromQuaternion(quaternion);\n\n  // Get the zenith point from the rotation of the position vector\n  const vector = new Cesium.Cartesian3();\n  Cesium.Cartesian3.subtract(camera.position, bottomCenter, vector);\n  const zenith = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(rotation, vector, zenith);\n  Cesium.Cartesian3.add(zenith, bottomCenter, zenith);\n\n  // Actually rotate around the zenith normal\n  const transform = Cesium.Matrix4.fromTranslation(zenith);\n  rotateAroundAxis(camera, heading, zenith, transform, options);\n}\n\n\n/**\n * Get the 3D position of the given pixel of the canvas.\n */\nexport function pickOnTerrainOrEllipsoid(scene: Scene, pixel: Cartesian2): Cartesian3 {\n  const ray = scene.camera.getPickRay(pixel);\n  const target = scene.globe.pick(ray, scene);\n  return target || scene.camera.pickEllipsoid(pixel);\n}\n\n\n/**\n * Get the 3D position of the point at the bottom-center of the screen.\n */\nexport function pickBottomPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const bottom = new Cesium.Cartesian2(\n      canvas.clientWidth / 2, canvas.clientHeight);\n  return pickOnTerrainOrEllipsoid(scene, bottom);\n}\n\n\n/**\n * Get the 3D position of the point at the center of the screen.\n */\nexport function pickCenterPoint(scene: Scene): Cartesian3 | undefined {\n  const canvas = scene.canvas;\n  const center = new Cesium.Cartesian2(\n      canvas.clientWidth / 2,\n      canvas.clientHeight / 2);\n  return pickOnTerrainOrEllipsoid(scene, center);\n}\n\n\n/**\n * Compute the signed tilt angle on globe, between the opposite of the\n * camera direction and the target normal. Return undefined if there is no\n */\nexport function computeSignedTiltAngleOnGlobe(scene: Scene): number | undefined {\n  const camera = scene.camera;\n  const ray = new Cesium.Ray(camera.position, camera.direction);\n  let target = scene.globe.pick(ray, scene);\n\n  if (!target) {\n    // no tiles in the area were loaded?\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const obj = Cesium.IntersectionTests.rayEllipsoid(ray, ellipsoid);\n    if (obj) {\n      target = Cesium.Ray.getPoint(ray, obj.start);\n    }\n  }\n\n  if (!target) {\n    return undefined;\n  }\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(target, normal);\n\n  const angleBetween = signedAngleBetween;\n  const angle = angleBetween(camera.direction, normal, camera.right) - Math.PI;\n  return Cesium.Math.convertLongitudeRange(angle);\n}\n\n\n/**\n * Compute the ray from the camera to the bottom-center of the screen.\n */\nexport function bottomFovRay(scene: Scene): Ray {\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy2 = camera.frustum.fovy / 2;\n  const direction = camera.direction;\n  const rotation = Cesium.Quaternion.fromAxisAngle(camera.right, fovy2);\n  const matrix = Cesium.Matrix3.fromQuaternion(rotation);\n  const vector = new Cesium.Cartesian3();\n  Cesium.Matrix3.multiplyByVector(matrix, direction, vector);\n  return new Cesium.Ray(camera.position, vector);\n}\n\n\n/**\n * Compute the angle between two Cartesian3.\n */\nexport function signedAngleBetween(first: Cartesian3, second: Cartesian3, normal: Cartesian3): number {\n  // We are using the dot for the angle.\n  // Then the cross and the dot for the sign.\n  const a = new Cesium.Cartesian3();\n  const b = new Cesium.Cartesian3();\n  const c = new Cesium.Cartesian3();\n  Cesium.Cartesian3.normalize(first, a);\n  Cesium.Cartesian3.normalize(second, b);\n  Cesium.Cartesian3.cross(a, b, c);\n\n  const cosine = Cesium.Cartesian3.dot(a, b);\n  const sine = Cesium.Cartesian3.magnitude(c);\n\n  // Sign of the vector product and the orientation normal\n  const sign = Cesium.Cartesian3.dot(normal, c);\n  const angle = Math.atan2(sine, cosine);\n  return sign >= 0 ? angle : -angle;\n}\n\n\n/**\n * Compute the rotation angle around a given point, needed to reach the\n * zenith position.\n * At a zenith position, the camera direction is going througth the earth\n * center and the frustrum bottom ray is going through the chosen pivot\n * point.\n * The bottom-center of the screen is a good candidate for the pivot point.\n */\nexport function computeAngleToZenith(scene: Scene, pivot: Cartesian3): number {\n  // This angle is the sum of the angles 'fy' and 'a', which are defined\n  // using the pivot point and its surface normal.\n  //        Zenith |    camera\n  //           \\   |   /\n  //            \\fy|  /\n  //             \\ |a/\n  //              \\|/pivot\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fy = camera.frustum.fovy / 2;\n  const ray = bottomFovRay(scene);\n  const direction = Cesium.Cartesian3.clone(ray.direction);\n  Cesium.Cartesian3.negate(direction, direction);\n\n  const normal = new Cesium.Cartesian3();\n  Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(pivot, normal);\n\n  const left = new Cesium.Cartesian3();\n  Cesium.Cartesian3.negate(camera.right, left);\n\n  const a = signedAngleBetween(normal, direction, left);\n  return a + fy;\n}\n\n\n/**\n * Convert an OpenLayers extent to a Cesium rectangle.\n * @param {ol.Extent} extent Extent.\n * @param {ol.ProjectionLike} projection Extent projection.\n * @return {Cesium.Rectangle} The corresponding Cesium rectangle.\n */\nexport function extentToRectangle(extent: Extent, projection: ProjectionLike) {\n  if (extent && projection) {\n    const ext = transformExtent(extent, projection, 'EPSG:4326');\n    return Cesium.Rectangle.fromDegrees(ext[0], ext[1], ext[2], ext[3]);\n  } else {\n    return null;\n  }\n}\n\nexport function sourceToImageryProvider(\n    olMap: Map,\n    source: Source,\n    viewProj: Projection,\n    olLayer: BaseLayer\n): olcsCoreOLImageryProvider | MVTImageryProvider | SingleTileImageryProvider {\n  const skip = source.get('olcs_skip');\n  if (skip) {\n    return null;\n  }\n  let provider = null;\n  // Convert ImageWMS to TileWMS\n  if (source instanceof olSourceImageWMS && source.getUrl() &&\n  source.getImageLoadFunction() === defaultImageLoadFunction) {\n    const sourceProps = {\n      'olcs.proxy': source.get('olcs.proxy'),\n      'olcs.extent': source.get('olcs.extent'),\n      'olcs.projection': source.get('olcs.projection'),\n      'olcs.imagesource': source\n    };\n    source = new olSourceTileWMS({\n      url: source.getUrl(),\n      attributions: source.getAttributions(),\n      projection: source.getProjection(),\n      params: source.getParams()\n    });\n    source.setProperties(sourceProps);\n  }\n\n  if (source instanceof olSourceTileImage) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n    // if not explicit, assume the same projection as view\n      projection = viewProj;\n    }\n\n    if (isCesiumProjection(projection)) {\n      provider = new olcsCoreOLImageryProvider(olMap, source, viewProj);\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceImageStatic) {\n    let projection = getSourceProjection(source);\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (isCesiumProjection(projection)) {\n      const rectangle: Rectangle = Cesium.Rectangle.fromDegrees(\n          source.getImageExtent()[0],\n          source.getImageExtent()[1],\n          source.getImageExtent()[2],\n          source.getImageExtent()[3],\n          new Cesium.Rectangle()\n      )\n      provider = new Cesium.SingleTileImageryProvider({\n        url: source.getUrl(),\n        rectangle\n      });\n    }\n    // Projection not supported by Cesium\n    else {\n      return null;\n    }\n  } else if (source instanceof olSourceVectorTile && olLayer instanceof VectorTileLayer) {\n    let projection = getSourceProjection(source);\n\n    if (!projection) {\n      projection = viewProj;\n    }\n    if (skip === false) {\n    // MVT is experimental, it should be whitelisted to be synchronized\n      const fromCode = projection.getCode().split(':')[1];\n      // @ts-ignore TS2341\n      const urls = source.urls.map(u => u.replace(fromCode, '3857'));\n      const extent = olLayer.getExtent();\n      const rectangle = extentToRectangle(extent, projection);\n      const minimumLevel = source.get('olcs_minimumLevel');\n      const attributionsFunction = source.getAttributions();\n      const styleFunction = olLayer.getStyleFunction();\n      let credit;\n      if (extent && attributionsFunction) {\n        const center = getExtentCenter(extent);\n        credit = attributionsFunctionToCredits(attributionsFunction, 0, center, extent)[0];\n      }\n\n      provider = new MVTImageryProvider({\n        credit,\n        rectangle,\n        minimumLevel,\n        styleFunction,\n        urls\n      });\n      return provider;\n    }\n    return null; // FIXME: it is disabled by default right now\n  } else {\n    // sources other than TileImage|Imageexport function are currently not supported\n    return null;\n  }\n  return provider;\n}\n\n/**\n * Creates Cesium.ImageryLayer best corresponding to the given ol.layer.Layer.\n * Only supports raster layers and export function images\n */\nexport function tileLayerToImageryLayer(olMap: Map, olLayer: BaseLayer, viewProj: Projection): ImageryLayer | null  {\n\n  if (!(olLayer instanceof olLayerTile) && !(olLayer instanceof olLayerImage) &&\n  !(olLayer instanceof VectorTileLayer)) {\n    return null;\n  }\n\n  const source = olLayer.getSource();\n  if (!source) {\n    return null;\n  }\n  let provider = source.get('olcs_provider');\n  if (!provider) {\n    provider = sourceToImageryProvider(olMap, source, viewProj, olLayer);\n  }\n  if (!provider) {\n    return null;\n  }\n\n  const layerOptions: {rectangle?: Rectangle} = {};\n\n  const forcedExtent = (olLayer.get('olcs.extent'));\n  const ext = forcedExtent || olLayer.getExtent();\n  if (ext) {\n    layerOptions.rectangle = extentToRectangle(ext, viewProj);\n  }\n\n  const cesiumLayer = new Cesium.ImageryLayer(provider, layerOptions);\n  return cesiumLayer;\n}\n\n\n/**\n * Synchronizes the layer rendering properties (opacity, visible)\n * to the given Cesium ImageryLayer.\n */\nexport function updateCesiumLayerProperties(olLayerWithParents: LayerWithParents, csLayer: ImageryLayer) {\n  let opacity = 1;\n  let visible = true;\n  [olLayerWithParents.layer].concat(olLayerWithParents.parents).forEach((olLayer) => {\n    const layerOpacity = olLayer.getOpacity();\n    if (layerOpacity !== undefined) {\n      opacity *= layerOpacity;\n    }\n    const layerVisible = olLayer.getVisible();\n    if (layerVisible !== undefined) {\n      visible = visible && layerVisible;\n    }\n  });\n  csLayer.alpha = opacity;\n  csLayer.show = visible;\n}\n\n\n/**\n * Convert a 2D or 3D OpenLayers coordinate to Cesium.\n */\nexport function ol4326CoordinateToCesiumCartesian(coordinate: Coordinate): Cartesian3 {\n  const coo = coordinate;\n  return coo.length > 2 ?\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1], coo[2]) :\n    Cesium.Cartesian3.fromDegrees(coo[0], coo[1]);\n}\n\n\n/**\n * Convert an array of 2D or 3D OpenLayers coordinates to Cesium.\n */\nexport function ol4326CoordinateArrayToCsCartesians(coordinates: Coordinate[]): Cartesian3[] {\n  console.assert(coordinates !== null);\n  const toCartesian = ol4326CoordinateToCesiumCartesian;\n  const cartesians = [];\n  for (let i = 0; i < coordinates.length; ++i) {\n    cartesians.push(toCartesian(coordinates[i]));\n  }\n  return cartesians;\n}\n\n\n/**\n * Reproject an OpenLayers geometry to EPSG:4326 if needed.\n * The geometry will be cloned only when original projection is not EPSG:4326\n * and the properties will be shallow copied.\n */\nexport function olGeometryCloneTo4326<T>(geometry: Geometry, projection: ProjectionLike): T | Geometry {\n  console.assert(projection);\n\n  const proj4326 = getProjection('EPSG:4326');\n  const proj = getProjection(projection);\n  if (proj.getCode() !== proj4326.getCode()) {\n    const properties = geometry.getProperties();\n    geometry = geometry.clone();\n    geometry.transform(proj, proj4326);\n    geometry.setProperties(properties);\n  }\n  return geometry;\n}\n\n\n/**\n * Convert an OpenLayers color to Cesium.\n */\nexport function convertColorToCesium(olColor: OLColor | CanvasGradient | CanvasPattern | string): Color | ImageMaterialProperty {\n  olColor = olColor || 'black';\n  if (Array.isArray(olColor)) {\n    return new Cesium.Color(\n        Cesium.Color.byteToFloat(olColor[0]),\n        Cesium.Color.byteToFloat(olColor[1]),\n        Cesium.Color.byteToFloat(olColor[2]),\n        olColor[3]\n    );\n  } else if (typeof olColor == 'string') {\n    return Cesium.Color.fromCssColorString(olColor);\n  } else if (olColor instanceof CanvasPattern || olColor instanceof CanvasGradient) {\n    // Render the CanvasPattern/CanvasGradient into a canvas that will be sent to Cesium as material\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    canvas.width = canvas.height = 256;\n    ctx.fillStyle = olColor;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    return new Cesium.ImageMaterialProperty({\n      image: canvas\n    });\n  }\n  console.assert(false, 'impossible');\n}\n\n\n/**\n * Convert an OpenLayers url to Cesium.\n */\nexport function convertUrlToCesium(url: string): CesiumUrlDefinition {\n  let subdomains = '';\n  const re = /\\{(\\d|[a-z])-(\\d|[a-z])\\}/;\n  const match = re.exec(url);\n  if (match) {\n    url = url.replace(re, '{s}');\n    const startCharCode = match[1].charCodeAt(0);\n    const stopCharCode = match[2].charCodeAt(0);\n    let charCode;\n    for (charCode = startCharCode; charCode <= stopCharCode; ++charCode) {\n      subdomains += String.fromCharCode(charCode);\n    }\n  }\n  return {\n    url,\n    subdomains\n  };\n}\n\n\n/**\n * Animate the return to a top-down view from the zenith.\n * The camera is rotated to orient to the North.\n */\nexport function resetToNorthZenith(map: Map, scene: Scene): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('Could not get bottom pivot');\n      return;\n    }\n\n    const currentHeading = map.getView().getRotation();\n    if (currentHeading === undefined) {\n      reject('The view is not initialized');\n      return;\n    }\n    const angle = computeAngleToZenith(scene, pivot);\n\n    // Point to North\n    setHeadingUsingBottomCenter(scene, currentHeading, pivot);\n\n    // Go to zenith\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    const options: RotateAroundAxisOption = {\n      callback: () => {\n        const view = map.getView();\n        normalizeView(view);\n        resolve(undefined);\n      }\n    };\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * @param {!Cesium.Scene} scene\n * @param {number} angle in radian\n * @return {Promise<undefined>}\n * @api\n */\nexport function rotateAroundBottomCenter(scene: Scene, angle: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    const camera = scene.camera;\n    const pivot = pickBottomPoint(scene);\n    if (!pivot) {\n      reject('could not get bottom pivot');\n      return;\n    }\n\n    const options: RotateAroundAxisOption = {callback: () => resolve(undefined)};\n    const transform = Cesium.Matrix4.fromTranslation(pivot);\n    const axis = camera.right;\n    rotateAroundAxis(camera, -angle, axis, transform, options);\n  });\n}\n\n\n/**\n * Set the OpenLayers view to a specific rotation and\n * the nearest resolution.\n */\nexport function normalizeView(view: View, angle = 0) {\n  const resolution = view.getResolution();\n  view.setRotation(angle);\n\n  // @ts-ignore TS2341\n  if (view.constrainResolution) {\n    // @ts-ignore TS2341\n    view.setResolution(view.constrainResolution(resolution));\n  } else {\n    view.setResolution(view.getConstrainedResolution(resolution));\n  }\n}\n\n/**\n * Check if the given projection is managed by Cesium (WGS84 or Mercator Spheric)\n */\nexport function isCesiumProjection(projection: Projection): boolean {\n  const is3857 = projection.getCode() === 'EPSG:3857';\n  const is4326 = projection.getCode() === 'EPSG:4326';\n  return is3857 || is4326;\n}\n\nexport function attributionsFunctionToCredits(\n    attributionsFunction: Attribution | null,\n    zoom: number,\n    center: Coordinate,\n    extent: Extent\n) {\n\n  if (!attributionsFunction) {\n    return [];\n  }\n  let attributions = attributionsFunction({\n    viewState: {zoom, center, projection: undefined, resolution: undefined, rotation: undefined},\n    extent,\n  });\n  if (!Array.isArray(attributions)) {\n    attributions = [attributions];\n  }\n\n  return attributions.map(html => new Cesium.Credit(html, true));\n}\n\n/**\n * calculate the distance between camera and centerpoint based on the resolution and latitude value\n */\nexport function calcDistanceForResolution(\n    resolution: number,\n    latitude: number,\n    scene: Scene,\n    projection: Projection\n): number {\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  // number of \"map units\" visible in 2D (vertically)\n  const visibleMapUnits = resolution * canvas.clientHeight;\n\n  // The metersPerUnit does not take latitude into account, but it should\n  // be lower with increasing latitude -- we have to compensate.\n  // In 3D it is not possible to maintain the resolution at more than one point,\n  // so it only makes sense to use the latitude of the \"target\" point.\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n\n  // how many meters should be visible in 3D\n  const visibleMeters = visibleMapUnits * metersPerUnit * relativeCircumference;\n\n  // distance required to view the calculated length in meters\n  //\n  //  fovy/2\n  //    |\\\n  //  x | \\\n  //    |--\\\n  // visibleMeters/2\n  const requiredDistance = (visibleMeters / 2) / Math.tan(fovy / 2);\n\n  // NOTE: This calculation is not absolutely precise, because metersPerUnit\n  // is a great simplification. It does not take ellipsoid/terrain into account.\n\n  return requiredDistance;\n}\n\n/**\n * calculate the resolution based on a distance(camera to position) and latitude value\n */\nexport function calcResolutionForDistance(distance: number, latitude: number, scene: Scene, projection: Projection): number {\n  // See the reverse calculation (calcDistanceForResolution) for details\n  const canvas = scene.canvas;\n  const camera = scene.camera;\n  // @ts-ignore TS2341\n  const fovy = camera.frustum.fovy; // vertical field of view\n  console.assert(!isNaN(fovy));\n  const metersPerUnit = projection.getMetersPerUnit();\n\n  const visibleMeters = 2 * distance * Math.tan(fovy / 2);\n  const relativeCircumference = Math.cos(Math.abs(latitude));\n  const visibleMapUnits = visibleMeters / metersPerUnit / relativeCircumference;\n  const resolution = visibleMapUnits / canvas.clientHeight;\n\n  return resolution;\n}\n\n/**\n * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n * Near the ground the allowed distance is shorter.\n */\nexport function limitCameraToBoundingSphere(camera: Camera, boundingSphere: BoundingSphere, ratio: (height: number) => number): () => void {\n  let blockLimiter = false;\n  return function () {\n    if (!blockLimiter) {\n      const position = camera.position;\n      const carto = Cesium.Cartographic.fromCartesian(position);\n      if (Cesium.Cartesian3.distance(boundingSphere.center, position) > boundingSphere.radius * ratio(carto.height)) {\n        // @ts-ignore TS2339: FIXME, there is no flying property in Camera\n        const currentlyFlying = camera.flying;\n        if (currentlyFlying === true) {\n          // There is a flying property and its value is true\n          return;\n        } else {\n          blockLimiter = true;\n          const unblockLimiter = () => (blockLimiter = false);\n          camera.flyToBoundingSphere(boundingSphere, {\n            complete: unblockLimiter,\n            cancel: unblockLimiter,\n          });\n        }\n      }\n    }\n  };\n}\n","/**\n * @module olcs.core.VectorLayerCounterpart\n */\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport type Projection from 'ol/proj/Projection.js';\nimport type {Billboard, BillboardCollection, Primitive, PrimitiveCollection, Scene} from 'cesium';\nimport type {EventsKey} from 'ol/events.js';\n\n\n/**\n * Context for feature conversion.\n */\nexport type OlFeatureToCesiumContext = {\n  projection: Projection | string,\n  billboards: BillboardCollection,\n  featureToCesiumMap: Record<number, Array<Primitive | Billboard>>,\n  primitives: PrimitiveCollection\n};\n\nexport type PrimitiveCollectionCounterpart = PrimitiveCollection & {counterpart: VectorLayerCounterpart};\n\n\nclass VectorLayerCounterpart {\n  olListenKeys: EventsKey[] = []\n  context: OlFeatureToCesiumContext;\n  private rootCollection_: PrimitiveCollection;\n  /**\n  * Result of the conversion of an OpenLayers layer to Cesium.\n  */\n  constructor(layerProjection: Projection | string, scene: Scene) {\n    const billboards = new Cesium.BillboardCollection({scene});\n    const primitives = new Cesium.PrimitiveCollection();\n    this.rootCollection_ = new Cesium.PrimitiveCollection();\n    this.context = {\n      projection: layerProjection,\n      billboards,\n      featureToCesiumMap: {},\n      primitives\n    };\n\n    this.rootCollection_.add(billboards);\n    this.rootCollection_.add(primitives);\n  }\n\n  /**\n  * Unlisten.\n  */\n  destroy() {\n    this.olListenKeys.forEach(olObservableUnByKey);\n    this.olListenKeys.length = 0;\n  }\n\n  getRootPrimitive(): PrimitiveCollection {\n    return this.rootCollection_;\n  }\n}\n\n\nexport default VectorLayerCounterpart;\n","module.exports = ol.Observable;","module.exports = ol.Overlay;","module.exports = ol.easing;","module.exports = ol.extent;","module.exports = ol.format.MVT;","module.exports = ol.geom.Geometry;","module.exports = ol.geom.Point;","module.exports = ol.geom.Polygon;","module.exports = ol.geom.SimpleGeometry;","module.exports = ol.layer.BaseVector;","module.exports = ol.layer.Group;","module.exports = ol.layer.Image;","module.exports = ol.layer.Layer;","module.exports = ol.layer.Tile;","module.exports = ol.layer.Vector;","module.exports = ol.layer.VectorTile;","module.exports = ol.proj;","module.exports = ol.render;","module.exports = ol.source;","module.exports = ol.source.Cluster;","module.exports = ol.source.Image;","module.exports = ol.source.ImageStatic;","module.exports = ol.source.ImageWMS;","module.exports = ol.source.TileImage;","module.exports = ol.source.TileWMS;","module.exports = ol.source.Vector;","module.exports = ol.source.VectorTile;","module.exports = ol.structs.LRUCache;","module.exports = ol.style.Icon;","module.exports = ol.style.Stroke;","module.exports = ol.style.Style;","module.exports = ol.tilegrid;","module.exports = ol.tileurlfunction;","module.exports = ol.util;","/**\n * @module olcs.AutoRenderLoop\n */\n\nclass AutoRenderLoop {\n  /**\n   * @constructor\n   * @param {olcs.OLCesium} ol3d\n   */\n  constructor(ol3d) {\n    this.ol3d = ol3d;\n    this.scene_ = ol3d.getCesiumScene();\n    this.canvas_ = this.scene_.canvas;\n    this._boundNotifyRepaintRequired = this.notifyRepaintRequired.bind(this);\n\n    this.repaintEventNames_ = [\n      'mousemove', 'mousedown', 'mouseup',\n      'touchstart', 'touchend', 'touchmove',\n      'pointerdown', 'pointerup', 'pointermove',\n      'wheel'\n    ];\n\n    this.enable();\n  }\n\n  /**\n   * Enable.\n   */\n  enable() {\n    this.scene_.requestRenderMode = true;\n    this.scene_.maximumRenderTimeChange = 1000;\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.addEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.addEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    // Listen for changes on the layer group\n    this.ol3d.getOlMap().getLayerGroup().on('change', this._boundNotifyRepaintRequired);\n  }\n\n  /**\n   * Disable.\n   */\n  disable() {\n    for (const repaintKey of this.repaintEventNames_) {\n      this.canvas_.removeEventListener(repaintKey, this._boundNotifyRepaintRequired, false);\n    }\n\n    window.removeEventListener('resize', this._boundNotifyRepaintRequired, false);\n\n    this.ol3d.getOlMap().getLayerGroup().un('change', this._boundNotifyRepaintRequired);\n    this.scene_.requestRenderMode = false;\n  }\n\n  /**\n   * Restart render loop.\n   * Force a restart of the render loop.\n   * @api\n   */\n  restartRenderLoop() {\n    this.notifyRepaintRequired();\n  }\n\n  notifyRepaintRequired() {\n    this.scene_.requestRender();\n  }\n}\n\n\nexport default AutoRenderLoop;\n","/**\n * @module olcs.Camera\n */\n\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\nimport {toRadians, toDegrees} from './math.js';\nimport {getTransform} from 'ol/proj.js';\nimport {pickCenterPoint, calcDistanceForResolution, calcResolutionForDistance} from './core.ts';\n\nclass Camera {\n  /**\n   * This object takes care of additional 3d-specific properties of the view and\n   * ensures proper synchronization with the underlying raw Cesium.Camera object.\n   * @param {!Cesium.Scene} scene\n   * @param {!ol.Map} map\n   * @api\n   */\n  constructor(scene, map) {\n    /**\n     * @type {!Cesium.Scene}\n     * @private\n     */\n    this.scene_ = scene;\n\n    /**\n     * @type {!Cesium.Camera}\n     * @private\n     */\n    this.cam_ = scene.camera;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = map;\n\n    /**\n     * @type {?ol.View}\n     * @private\n     */\n    this.view_ = null;\n\n    /**\n     * @type {?ol.EventsKey}\n     * @private\n     */\n    this.viewListenKey_ = null;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.toLonLat_ = Camera.identityProjection;\n\n    /**\n     * @type {!ol.TransformFunction}\n     * @private\n     */\n    this.fromLonLat_ = Camera.identityProjection;\n\n    /**\n     * 0 -- topdown, PI/2 -- the horizon\n     * @type {number}\n     * @private\n     */\n    this.tilt_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.distance_ = 0;\n\n    /**\n     * @type {?Cesium.Matrix4}\n     * @private\n     */\n    this.lastCameraViewMatrix_ = null;\n\n    /**\n     * This is used to discard change events on view caused by updateView method.\n     * @type {boolean}\n     * @private\n     */\n    this.viewUpdateInProgress_ = false;\n\n    this.map_.on('change:view', (e) => {\n      this.setView_(this.map_.getView());\n    });\n    this.setView_(this.map_.getView());\n  }\n\n  destroy() {\n    olObservableUnByKey(this.viewListenKey_);\n    this.viewListenKey_ = null;\n  }\n\n  /**\n   * @param {Array.<number>} input Input coordinate array.\n   * @param {Array.<number>=} opt_output Output array of coordinate values.\n   * @param {number=} opt_dimension Dimension.\n   * @return {Array.<number>} Input coordinate array (same array as input).\n   */\n  static identityProjection(input, opt_output, opt_dimension) {\n    const dim = opt_dimension || input.length;\n    if (opt_output) {\n      for (let i = 0; i < dim; ++i) {\n        opt_output[i] = input[i];\n      }\n    }\n    return input;\n  }\n\n  /**\n   * @param {?ol.View} view New view to use.\n   * @private\n   */\n  setView_(view) {\n    if (this.view_) {\n      olObservableUnByKey(this.viewListenKey_);\n      this.viewListenKey_ = null;\n    }\n\n    this.view_ = view;\n    if (view) {\n      const toLonLat = getTransform(view.getProjection(), 'EPSG:4326');\n      const fromLonLat = getTransform('EPSG:4326', view.getProjection());\n      console.assert(toLonLat && fromLonLat);\n\n      this.toLonLat_ = toLonLat;\n      this.fromLonLat_ = fromLonLat;\n\n      this.viewListenKey_ = view.on('propertychange', e => this.handleViewEvent_(e));\n\n      this.readFromView();\n    } else {\n      this.toLonLat_ = Camera.identityProjection;\n      this.fromLonLat_ = Camera.identityProjection;\n    }\n  }\n\n  /**\n   * @param {?} e\n   * @private\n   */\n  handleViewEvent_(e) {\n    if (!this.viewUpdateInProgress_) {\n      this.readFromView();\n    }\n  }\n\n  /**\n   * @param {number} heading In radians.\n   * @api\n   */\n  setHeading(heading) {\n    if (!this.view_) {\n      return;\n    }\n\n    this.view_.setRotation(heading);\n  }\n\n  /**\n   * @return {number|undefined} Heading in radians.\n   * @api\n   */\n  getHeading() {\n    if (!this.view_) {\n      return undefined;\n    }\n    const rotation = this.view_.getRotation();\n    return rotation || 0;\n  }\n\n  /**\n   * @param {number} tilt In radians.\n   * @api\n   */\n  setTilt(tilt) {\n    this.tilt_ = tilt;\n    this.updateCamera_();\n  }\n\n  /**\n   * @return {number} Tilt in radians.\n   * @api\n   */\n  getTilt() {\n    return this.tilt_;\n  }\n\n  /**\n   * @param {number} distance In meters.\n   * @api\n   */\n  setDistance(distance) {\n    this.distance_ = distance;\n    this.updateCamera_();\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Distance in meters.\n   * @api\n   */\n  getDistance() {\n    return this.distance_;\n  }\n\n  /**\n   * Shortcut for ol.View.setCenter().\n   * @param {!ol.Coordinate} center Same projection as the ol.View.\n   * @api\n   */\n  setCenter(center) {\n    if (!this.view_) {\n      return;\n    }\n    this.view_.setCenter(center);\n  }\n\n  /**\n   * Shortcut for ol.View.getCenter().\n   * @return {ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getCenter() {\n    if (!this.view_) {\n      return undefined;\n    }\n    return this.view_.getCenter();\n  }\n\n  /**\n   * Sets the position of the camera.\n   * @param {!ol.Coordinate} position Same projection as the ol.View.\n   * @api\n   */\n  setPosition(position) {\n    if (!this.toLonLat_) {\n      return;\n    }\n    const ll = this.toLonLat_(position);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(\n        toRadians(ll[0]),\n        toRadians(ll[1]),\n        this.getAltitude());\n\n    this.cam_.setView({\n      destination: Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto)\n    });\n    this.updateView();\n  }\n\n  /**\n   * Calculates position under the camera.\n   * @return {!ol.Coordinate|undefined} Same projection as the ol.View.\n   * @api\n   */\n  getPosition() {\n    if (!this.fromLonLat_) {\n      return undefined;\n    }\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);\n\n    const pos = this.fromLonLat_([\n      toDegrees(carto.longitude),\n      toDegrees(carto.latitude)\n    ]);\n    console.assert(pos);\n    return pos;\n  }\n\n  /**\n   * @param {number} altitude In meters.\n   * @api\n   */\n  setAltitude(altitude) {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n    carto.height = altitude;\n    this.cam_.position = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    this.updateView();\n  }\n\n  /**\n   * @return {number} Altitude in meters.\n   * @api\n   */\n  getAltitude() {\n    const carto = Cesium.Ellipsoid.WGS84.cartesianToCartographic(\n        this.cam_.position);\n\n    return carto.height;\n  }\n\n  /**\n   * Updates the state of the underlying Cesium.Camera\n   * according to the current values of the properties.\n   * @private\n   */\n  updateCamera_() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (!center) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const carto = new Cesium.Cartographic(toRadians(ll[0]),\n        toRadians(ll[1]));\n    if (this.scene_.globe) {\n      const height = this.scene_.globe.getHeight(carto);\n      carto.height = height || 0;\n    }\n\n    const destination = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n\n    /** @type {Cesium.optionsOrientation} */\n    const orientation = {\n      pitch: this.tilt_ - Cesium.Math.PI_OVER_TWO,\n      heading: -this.view_.getRotation(),\n      roll: undefined\n    };\n    this.cam_.setView({\n      destination,\n      orientation\n    });\n\n    this.cam_.moveBackward(this.distance_);\n\n    this.checkCameraChange(true);\n  }\n\n  /**\n   * Calculates the values of the properties from the current ol.View state.\n   * @api\n   */\n  readFromView() {\n    if (!this.view_ || !this.toLonLat_) {\n      return;\n    }\n    const center = this.view_.getCenter();\n    if (center === undefined || center === null) {\n      return;\n    }\n    const ll = this.toLonLat_(center);\n    console.assert(ll);\n\n    const resolution = this.view_.getResolution();\n    this.distance_ = this.calcDistanceForResolution(\n        resolution || 0, toRadians(ll[1]));\n\n    this.updateCamera_();\n  }\n\n  /**\n   * Calculates the values of the properties from the current Cesium.Camera state.\n   * Modifies the center, resolution and rotation properties of the view.\n   * @api\n   */\n  updateView() {\n    if (!this.view_ || !this.fromLonLat_) {\n      return;\n    }\n    this.viewUpdateInProgress_ = true;\n\n    // target & distance\n    const ellipsoid = Cesium.Ellipsoid.WGS84;\n    const scene = this.scene_;\n    const target = pickCenterPoint(scene);\n\n    let bestTarget = target;\n    if (!bestTarget) {\n      //TODO: how to handle this properly ?\n      const globe = scene.globe;\n      const carto = this.cam_.positionCartographic.clone();\n      const height = globe.getHeight(carto);\n      carto.height = height || 0;\n      bestTarget = Cesium.Ellipsoid.WGS84.cartographicToCartesian(carto);\n    }\n    this.distance_ = Cesium.Cartesian3.distance(bestTarget, this.cam_.position);\n    const bestTargetCartographic = ellipsoid.cartesianToCartographic(bestTarget);\n    this.view_.setCenter(this.fromLonLat_([\n      toDegrees(bestTargetCartographic.longitude),\n      toDegrees(bestTargetCartographic.latitude)]));\n\n    // resolution\n    this.view_.setResolution(\n        this.calcResolutionForDistance(this.distance_,\n            bestTargetCartographic ? bestTargetCartographic.latitude : 0));\n\n\n    /*\n     * Since we are positioning the target, the values of heading and tilt\n     * need to be calculated _at the target_.\n     */\n    if (target) {\n      const pos = this.cam_.position;\n\n      // normal to the ellipsoid at the target\n      const targetNormal = new Cesium.Cartesian3();\n      ellipsoid.geocentricSurfaceNormal(target, targetNormal);\n\n      // vector from the target to the camera\n      const targetToCamera = new Cesium.Cartesian3();\n      Cesium.Cartesian3.subtract(pos, target, targetToCamera);\n      Cesium.Cartesian3.normalize(targetToCamera, targetToCamera);\n\n\n      // HEADING\n      const up = this.cam_.up;\n      const right = this.cam_.right;\n      const normal = new Cesium.Cartesian3(-target.y, target.x, 0); // what is it?\n      const heading = Cesium.Cartesian3.angleBetween(right, normal);\n      const cross = Cesium.Cartesian3.cross(target, up, new Cesium.Cartesian3());\n      const orientation = cross.z;\n\n      this.view_.setRotation((orientation < 0 ? heading : -heading));\n\n      // TILT\n      const tiltAngle = Math.acos(\n          Cesium.Cartesian3.dot(targetNormal, targetToCamera));\n      this.tilt_ = isNaN(tiltAngle) ? 0 : tiltAngle;\n    } else {\n      // fallback when there is no target\n      this.view_.setRotation(this.cam_.heading);\n      this.tilt_ = -this.cam_.pitch + Math.PI / 2;\n    }\n\n    this.viewUpdateInProgress_ = false;\n  }\n\n  /**\n   * Check if the underlying camera state has changed and ensure synchronization.\n   * @param {boolean=} opt_dontSync Do not synchronize the view.\n   */\n  checkCameraChange(opt_dontSync) {\n    const old = this.lastCameraViewMatrix_;\n    const current = this.cam_.viewMatrix;\n\n    if (!old || !Cesium.Matrix4.equalsEpsilon(old, current, 1e-5)) {\n      this.lastCameraViewMatrix_ = current.clone();\n      if (opt_dontSync !== true) {\n        this.updateView();\n      }\n    }\n  }\n\n  /**\n   * calculate the distance between camera and centerpoint based on the resolution and latitude value\n   * @param {number} resolution Number of map units per pixel.\n   * @param {number} latitude Latitude in radians.\n   * @return {number} The calculated distance.\n   * @api\n   */\n  calcDistanceForResolution(resolution, latitude) {\n    return calcDistanceForResolution(resolution, latitude, this.scene_, this.view_.getProjection());\n  }\n\n  /**\n   * calculate the resolution based on a distance(camera to position) and latitude value\n   * @param {number} distance\n   * @param {number} latitude\n   * @return {number} The calculated resolution.\n   * @api\n   */\n  calcResolutionForDistance(distance, latitude) {\n    return calcResolutionForDistance(distance, latitude, this.scene_, this.view_.getProjection());\n  }\n}\n\n\nexport default Camera;\n","/**\n * @module olcs.FeatureConverter\n */\nimport olGeomGeometry from 'ol/geom/Geometry.js';\nimport olStyleIcon from 'ol/style/Icon.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olSourceCluster from 'ol/source/Cluster.js';\nimport {circular as olCreateCircularPolygon} from 'ol/geom/Polygon.js';\nimport {boundingExtent, getCenter} from 'ol/extent.js';\nimport olGeomSimpleGeometry from 'ol/geom/SimpleGeometry.js';\nimport {convertColorToCesium, olGeometryCloneTo4326, ol4326CoordinateToCesiumCartesian, ol4326CoordinateArrayToCsCartesians} from './core.ts';\nimport olcsCoreVectorLayerCounterpart from './core/VectorLayerCounterpart.ts';\nimport {obj, getUid, isGroundPolylinePrimitiveSupported, waitReady} from './util.js';\n\n\n/**\n * @typedef {Object} ModelStyle\n * @property {Cesium.Matrix4} [debugModelMatrix]\n * @property {Cesium.ModelFromGltfOptions} cesiumOptions\n */\n\n\nclass FeatureConverter {\n  /**\n   * Concrete base class for converting from OpenLayers3 vectors to Cesium\n   * primitives.\n   * Extending this class is possible provided that the extending class and\n   * the library are compiled together by the closure compiler.\n   * @param {!Cesium.Scene} scene Cesium scene.\n   * @constructor\n   * @api\n   */\n  constructor(scene) {\n\n    /**\n     * @protected\n     */\n    this.scene = scene;\n\n    /**\n     * Bind once to have a unique function for using as a listener\n     * @type {function(ol.source.Vector.Event)}\n     * @private\n     */\n    this.boundOnRemoveOrClearFeatureListener_ = this.onRemoveOrClearFeature_.bind(this);\n\n    /**\n     * @type {Cesium.Cartesian3}\n     * @private\n     */\n    this.defaultBillboardEyeOffset_ = new Cesium.Cartesian3(0, 0, 10);\n  }\n\n  /**\n   * @param {ol.source.Vector.Event} evt\n   * @private\n   */\n  onRemoveOrClearFeature_(evt) {\n    const source = evt.target;\n    console.assert(source instanceof olSourceVector);\n\n    const cancellers = obj(source)['olcs_cancellers'];\n    if (cancellers) {\n      const feature = evt.feature;\n      if (feature) {\n        // remove\n        const id = getUid(feature);\n        const canceller = cancellers[id];\n        if (canceller) {\n          canceller();\n          delete cancellers[id];\n        }\n      } else {\n        // clear\n        for (const key in cancellers) {\n          if (cancellers.hasOwnProperty(key)) {\n            cancellers[key]();\n          }\n        }\n        obj(source)['olcs_cancellers'] = {};\n      }\n    }\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!Cesium.Primitive|Cesium.Label|Cesium.Billboard} primitive\n   * @protected\n   */\n  setReferenceForPicking(layer, feature, primitive) {\n    primitive.olLayer = layer;\n    primitive.olFeature = feature;\n  }\n\n  /**\n   * Basics primitive creation using a color attribute.\n   * Note that Cesium has 'interior' and outline geometries.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} geometry\n   * @param {!Cesium.Color} color\n   * @param {number=} opt_lineWidth\n   * @return {Cesium.Primitive}\n   * @protected\n   */\n  createColoredPrimitive(layer, feature, olGeometry, geometry, color, opt_lineWidth) {\n    const createInstance = function(geometry, color) {\n      const instance = new Cesium.GeometryInstance({\n        // always update Cesium externs before adding a property\n        geometry\n      });\n      if (color && !(color instanceof Cesium.ImageMaterialProperty)) {\n        instance.attributes = {\n          color: Cesium.ColorGeometryInstanceAttribute.fromColor(color)\n        };\n      }\n      return instance;\n    };\n\n    const options = {\n      // always update Cesium externs before adding a property\n      flat: true, // work with all geometries\n      renderState: {\n        depthTest: {\n          enabled: true\n        }\n      }\n    };\n\n    if (opt_lineWidth !== undefined) {\n      if (!options.renderState) {\n        options.renderState = {};\n      }\n      options.renderState.lineWidth = opt_lineWidth;\n    }\n\n    const instances = createInstance(geometry, color);\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let primitive;\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const ctor = instances.geometry.constructor;\n      if (ctor && !ctor['createShadowVolume']) {\n        return null;\n      }\n      primitive = new Cesium.GroundPrimitive({\n        geometryInstances: instances\n      });\n    } else {\n      primitive = new Cesium.Primitive({\n        geometryInstances: instances\n      });\n    }\n\n    if (color instanceof Cesium.ImageMaterialProperty) {\n      const dataUri = color.image.getValue().toDataURL();\n\n      primitive.appearance = new Cesium.MaterialAppearance({\n        flat: true,\n        renderState: {\n          depthTest: {\n            enabled: true,\n          }\n        },\n        material: new Cesium.Material({\n          fabric: {\n            type: 'Image',\n            uniforms: {\n              image: dataUri\n            }\n          }\n        })\n      });\n    } else {\n      primitive.appearance = new Cesium.MaterialAppearance({\n        ...options,\n        material: new Cesium.Material({\n          translucent: color.alpha !== 1,\n          fabric: {\n            type: 'Color',\n            uniforms: {\n              color,\n            }\n          }\n        })\n      });\n      if (feature.get('olcs_shadows') || layer.get('olcs_shadows')) {\n        primitive.shadows = 1;\n      }\n    }\n    this.setReferenceForPicking(layer, feature, primitive);\n    return primitive;\n  }\n\n  /**\n   * Return the fill or stroke color from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @param {boolean} outline\n   * @return {!Cesium.Color}\n   * @protected\n   */\n  extractColorFromOlStyle(style, outline) {\n    const fillColor = style.getFill() ? style.getFill().getColor() : null;\n    const strokeColor = style.getStroke() ? style.getStroke().getColor() : null;\n\n    let olColor = 'black';\n    if (strokeColor && outline) {\n      olColor = strokeColor;\n    } else if (fillColor) {\n      olColor = fillColor;\n    }\n\n    return convertColorToCesium(olColor);\n  }\n\n  /**\n   * Return the width of stroke from a plain ol style.\n   * @param {!ol.style.Style|ol.style.Text} style\n   * @return {number}\n   * @protected\n   */\n  extractLineWidthFromOlStyle(style) {\n    // Handling of line width WebGL limitations is handled by Cesium.\n    const width = style.getStroke() ? style.getStroke().getWidth() : undefined;\n    return width !== undefined ? width : 1;\n  }\n\n  /**\n   * Create a primitive collection out of two Cesium geometries.\n   * Only the OpenLayers style colors will be used.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} olGeometry OpenLayers geometry.\n   * @param {!Cesium.Geometry} fillGeometry\n   * @param {!Cesium.Geometry} outlineGeometry\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  wrapFillAndOutlineGeometries(layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle) {\n    const fillColor = this.extractColorFromOlStyle(olStyle, false);\n    const outlineColor = this.extractColorFromOlStyle(olStyle, true);\n\n    const primitives = new Cesium.PrimitiveCollection();\n    if (olStyle.getFill()) {\n      const p1 = this.createColoredPrimitive(layer, feature, olGeometry,\n          fillGeometry, fillColor);\n      console.assert(!!p1);\n      primitives.add(p1);\n    }\n\n    if (olStyle.getStroke() && outlineGeometry) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      const p2 = this.createColoredPrimitive(layer, feature, olGeometry,\n          outlineGeometry, outlineColor, width);\n      if (p2) {\n        // Some outline geometries are not supported by Cesium in clamp to ground\n        // mode. These primitives are skipped.\n        primitives.add(p2);\n      }\n    }\n\n    return primitives;\n  }\n\n  // Geometry converters\n  /**\n   * Create a Cesium primitive if style has a text component.\n   * Eventually return a PrimitiveCollection including current primitive.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.Primitive} primitive current primitive\n   * @return {!Cesium.PrimitiveCollection}\n   * @protected\n   */\n  addTextStyle(layer, feature, geometry, style, primitive) {\n    let primitives;\n    if (!(primitive instanceof Cesium.PrimitiveCollection)) {\n      primitives = new Cesium.PrimitiveCollection();\n      primitives.add(primitive);\n    } else {\n      primitives = primitive;\n    }\n\n    if (!style.getText()) {\n      return primitives;\n    }\n\n    const text = /** @type {!ol.style.Text} */ (style.getText());\n    const label = this.olGeometry4326TextPartToCesium(layer, feature, geometry,\n        text);\n    if (label) {\n      primitives.add(label);\n    }\n    return primitives;\n  }\n\n  /**\n   * Add a billboard to a Cesium.BillboardCollection.\n   * Overriding this wrapper allows manipulating the billboard options.\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {!Cesium.optionsBillboardCollectionAdd} bbOptions\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Style} style\n   * @return {!Cesium.Billboard} newly created billboard\n   * @api\n   */\n  csAddBillboard(billboards, bbOptions, layer, feature, geometry, style) {\n    if (!bbOptions.eyeOffset) {\n      bbOptions.eyeOffset = this.defaultBillboardEyeOffset_;\n    }\n    const bb = billboards.add(bbOptions);\n    this.setReferenceForPicking(layer, feature, bb);\n    return bb;\n  }\n\n  /**\n   * Convert an OpenLayers circle geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Circle} olGeometry OpenLayers circle geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olCircleGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Circle');\n\n    // ol.Coordinate\n    let center = olGeometry.getCenter();\n    const height = center.length == 3 ? center[2] : 0.0;\n    let point = center.slice();\n    point[0] += olGeometry.getRadius();\n\n    // Cesium\n    center = ol4326CoordinateToCesiumCartesian(center);\n    point = ol4326CoordinateToCesiumCartesian(point);\n\n    // Accurate computation of straight distance\n    const radius = Cesium.Cartesian3.distance(center, point);\n\n    const fillGeometry = new Cesium.CircleGeometry({\n      // always update Cesium externs before adding a property\n      center,\n      radius,\n      height\n    });\n\n    let outlinePrimitive, outlineGeometry;\n    if (this.getHeightReference(layer, feature, olGeometry) === Cesium.HeightReference.CLAMP_TO_GROUND) {\n      const width = this.extractLineWidthFromOlStyle(olStyle);\n      if (width) {\n        const circlePolygon = olCreateCircularPolygon(olGeometry.getCenter(), radius);\n        const positions = ol4326CoordinateArrayToCsCartesians(circlePolygon.getLinearRing(0).getCoordinates());\n        if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n          const color = this.extractColorFromOlStyle(olStyle, true);\n          outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n        } else {\n          outlinePrimitive = new Cesium.GroundPolylinePrimitive({\n            geometryInstances: new Cesium.GeometryInstance({\n              geometry: new Cesium.GroundPolylineGeometry({positions, width}),\n            }),\n            appearance: new Cesium.PolylineMaterialAppearance({\n              material: this.olStyleToCesium(feature, olStyle, true),\n            }),\n            classificationType: Cesium.ClassificationType.TERRAIN,\n          });\n          waitReady(outlinePrimitive).then(() => {\n            this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n          });\n        }\n      }\n    } else {\n      outlineGeometry = new Cesium.CircleOutlineGeometry({\n        // always update Cesium externs before adding a property\n        center,\n        radius,\n        extrudedHeight: height,\n        height\n      });\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!number} width The width of the line.\n   * @param {!Cesium.Color} color The color of the line.\n   * @param {!Array<Cesium.Cartesian3>|Array<Array<Cesium.Cartesian3>>} positions The vertices of the line(s).\n   * @return {!Cesium.GroundPrimitive} primitive\n   */\n  createStackedGroundCorridors(layer, feature, width, color, positions) {\n    // Convert positions to an Array if it isn't\n    if (!Array.isArray(positions[0])) {\n      positions = [positions];\n    }\n    width = Math.max(3, width); // A <3px width is too small for ground primitives\n    const geometryInstances = [];\n    let previousDistance = 0;\n    // A stack of ground lines with increasing width (in meters) are created.\n    // Only one of these lines is displayed at any time giving a feeling of continuity.\n    // The values for the distance and width factor are more or less arbitrary.\n    // Applications can override this logics by subclassing the FeatureConverter class.\n    for (const distance of [1000, 4000, 16000, 64000, 254000, 1000000, 10000000]) {\n      width *= 2.14;\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        width,\n        vertexFormat: Cesium.VertexFormat.POSITION_ONLY\n      };\n      for (const linePositions of positions) {\n        geometryOptions.positions = linePositions;\n        geometryInstances.push(new Cesium.GeometryInstance({\n          geometry: new Cesium.CorridorGeometry(geometryOptions),\n          attributes: {\n            color: Cesium.ColorGeometryInstanceAttribute.fromColor(color),\n            distanceDisplayCondition: new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(previousDistance, distance - 1)\n          }\n        }));\n      }\n      previousDistance = distance;\n    }\n    return new Cesium.GroundPrimitive({\n      // always update Cesium externs before adding a property\n      geometryInstances\n    });\n  }\n\n  /**\n   * Convert an OpenLayers line string geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.LineString} olGeometry OpenLayers line string geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olLineStringGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'LineString');\n\n    const positions = ol4326CoordinateArrayToCsCartesians(olGeometry.getCoordinates());\n    const width = this.extractLineWidthFromOlStyle(olStyle);\n\n    let outlinePrimitive;\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND && !isGroundPolylinePrimitiveSupported(this.scene)) {\n      const color = this.extractColorFromOlStyle(olStyle, true);\n      outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n    } else {\n      const appearance = new Cesium.PolylineMaterialAppearance({\n        // always update Cesium externs before adding a property\n        material: this.olStyleToCesium(feature, olStyle, true)\n      });\n      const geometryOptions = {\n        // always update Cesium externs before adding a property\n        positions,\n        width,\n      };\n      const primitiveOptions = {\n        // always update Cesium externs before adding a property\n        appearance\n      };\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const geometry = new Cesium.GroundPolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n        waitReady(outlinePrimitive).then(() => {\n          this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n        });\n      } else {\n        geometryOptions.vertexFormat = appearance.vertexFormat;\n        const geometry = new Cesium.PolylineGeometry(geometryOptions);\n        primitiveOptions.geometryInstances = new Cesium.GeometryInstance({\n          geometry\n        }),\n        outlinePrimitive = new Cesium.Primitive(primitiveOptions);\n      }\n    }\n\n    this.setReferenceForPicking(layer, feature, outlinePrimitive);\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, outlinePrimitive);\n  }\n\n  /**\n   * Convert an OpenLayers polygon geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Polygon} olGeometry OpenLayers polygon geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @return {!Cesium.PrimitiveCollection} primitives\n   * @api\n   */\n  olPolygonGeometryToCesium(layer, feature, olGeometry, projection, olStyle) {\n\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n    console.assert(olGeometry.getType() == 'Polygon');\n\n    const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n    let fillGeometry, outlineGeometry, outlinePrimitive;\n    if ((olGeometry.getCoordinates()[0].length == 5) &&\n        (feature.get('olcs.polygon_kind') === 'rectangle')) {\n      // Create a rectangle according to the longitude and latitude curves\n      const coordinates = olGeometry.getCoordinates()[0];\n      // Extract the West, South, East, North coordinates\n      const extent = boundingExtent(coordinates);\n      const rectangle = Cesium.Rectangle.fromDegrees(extent[0], extent[1],\n          extent[2], extent[3]);\n\n      // Extract the average height of the vertices\n      let maxHeight = 0.0;\n      if (coordinates[0].length == 3) {\n        for (let c = 0; c < coordinates.length; c++) {\n          maxHeight = Math.max(maxHeight, coordinates[c][2]);\n        }\n      }\n\n      const featureExtrudedHeight = feature.getProperty('olcs_extruded_height');\n\n      // Render the cartographic rectangle\n      fillGeometry = new Cesium.RectangleGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      outlineGeometry = new Cesium.RectangleOutlineGeometry({\n        ellipsoid: Cesium.Ellipsoid.WGS84,\n        rectangle,\n        height: maxHeight,\n        extrudedHeight: featureExtrudedHeight,\n      });\n    } else {\n      const rings = olGeometry.getLinearRings();\n      // always update Cesium externs before adding a property\n      const hierarchy = {};\n      const polygonHierarchy = hierarchy;\n      console.assert(rings.length > 0);\n\n      for (let i = 0; i < rings.length; ++i) {\n        const olPos = rings[i].getCoordinates();\n        const positions = ol4326CoordinateArrayToCsCartesians(olPos);\n        console.assert(positions && positions.length > 0);\n        if (i == 0) {\n          hierarchy.positions = positions;\n        } else {\n          if (!hierarchy.holes) {\n            hierarchy.holes = [];\n          }\n          hierarchy.holes.push({\n            positions\n          });\n        }\n      }\n\n      const featureExtrudedHeight = feature.get('olcs_extruded_height');\n\n      fillGeometry = new Cesium.PolygonGeometry({\n        // always update Cesium externs before adding a property\n        polygonHierarchy,\n        perPositionHeight: true,\n        extrudedHeight: featureExtrudedHeight,\n      });\n\n      // Since Cesium doesn't yet support Polygon outlines on terrain yet (coming soon...?)\n      // we don't create an outline geometry if clamped, but instead do the polyline method\n      // for each ring. Most of this code should be removeable when Cesium adds\n      // support for Polygon outlines on terrain.\n      if (heightReference === Cesium.HeightReference.CLAMP_TO_GROUND) {\n        const width = this.extractLineWidthFromOlStyle(olStyle);\n        if (width > 0) {\n          const positions = [hierarchy.positions];\n          if (hierarchy.holes) {\n            for (let i = 0; i < hierarchy.holes.length; ++i) {\n              positions.push(hierarchy.holes[i].positions);\n            }\n          }\n          if (!isGroundPolylinePrimitiveSupported(this.scene)) {\n            const color = this.extractColorFromOlStyle(olStyle, true);\n            outlinePrimitive = this.createStackedGroundCorridors(layer, feature, width, color, positions);\n          } else {\n            const appearance = new Cesium.PolylineMaterialAppearance({\n              // always update Cesium externs before adding a property\n              material: this.olStyleToCesium(feature, olStyle, true)\n            });\n            const geometryInstances = [];\n            for (const linePositions of positions) {\n              const polylineGeometry = new Cesium.GroundPolylineGeometry({positions: linePositions, width});\n              geometryInstances.push(new Cesium.GeometryInstance({\n                geometry: polylineGeometry\n              }));\n            }\n            const primitiveOptions = {\n              // always update Cesium externs before adding a property\n              appearance,\n              geometryInstances\n            };\n            outlinePrimitive = new Cesium.GroundPolylinePrimitive(primitiveOptions);\n            waitReady(outlinePrimitive).then(() => {\n              this.setReferenceForPicking(layer, feature, outlinePrimitive._primitive);\n            });\n          }\n        }\n      } else {\n        // Actually do the normal polygon thing. This should end the removable\n        // section of code described above.\n        outlineGeometry = new Cesium.PolygonOutlineGeometry({\n          // always update Cesium externs before adding a property\n          polygonHierarchy: hierarchy,\n          perPositionHeight: true,\n          extrudedHeight: featureExtrudedHeight,\n        });\n      }\n    }\n\n    const primitives = this.wrapFillAndOutlineGeometries(\n        layer, feature, olGeometry, fillGeometry, outlineGeometry, olStyle);\n\n    if (outlinePrimitive) {\n      primitives.add(outlinePrimitive);\n    }\n\n    return this.addTextStyle(layer, feature, olGeometry, olStyle, primitives);\n  }\n\n  /**\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @return {!Cesium.HeightReference}\n   * @api\n   */\n  getHeightReference(layer, feature, geometry) {\n\n    // Read from the geometry\n    let altitudeMode = geometry.get('altitudeMode');\n\n    // Or from the feature\n    if (altitudeMode === undefined) {\n      altitudeMode = feature.get('altitudeMode');\n    }\n\n    // Or from the layer\n    if (altitudeMode === undefined) {\n      altitudeMode = layer.get('altitudeMode');\n    }\n\n    let heightReference = Cesium.HeightReference.NONE;\n    if (altitudeMode === 'clampToGround') {\n      heightReference = Cesium.HeightReference.CLAMP_TO_GROUND;\n    } else if (altitudeMode === 'relativeToGround') {\n      heightReference = Cesium.HeightReference.RELATIVE_TO_GROUND;\n    }\n\n    return heightReference;\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!ol.style.Image} imageStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when the new billboard is added.\n   * @api\n   */\n  createBillboardFromImage(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      imageStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n\n    if (imageStyle instanceof olStyleIcon) {\n      // make sure the image is scheduled for load\n      imageStyle.load();\n    }\n\n    const image = imageStyle.getImage(1); // get normal density\n    const isImageLoaded = function(image) {\n      return image.src != '' &&\n          image.naturalHeight != 0 &&\n          image.naturalWidth != 0 &&\n          image.complete;\n    };\n    const reallyCreateBillboard = (function() {\n      if (!image) {\n        return;\n      }\n      if (!(image instanceof HTMLCanvasElement ||\n          image instanceof Image ||\n          image instanceof HTMLImageElement)) {\n        return;\n      }\n      const center = olGeometry.getCoordinates();\n      const position = ol4326CoordinateToCesiumCartesian(center);\n      let color;\n      const opacity = imageStyle.getOpacity();\n      if (opacity !== undefined) {\n        color = new Cesium.Color(1.0, 1.0, 1.0, opacity);\n      }\n\n      const scale = imageStyle.getScale();\n      const heightReference = this.getHeightReference(layer, feature, olGeometry);\n\n      const bbOptions = /** @type {Cesium.optionsBillboardCollectionAdd} */ ({\n        // always update Cesium externs before adding a property\n        image,\n        color,\n        scale,\n        heightReference,\n        position\n      });\n\n      // merge in cesium options from openlayers feature\n      Object.assign(bbOptions, feature.get('cesiumOptions'));\n\n      if (imageStyle instanceof olStyleIcon) {\n        const anchor = imageStyle.getAnchor();\n        if (anchor) {\n          bbOptions.pixelOffset = new Cesium.Cartesian2((image.width / 2 - anchor[0]) * scale, (image.height / 2 - anchor[1]) * scale);\n        }\n      }\n\n      const bb = this.csAddBillboard(billboards, bbOptions, layer, feature, olGeometry, style);\n      if (opt_newBillboardCallback) {\n        opt_newBillboardCallback(bb);\n      }\n    }).bind(this);\n\n    if (image instanceof Image && !isImageLoaded(image)) {\n      // Cesium requires the image to be loaded\n      let cancelled = false;\n      const source = layer.getSource();\n      const canceller = function() {\n        cancelled = true;\n      };\n      source.on(['removefeature', 'clear'],\n          this.boundOnRemoveOrClearFeatureListener_);\n      let cancellers = obj(source)['olcs_cancellers'];\n      if (!cancellers) {\n        cancellers = obj(source)['olcs_cancellers'] = {};\n      }\n\n      const fuid = getUid(feature);\n      if (cancellers[fuid]) {\n        // When the feature change quickly, a canceller may still be present so\n        // we cancel it here to prevent creation of a billboard.\n        cancellers[fuid]();\n      }\n      cancellers[fuid] = canceller;\n\n      const listener = function() {\n        image.removeEventListener('load', listener);\n        if (!billboards.isDestroyed() && !cancelled) {\n          // Create billboard if the feature is still displayed on the map.\n          reallyCreateBillboard();\n        }\n      };\n\n      image.addEventListener('load', listener);\n    } else {\n      reallyCreateBillboard();\n    }\n  }\n\n  /**\n   * Convert a point geometry to a Cesium BillboardCollection.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Point} olGeometry OpenLayers point geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} style\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olPointGeometryToCesium(\n      layer,\n      feature,\n      olGeometry,\n      projection,\n      style,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    console.assert(olGeometry.getType() == 'Point');\n    olGeometry = olGeometryCloneTo4326(olGeometry, projection);\n\n    let modelPrimitive = null;\n    const imageStyle = style.getImage();\n    if (imageStyle) {\n      const olcsModelFunction = /** @type {function():olcsx.ModelStyle} */ (olGeometry.get('olcs_model') || feature.get('olcs_model'));\n      if (olcsModelFunction) {\n        modelPrimitive = new Cesium.PrimitiveCollection();\n        const olcsModel = olcsModelFunction();\n        const options = /** @type {Cesium.ModelFromGltfOptions} */ (Object.assign({}, {scene: this.scene}, olcsModel.cesiumOptions));\n        if (Cesium.Model.fromGltf) {\n          // pre Cesium v107\n          const model = Cesium.Model.fromGltf(options);\n          modelPrimitive.add(model);\n        } else {\n          Cesium.Model.fromGltfAsync(options).then((model) => {\n            modelPrimitive.add(model);\n          });\n        }\n\n        if (olcsModel.debugModelMatrix) {\n          modelPrimitive.add(new Cesium.DebugModelMatrixPrimitive({\n            modelMatrix: olcsModel.debugModelMatrix\n          }));\n        }\n      } else {\n        this.createBillboardFromImage(layer, feature, olGeometry, projection, style, imageStyle, billboards, opt_newBillboardCallback);\n      }\n    }\n\n    if (style.getText()) {\n      return this.addTextStyle(layer, feature, olGeometry, style, modelPrimitive || new Cesium.Primitive());\n    } else {\n      return modelPrimitive;\n    }\n  }\n\n  /**\n   * Convert an OpenLayers multi-something geometry to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry OpenLayers geometry.\n   * @param {!ol.ProjectionLike} projection\n   * @param {!ol.style.Style} olStyle\n   * @param {!Cesium.BillboardCollection} billboards\n   * @param {function(!Cesium.Billboard)=} opt_newBillboardCallback Called when\n   * the new billboard is added.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olMultiGeometryToCesium(\n      layer,\n      feature,\n      geometry,\n      projection,\n      olStyle,\n      billboards,\n      opt_newBillboardCallback\n  ) {\n    // Do not reproject to 4326 now because it will be done later.\n\n    // FIXME: would be better to combine all child geometries in one primitive\n    // instead we create n primitives for simplicity.\n    const accumulate = function(geometries, functor) {\n      const primitives = new Cesium.PrimitiveCollection();\n      geometries.forEach((geometry) => {\n        primitives.add(functor(layer, feature, geometry, projection, olStyle));\n      });\n      return primitives;\n    };\n\n    let subgeos;\n    switch (geometry.getType()) {\n      case 'MultiPoint':\n        geometry = /** @type {!ol.geom.MultiPoint} */ (geometry);\n        subgeos = geometry.getPoints();\n        if (olStyle.getText()) {\n          const primitives = new Cesium.PrimitiveCollection();\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            const result = this.olPointGeometryToCesium(layer, feature, geometry,\n                projection, olStyle, billboards, opt_newBillboardCallback);\n            if (result) {\n              primitives.add(result);\n            }\n          });\n          return primitives;\n        } else {\n          subgeos.forEach((geometry) => {\n            console.assert(geometry);\n            this.olPointGeometryToCesium(layer, feature, geometry, projection,\n                olStyle, billboards, opt_newBillboardCallback);\n          });\n          return null;\n        }\n      case 'MultiLineString':\n        geometry = /** @type {!ol.geom.MultiLineString} */ (geometry);\n        subgeos = geometry.getLineStrings();\n        return accumulate(subgeos, this.olLineStringGeometryToCesium.bind(this));\n      case 'MultiPolygon':\n        geometry = /** @type {!ol.geom.MultiPolygon} */ (geometry);\n        subgeos = geometry.getPolygons();\n        return accumulate(subgeos, this.olPolygonGeometryToCesium.bind(this));\n      default:\n        console.assert(false, `Unhandled multi geometry type${geometry.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers text style to Cesium.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature..\n   * @param {!ol.geom.Geometry} geometry\n   * @param {!ol.style.Text} style\n   * @return {Cesium.LabelCollection} Cesium primitive\n   * @api\n   */\n  olGeometry4326TextPartToCesium(layer, feature, geometry, style) {\n    const text = style.getText();\n    if (!text) {\n      return null;\n    }\n\n    const labels = new Cesium.LabelCollection({scene: this.scene});\n    // TODO: export and use the text draw position from OpenLayers .\n    // See src/ol/render/vector.js\n    const extentCenter = getCenter(geometry.getExtent());\n    if (geometry instanceof olGeomSimpleGeometry) {\n      const first = geometry.getFirstCoordinate();\n      extentCenter[2] = first.length == 3 ? first[2] : 0.0;\n    }\n    const options = /** @type {Cesium.optionsLabelCollection} */ ({});\n\n    options.position = ol4326CoordinateToCesiumCartesian(extentCenter);\n\n    options.text = text;\n\n    options.heightReference = this.getHeightReference(layer, feature, geometry);\n\n    const offsetX = style.getOffsetX();\n    const offsetY = style.getOffsetY();\n    if (offsetX != 0 && offsetY != 0) {\n      const offset = new Cesium.Cartesian2(offsetX, offsetY);\n      options.pixelOffset = offset;\n    }\n\n    options.font = style.getFont() || '10px sans-serif'; // OpenLayers default\n\n    let labelStyle = undefined;\n    if (style.getFill()) {\n      options.fillColor = this.extractColorFromOlStyle(style, false);\n      labelStyle = Cesium.LabelStyle.FILL;\n    }\n    if (style.getStroke()) {\n      options.outlineWidth = this.extractLineWidthFromOlStyle(style);\n      options.outlineColor = this.extractColorFromOlStyle(style, true);\n      labelStyle = Cesium.LabelStyle.OUTLINE;\n    }\n    if (style.getFill() && style.getStroke()) {\n      labelStyle = Cesium.LabelStyle.FILL_AND_OUTLINE;\n    }\n    options.style = labelStyle;\n\n    let horizontalOrigin;\n    switch (style.getTextAlign()) {\n      case 'left':\n        horizontalOrigin = Cesium.HorizontalOrigin.LEFT;\n        break;\n      case 'right':\n        horizontalOrigin = Cesium.HorizontalOrigin.RIGHT;\n        break;\n      case 'center':\n      default:\n        horizontalOrigin = Cesium.HorizontalOrigin.CENTER;\n    }\n    options.horizontalOrigin = horizontalOrigin;\n\n    if (style.getTextBaseline()) {\n      let verticalOrigin;\n      switch (style.getTextBaseline()) {\n        case 'top':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'middle':\n          verticalOrigin = Cesium.VerticalOrigin.CENTER;\n          break;\n        case 'bottom':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        case 'alphabetic':\n          verticalOrigin = Cesium.VerticalOrigin.TOP;\n          break;\n        case 'hanging':\n          verticalOrigin = Cesium.VerticalOrigin.BOTTOM;\n          break;\n        default:\n          console.assert(false, `unhandled baseline ${style.getTextBaseline()}`);\n      }\n      options.verticalOrigin = verticalOrigin;\n    }\n\n\n    const l = labels.add(options);\n    this.setReferenceForPicking(layer, feature, l);\n    return labels;\n  }\n\n  /**\n   * Convert an OpenLayers style to a Cesium Material.\n   * @param {ol.Feature} feature OpenLayers feature..\n   * @param {!ol.style.Style} style\n   * @param {boolean} outline\n   * @return {Cesium.Material}\n   * @api\n   */\n  olStyleToCesium(feature, style, outline) {\n    const fill = style.getFill();\n    const stroke = style.getStroke();\n    if ((outline && !stroke) || (!outline && !fill)) {\n      return null; // FIXME use a default style? Developer error?\n    }\n\n    let color = outline ? stroke.getColor() : fill.getColor();\n    color = convertColorToCesium(color);\n\n    if (outline && stroke.getLineDash()) {\n      return Cesium.Material.fromType('Stripe', {\n        // always update Cesium externs before adding a property\n        horizontal: false,\n        repeat: 500, // TODO how to calculate this?\n        evenColor: color,\n        oddColor: new Cesium.Color(0, 0, 0, 0) // transparent\n      });\n    } else {\n      return Cesium.Material.fromType('Color', {\n        // always update Cesium externs before adding a property\n        color\n      });\n    }\n\n  }\n\n  /**\n   * Compute OpenLayers plain style.\n   * Evaluates style function, blend arrays, get default style.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature\n   * @param {ol.StyleFunction|undefined} fallbackStyleFunction\n   * @param {number} resolution\n   * @return {Array.<!ol.style.Style>} null if no style is available\n   * @api\n   */\n  computePlainStyle(layer, feature, fallbackStyleFunction, resolution) {\n    /**\n     * @type {ol.FeatureStyleFunction|undefined}\n     */\n    const featureStyleFunction = feature.getStyleFunction();\n\n    /**\n     * @type {ol.style.Style|Array.<ol.style.Style>}\n     */\n    let style = null;\n\n    if (featureStyleFunction) {\n      style = featureStyleFunction(feature, resolution);\n    }\n\n    if (!style && fallbackStyleFunction) {\n      style = fallbackStyleFunction(feature, resolution);\n    }\n\n    if (!style) {\n      // The feature must not be displayed\n      return null;\n    }\n\n    // FIXME combine materials as in cesium-materials-pack?\n    // then this function must return a custom material\n    // More simply, could blend the colors like described in\n    // http://en.wikipedia.org/wiki/Alpha_compositing\n    return Array.isArray(style) ? style : [style];\n  }\n\n  /**\n   * @protected\n   * @param {!ol.Feature} feature\n   * @param {!ol.style.Style} style\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {ol.geom.Geometry|undefined}\n   */\n  getGeometryFromFeature(feature, style, opt_geom) {\n    if (opt_geom) {\n      return opt_geom;\n    }\n\n    const geom3d = /** @type {!ol.geom.Geometry} */(feature.get('olcs.3d_geometry'));\n    if (geom3d && geom3d instanceof olGeomGeometry) {\n      return geom3d;\n    }\n\n    if (style) {\n      const geomFuncRes = style.getGeometryFunction()(feature);\n      if (geomFuncRes instanceof olGeomGeometry) {\n        return geomFuncRes;\n      }\n    }\n\n    return feature.getGeometry();\n  }\n\n  /**\n   * Convert one OpenLayers feature up to a collection of Cesium primitives.\n   * @param {ol.layer.Vector|ol.layer.Image} layer\n   * @param {!ol.Feature} feature OpenLayers feature.\n   * @param {!ol.style.Style} style\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @param {!ol.geom.Geometry=} opt_geom Geometry to be converted.\n   * @return {Cesium.Primitive} primitives\n   * @api\n   */\n  olFeatureToCesium(layer, feature, style, context, opt_geom) {\n    let geom = this.getGeometryFromFeature(feature, style, opt_geom);\n\n    if (!geom) {\n      // OpenLayers features may not have a geometry\n      // See http://geojson.org/geojson-spec.html#feature-objects\n      return null;\n    }\n\n    const proj = context.projection;\n    const newBillboardAddedCallback = function(bb) {\n      const featureBb = context.featureToCesiumMap[getUid(feature)];\n      if (featureBb instanceof Array) {\n        featureBb.push(bb);\n      }\n      else {\n        context.featureToCesiumMap[getUid(feature)] = [bb];\n      }\n    };\n\n    switch (geom.getType()) {\n      case 'GeometryCollection':\n        const primitives = new Cesium.PrimitiveCollection();\n        const collection = /** @type {!ol.geom.GeometryCollection} */ (geom);\n        // TODO: use getGeometriesArray() instead\n        collection.getGeometries().forEach((geom) => {\n          if (geom) {\n            const prims = this.olFeatureToCesium(layer, feature, style, context,\n                geom);\n            if (prims) {\n              primitives.add(prims);\n            }\n          }\n        });\n        return primitives;\n      case 'Point':\n        geom = /** @type {!ol.geom.Point} */ (geom);\n        const bbs = context.billboards;\n        const result = this.olPointGeometryToCesium(layer, feature, geom, proj,\n            style, bbs, newBillboardAddedCallback);\n        if (!result) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result;\n        }\n      case 'Circle':\n        geom = /** @type {!ol.geom.Circle} */ (geom);\n        return this.olCircleGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'LineString':\n        geom = /** @type {!ol.geom.LineString} */ (geom);\n        return this.olLineStringGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'Polygon':\n        geom = /** @type {!ol.geom.Polygon} */ (geom);\n        return this.olPolygonGeometryToCesium(layer, feature, geom, proj,\n            style);\n      case 'MultiPoint':\n      case 'MultiLineString':\n      case 'MultiPolygon':\n        const result2 = this.olMultiGeometryToCesium(layer, feature, geom, proj,\n            style, context.billboards, newBillboardAddedCallback);\n        if (!result2) {\n          // no wrapping primitive\n          return null;\n        } else {\n          return result2;\n        }\n      case 'LinearRing':\n        throw new Error('LinearRing should only be part of polygon.');\n      default:\n        throw new Error(`Ol geom type not handled : ${geom.getType()}`);\n    }\n  }\n\n  /**\n   * Convert an OpenLayers vector layer to Cesium primitive collection.\n   * For each feature, the associated primitive will be stored in\n   * `featurePrimitiveMap`.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} olLayer\n   * @param {!ol.View} olView\n   * @param {!Object.<number, !Cesium.Primitive>} featurePrimitiveMap\n   * @return {!olcs.core.VectorLayerCounterpart}\n   * @api\n   */\n  olVectorLayerToCesium(olLayer, olView, featurePrimitiveMap) {\n    const proj = olView.getProjection();\n    const resolution = olView.getResolution();\n\n    if (resolution === undefined || !proj) {\n      console.assert(false, 'View not ready');\n      // an assertion is not enough for closure to assume resolution and proj\n      // are defined\n      throw new Error('View not ready');\n    }\n\n    let source = olLayer.getSource();\n    if (source instanceof olSourceCluster) {\n      source = source.getSource();\n    }\n\n    console.assert(source instanceof olSourceVector);\n    const features = source.getFeatures();\n    const counterpart = new olcsCoreVectorLayerCounterpart(proj, this.scene);\n    const context = counterpart.context;\n    for (let i = 0; i < features.length; ++i) {\n      const feature = features[i];\n      if (!feature) {\n        continue;\n      }\n      /**\n       * @type {ol.StyleFunction|undefined}\n       */\n      const layerStyle = olLayer.getStyleFunction();\n      const styles = this.computePlainStyle(olLayer, feature, layerStyle,\n          resolution);\n      if (!styles || !styles.length) {\n        // only 'render' features with a style\n        continue;\n      }\n\n      /**\n       * @type {Cesium.Primitive|null}\n       */\n      let primitives = null;\n      for (let i = 0; i < styles.length; i++) {\n        const prims = this.olFeatureToCesium(olLayer, feature, styles[i], context);\n        if (prims) {\n          if (!primitives) {\n            primitives = prims;\n          } else if (prims) {\n            let i = 0, prim;\n            while ((prim = prims.get(i))) {\n              primitives.add(prim);\n              i++;\n            }\n          }\n        }\n      }\n      if (!primitives) {\n        continue;\n      }\n      featurePrimitiveMap[getUid(feature)] = primitives;\n      counterpart.getRootPrimitive().add(primitives);\n    }\n\n    return counterpart;\n  }\n\n  /**\n   * Convert an OpenLayers feature to Cesium primitive collection.\n   * @param {!(ol.layer.Vector|ol.layer.Image)} layer\n   * @param {!ol.View} view\n   * @param {!ol.Feature} feature\n   * @param {!import('olcs/core/VectorLayerConterpart.js').OlFeatureToCesiumContext} context\n   * @return {Cesium.Primitive}\n   * @api\n   */\n  convert(layer, view, feature, context) {\n    const proj = view.getProjection();\n    const resolution = view.getResolution();\n\n    if (resolution == undefined || !proj) {\n      return null;\n    }\n\n    /**\n     * @type {ol.StyleFunction|undefined}\n     */\n    const layerStyle = layer.getStyleFunction();\n\n    const styles = this.computePlainStyle(layer, feature, layerStyle, resolution);\n\n    if (!styles || !styles.length) {\n      // only 'render' features with a style\n      return null;\n    }\n\n    context.projection = proj;\n\n    /**\n     * @type {Cesium.Primitive|null}\n     */\n    let primitives = null;\n    for (let i = 0; i < styles.length; i++) {\n      const prims = this.olFeatureToCesium(layer, feature, styles[i], context);\n      if (!primitives) {\n        primitives = prims;\n      } else if (prims) {\n        let i = 0, prim;\n        while ((prim = prims.get(i))) {\n          primitives.add(prim);\n          i++;\n        }\n      }\n    }\n    return primitives;\n  }\n}\n\n\nexport default FeatureConverter;\n","import MVT from 'ol/format/MVT.js';\nimport Style from 'ol/style/Style.js';\nimport Stroke from 'ol/style/Stroke.js';\nimport {toContext} from 'ol/render.js';\nimport {get as getProjection} from 'ol/proj.js';\nimport {VERSION as OL_VERSION} from 'ol/util.js';\nimport LRUCache from 'ol/structs/LRUCache.js';\nimport {getForProjection as getTilegridForProjection} from 'ol/tilegrid.js';\nimport {createFromTemplates as createTileUrlFunctions} from 'ol/tileurlfunction.js';\n\n\nconst format = new MVT();\nconst styles = [new Style({\n  stroke: new Stroke({\n    color: 'blue',\n    width: 2\n  })\n})];\n\n\nexport default class MVTImageryProvider {\n  constructor(options) {\n    this.urls = options.urls;\n    this.ready = true;\n    this.readyPromise = Promise.resolve(true);\n    this.tileWidth = 256;\n    this.tileHeight = 256;\n    this.maximumLevel = options.maximumLevel || 20;\n    this.minimumLevel = options.minimumLevel || 0;\n    this.tilingScheme = new Cesium.WebMercatorTilingScheme;\n    this.rectangle = options.rectangle || this.tilingScheme.rectangle;\n    this.errorEvent = new Cesium.Event();\n    this.credit = options.credit;\n    this.hasAlphaChannel = true;\n    this.styleFunction_ = options.styleFunction || (() => styles);\n    this.projection_ = getProjection('EPSG:3857');\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n    this.tileRectangle_ = new Cesium.Rectangle();\n    const cacheSize = options.cacheSize !== undefined ? options.cacheSize : 50;\n    this.tileCache = new LRUCache(cacheSize);\n    this.featureCache = options.featureCache || new LRUCache(cacheSize);\n    // to avoid too frequent cache grooming we allow x2 capacity\n\n    const tileGrid = getTilegridForProjection(this.projection_);\n    this.tileFunction_ = createTileUrlFunctions(this.urls, tileGrid);\n  }\n\n  getTileCredits() {\n    return [];\n  }\n\n  pickFeatures() {\n  }\n\n\n  getTileFeatures(z, x, y) {\n    const cacheKey = this.getCacheKey_(z, x, y);\n    let promise;\n    if (this.featureCache.containsKey(cacheKey)) {\n      promise = this.featureCache.get(cacheKey);\n    }\n    if (!promise) {\n      const url = this.getUrl_(z, x, y);\n      promise = fetch(url)\n          .then(r => (r.ok ? r : Promise.reject(r)))\n          .then(r => r.arrayBuffer())\n          .then(buffer => this.readFeaturesFromBuffer(buffer));\n      this.featureCache.set(cacheKey, promise);\n      if (this.featureCache.getCount() > 2 * this.featureCache.highWaterMark) {\n        while (this.featureCache.canExpireCache()) {\n          this.featureCache.pop();\n        }\n      }\n    }\n    return promise;\n  }\n\n  readFeaturesFromBuffer(buffer) {\n    let options;\n    if (OL_VERSION <= '6.4.4') {\n      // See https://github.com/openlayers/openlayers/pull/11540\n      options = {\n        extent: [0, 0, 4096, 4096],\n        dataProjection: format.dataProjection,\n        featureProjection: format.dataProjection\n      };\n    }\n    const features = format.readFeatures(buffer, options);\n    const scaleFactor = this.tileWidth / 4096;\n    features.forEach((f) => {\n      const flatCoordinates = f.getFlatCoordinates();\n      let flip = false;\n      for (let i = 0; i < flatCoordinates.length; ++i) {\n        flatCoordinates[i] *= scaleFactor;\n        if (flip) {\n          // FIXME: why do we need this now?\n          flatCoordinates[i] = this.tileWidth - flatCoordinates[i];\n        }\n        if (OL_VERSION <= '6.4.4') {\n          flip = !flip;\n        }\n      }\n    });\n\n    return features;\n  }\n\n  getUrl_(z, x, y) {\n    const url = this.tileFunction_([z, x, y]);\n    return url;\n  }\n\n  getCacheKey_(z, x, y) {\n    return `${z}_${x}_${y}`;\n  }\n\n  requestImage(x, y, z, request) {\n    if (z < this.minimumLevel) {\n      return this.emptyCanvas_;\n    }\n\n    try {\n      const cacheKey = this.getCacheKey_(z, x, y);\n      let promise;\n      if (this.tileCache.containsKey(cacheKey)) {\n        promise = this.tileCache.get(cacheKey);\n      }\n      if (!promise) {\n        promise = this.getTileFeatures(z, x, y)\n            .then((features) => {\n            // FIXME: here we suppose the 2D projection is in meters\n              this.tilingScheme.tileXYToNativeRectangle(x, y, z, this.tileRectangle_);\n              const resolution = (this.tileRectangle_.east - this.tileRectangle_.west) / this.tileWidth;\n              return this.rasterizeFeatures(features, this.styleFunction_, resolution);\n            });\n        this.tileCache.set(cacheKey, promise);\n        if (this.tileCache.getCount() > 2 * this.tileCache.highWaterMark) {\n          while (this.tileCache.canExpireCache()) {\n            this.tileCache.pop();\n          }\n        }\n      }\n      return promise;\n    } catch (e) {\n      console.trace(e);\n      this.raiseEvent('could not render pbf to tile', e);\n    }\n  }\n\n  rasterizeFeatures(features, styleFunction, resolution) {\n    const canvas = document.createElement('canvas');\n    const vectorContext = toContext(canvas.getContext('2d'), {size: [this.tileWidth, this.tileHeight]});\n    features.forEach((f) => {\n      const styles = styleFunction(f, resolution);\n      if (styles) {\n        styles.forEach((style) => {\n          vectorContext.setStyle(style);\n          vectorContext.drawGeometry(f);\n        });\n      }\n    });\n    return canvas;\n  }\n}\n","/**\n * @module olcs.OverlaySynchronizer\n */\nimport olcsSynchronizedOverlay from './SynchronizedOverlay.js';\nimport {getUid} from './util.js';\n\nclass OverlaySynchronizer {\n  /**\n  * @param {!ol.Map} map\n  * @param {!Cesium.Scene} scene\n  * @constructor\n  * @template T\n  * @api\n  */\n  constructor(map, scene) {\n    /**\n    * @type {!ol.Map}\n    * @protected\n    */\n    this.map = map;\n\n    /**\n    * @type {ol.Collection.<ol.Overlay>}\n    * @private\n    */\n    this.overlays_ = this.map.getOverlays();\n\n    /**\n    * @type {!Cesium.Scene}\n    * @protected\n    */\n    this.scene = scene;\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainerStopEvent_ = document.createElement('DIV');\n    this.overlayContainerStopEvent_.className = 'ol-overlaycontainer-stopevent';\n    const overlayEvents = ['click', 'dblclick', 'mousedown', 'touchstart', 'pointerdown', 'mousewheel', 'wheel'];\n    overlayEvents.forEach((event) => {\n      this.overlayContainerStopEvent_.addEventListener(event, evt => evt.stopPropagation());\n    });\n    this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_);\n\n    /**\n    * @private\n    * @type {!Element}\n    */\n    this.overlayContainer_ = document.createElement('DIV');\n    this.overlayContainer_.className = 'ol-overlaycontainer';\n    this.scene.canvas.parentElement.appendChild(this.overlayContainer_);\n\n\n    /**\n    * @type {!Object<?,olcs.SynchronizedOverlay>}\n    * @private\n    */\n    this.overlayMap_ = {};\n  }\n\n  /**\n  * Get the element that serves as a container for overlays that don't allow\n  * event propagation. Elements added to this container won't let mousedown and\n  * touchstart events through to the map, so clicks and gestures on an overlay\n  * don't trigger any {@link ol.MapBrowserEvent}.\n  * @return {!Element} The map's overlay container that stops events.\n  */\n  getOverlayContainerStopEvent() {\n    return this.overlayContainerStopEvent_;\n  }\n\n  /**\n  * Get the element that serves as a container for overlays.\n  * @return {!Element} The map's overlay container.\n  */\n  getOverlayContainer() {\n    return this.overlayContainer_;\n  }\n\n  /**\n  * Destroy all and perform complete synchronization of the overlays.\n  * @api\n  */\n  synchronize() {\n    this.destroyAll();\n    this.addOverlays();\n    this.overlays_.on('add', this.addOverlayFromEvent_.bind(this));\n    this.overlays_.on('remove', this.removeOverlayFromEvent_.bind(this));\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  addOverlayFromEvent_(event) {\n    const overlay = /** @type {ol.Overlay} */ (event.element);\n    this.addOverlay(overlay);\n  }\n\n  /**\n  * @api\n  */\n  addOverlays() {\n    this.overlays_.forEach((overlay) => { this.addOverlay(overlay); });\n  }\n\n  /**\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  addOverlay(overlay) {\n    if (!overlay) {\n      return;\n    }\n    const cesiumOverlay = new olcsSynchronizedOverlay({\n      scene: this.scene,\n      synchronizer: this,\n      parent: overlay\n    });\n\n    const overlayId = getUid(overlay).toString();\n    this.overlayMap_[overlayId] = cesiumOverlay;\n  }\n\n  /**\n  * @param {ol.Collection.Event} event\n  * @private\n  */\n  removeOverlayFromEvent_(event) {\n    const removedOverlay = /** @type {ol.Overlay} */ (event.element);\n    this.removeOverlay(removedOverlay);\n  }\n\n  /**\n  * Removes an overlay from the scene\n  * @param {ol.Overlay} overlay\n  * @api\n  */\n  removeOverlay(overlay) {\n    const overlayId = getUid(overlay).toString();\n    const csOverlay = this.overlayMap_[overlayId];\n    if (csOverlay) {\n      csOverlay.destroy();\n      delete this.overlayMap_[overlayId];\n    }\n  }\n\n  /**\n  * Destroys all the created Cesium objects.\n  * @protected\n  */\n  destroyAll() {\n    Object.keys(this.overlayMap_).forEach((key) => {\n      const overlay = this.overlayMap_[key];\n      overlay.destroy();\n      delete this.overlayMap_[key];\n    });\n  }\n}\n\n\nexport default OverlaySynchronizer;\n","/**\n * @module olcs.SynchronizedOverlay\n */\nimport olOverlay from 'ol/Overlay.js';\nimport {transform} from 'ol/proj.js';\nimport {removeNode, removeChildren} from './util.js';\nimport {unByKey as olObservableUnByKey} from 'ol/Observable.js';\n\n\n/**\n * Options for SynchronizedOverlay\n * @typedef {Object} SynchronizedOverlayOptions\n * @property {!Cesium.Scene} scene\n * @property {olOverlay} parent\n * @property {!import('olsc/OverlaySynchronizer.js').default} synchronizer\n */\n\n\nclass SynchronizedOverlay extends olOverlay {\n  /**\n   * @param {olcsx.SynchronizedOverlayOptions} options SynchronizedOverlay Options.\n   * @api\n   */\n  constructor(options) {\n    const parent = options.parent;\n    super(parent.getOptions());\n\n    /**\n     * @private\n     * @type {?Function}\n     */\n    this.scenePostRenderListenerRemover_ = null;\n\n    /**\n     * @private\n     * @type {!Cesium.Scene}\n     */\n    this.scene_ = options.scene;\n\n    /**\n     * @private\n     * @type {!olcs.OverlaySynchronizer}\n     */\n    this.synchronizer_ = options.synchronizer;\n\n    /**\n     * @private\n     * @type {!ol.Overlay}\n     */\n    this.parent_ = parent;\n\n    /**\n     * @private\n     * @type {ol.Coordinate|undefined}\n     */\n    this.positionWGS84_ = undefined;\n\n    /**\n     * @private\n     * @type {MutationObserver}\n     */\n    this.observer_ = new MutationObserver(this.handleElementChanged.bind(this));\n\n    /**\n     * @private\n     * @type {Array.<MutationObserver>}\n     */\n    this.attributeObserver_ = [];\n\n    /**\n     * @private\n     * @type {Array<ol.EventsKey>}\n     */\n    this.listenerKeys_ = [];\n    // synchronize our Overlay with the parent Overlay\n    const setPropertyFromEvent = event => this.setPropertyFromEvent_(event);\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:element', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:offset', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:position', setPropertyFromEvent));\n    this.listenerKeys_.push(this.parent_.on('change:positioning', setPropertyFromEvent));\n\n    this.setProperties(this.parent_.getProperties());\n\n    this.handleMapChanged();\n    this.handleElementChanged();\n  }\n\n  /**\n   * @param {Node} target\n   * @private\n   */\n  observeTarget_(target) {\n    if (!this.observer_) {\n      // not ready, skip the event (this occurs on construction)\n      return;\n    }\n    this.observer_.disconnect();\n    this.observer_.observe(target, {\n      attributes: false,\n      childList: true,\n      characterData: true,\n      subtree: true\n    });\n    this.attributeObserver_.forEach((observer) => {\n      observer.disconnect();\n    });\n    this.attributeObserver_.length = 0;\n    for (let i = 0; i < target.childNodes.length; i++) {\n      const node = target.childNodes[i];\n      if (node.nodeType === 1) {\n        const observer = new MutationObserver(this.handleElementChanged.bind(this));\n        observer.observe(node, {\n          attributes: true,\n          subtree: true\n        });\n        this.attributeObserver_.push(observer);\n      }\n    }\n  }\n\n  /**\n   *\n   * @param {ol.Object.Event} event\n   * @private\n   */\n  setPropertyFromEvent_(event) {\n    if (event.target && event.key) {\n      this.set(event.key, event.target.get(event.key));\n    }\n  }\n\n  /**\n   * Get the scene associated with this overlay.\n   * @see ol.Overlay.prototype.getMap\n   * @return {!Cesium.Scene} The scene that the overlay is part of.\n   * @api\n   */\n  getScene() {\n    return this.scene_;\n  }\n\n  /**\n   * @override\n   */\n  handleMapChanged() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n      removeNode(this.element);\n    }\n    this.scenePostRenderListenerRemover_ = null;\n    const scene = this.getScene();\n    if (scene) {\n      this.scenePostRenderListenerRemover_ = scene.postRender.addEventListener(this.updatePixelPosition.bind(this));\n      this.updatePixelPosition();\n      const container = this.stopEvent ?\n        this.synchronizer_.getOverlayContainerStopEvent() : this.synchronizer_.getOverlayContainer();\n      if (this.insertFirst) {\n        container.insertBefore(this.element, container.childNodes[0] || null);\n      } else {\n        container.appendChild(this.element);\n      }\n    }\n  }\n\n  /**\n   * @override\n   */\n  handlePositionChanged() {\n    // transform position to WGS84\n    const position = this.getPosition();\n    if (position) {\n      const sourceProjection = this.parent_.getMap().getView().getProjection();\n      this.positionWGS84_ = transform(position, sourceProjection, 'EPSG:4326');\n    } else {\n      this.positionWGS84_ = undefined;\n    }\n    this.updatePixelPosition();\n  }\n\n  /**\n   * @override\n   */\n  handleElementChanged() {\n    function cloneNode(node, parent) {\n      const clone = node.cloneNode();\n      if (node.nodeName === 'CANVAS') {\n        const ctx = clone.getContext('2d');\n        ctx.drawImage(node, 0, 0);\n      }\n      if (parent) {\n        parent.appendChild(clone);\n      }\n      if (node.nodeType != Node.TEXT_NODE) {\n        clone.addEventListener('click', (event) => {\n          node.dispatchEvent(new MouseEvent('click', event));\n          event.stopPropagation();\n        });\n      }\n      const nodes = node.childNodes;\n      for (let i = 0; i < nodes.length; i++) {\n        if (!nodes[i]) {\n          continue;\n        }\n        cloneNode(nodes[i], clone);\n      }\n      return clone;\n    }\n    removeChildren(this.element);\n    const element = this.getElement();\n    if (element) {\n      if (element.parentNode && element.parentNode.childNodes) {\n        for (const node of element.parentNode.childNodes) {\n          const clonedNode = cloneNode(node, null);\n          this.element.appendChild(clonedNode);\n        }\n      }\n    }\n    if (element.parentNode) {\n      // set new Observer\n      this.observeTarget_(element.parentNode);\n    }\n  }\n\n  /**\n   * @override\n   */\n  updatePixelPosition() {\n    const position = this.positionWGS84_;\n    if (!this.scene_ || !position) {\n      this.setVisible(false);\n      return;\n    }\n    let height = 0;\n    if (position.length === 2) {\n      const globeHeight = this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(position[0], position[1]));\n      if (globeHeight && this.scene_.globe.tilesLoaded) {\n        position[2] = globeHeight;\n      }\n      if (globeHeight) {\n        height = globeHeight;\n      }\n    } else {\n      height = position[2];\n    }\n    const cartesian = Cesium.Cartesian3.fromDegrees(position[0], position[1], height);\n    const camera = this.scene_.camera;\n    const ellipsoidBoundingSphere = new Cesium.BoundingSphere(new Cesium.Cartesian3(), 6356752);\n    const occluder = new Cesium.Occluder(ellipsoidBoundingSphere, camera.position);\n    // check if overlay position is behind the horizon\n    if (!occluder.isPointVisible(cartesian)) {\n      this.setVisible(false);\n      return;\n    }\n    const cullingVolume = camera.frustum.computeCullingVolume(camera.position, camera.direction, camera.up);\n    // check if overlay position is visible from the camera\n    if (cullingVolume.computeVisibility(new Cesium.BoundingSphere(cartesian)) !== 1) {\n      this.setVisible(false);\n      return;\n    }\n    this.setVisible(true);\n\n    const pixelCartesian = this.scene_.cartesianToCanvasCoordinates(cartesian);\n    const pixel = [pixelCartesian.x, pixelCartesian.y];\n    const mapSize = [this.scene_.canvas.width, this.scene_.canvas.height];\n    this.updateRenderedPosition(pixel, mapSize);\n  }\n\n  /**\n   * Destroys the overlay, removing all its listeners and elements\n   * @api\n   */\n  destroy() {\n    if (this.scenePostRenderListenerRemover_) {\n      this.scenePostRenderListenerRemover_();\n    }\n    if (this.observer_) {\n      this.observer_.disconnect();\n    }\n    olObservableUnByKey(this.listenerKeys_);\n    this.listenerKeys_.splice(0);\n    if (this.element.removeNode) {\n      this.element.removeNode(true);\n    } else {\n      this.element.remove();\n    }\n    this.element = null;\n  }\n}\n\nexport default SynchronizedOverlay;\n","/**\n * @module olcs.contrib.LazyLoader\n */\nexport default class LazyLoader {\n  /**\n   * @param {string} url\n   * @api\n   */\n  constructor(url) {\n    /**\n     * @type {Promise<undefined>}\n     * @protected\n     */\n    this.promise;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.url_ = url;\n  }\n\n  /**\n   * @return {Promise<undefined>}\n   * @api\n   */\n  load() {\n    if (!this.promise) {\n      // not yet loading\n      this.promise = new Promise((resolve, reject) => {\n        const script = document.createElement('script');\n        script.onload = () => resolve();\n        script.onerror = () => reject();\n        document.head.appendChild(script);\n        script.src = this.url_;\n      });\n    }\n    return this.promise;\n  }\n}\n","/**\n * @module olcs.contrib.Manager\n */\nimport olcsContribLazyLoader from '../contrib/LazyLoader.js';\nimport OLCesium from '../OLCesium.ts';\nimport {resetToNorthZenith, rotateAroundBottomCenter, computeSignedTiltAngleOnGlobe, pickBottomPoint, setHeadingUsingBottomCenter, limitCameraToBoundingSphere} from '../core.ts';\nimport {toRadians} from '../math.js';\nimport olObservable from 'ol/Observable.js';\n\n\n/**\n * @typedef {Object} ManagerOptions\n * @property {import('ol/Map.js').default} map\n * @property {import('ol/extent.js').Extent} [cameraExtentInRadians]\n * @property {string} [cesiumIonDefaultAccessToken]\n */\n\n\nconst Manager = class extends olObservable {\n  /**\n   * @param {string} cesiumUrl\n   * @param {olcsx.contrib.ManagerOptions} options\n   * @api\n   */\n  constructor(cesiumUrl, {map, cameraExtentInRadians, cesiumIonDefaultAccessToken} = {}) {\n\n    super();\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumUrl_ = cesiumUrl;\n\n    /**\n     * @type {ol.Map}\n     * @protected\n     */\n    this.map = map;\n\n    /**\n     * @type {ol.Extent}\n     * @protected\n     */\n    this.cameraExtentInRadians = cameraExtentInRadians || null;\n\n    /**\n     * @private\n     * @type {Cesium.BoundingSphere}\n     */\n    this.boundingSphere_;\n\n    /**\n     * @type {Promise.<olcs.OLCesium>}\n     * @private\n     */\n    this.promise_;\n\n    /**\n     * @type {string}\n     * @private\n     */\n    this.cesiumIonDefaultAccessToken_ = cesiumIonDefaultAccessToken;\n\n    /**\n     * @type {olcs.OLCesium}\n     * @protected\n     */\n    this.ol3d;\n\n    /**\n     * @const {number} Tilt angle in radians\n     * @private\n     */\n    this.cesiumInitialTilt_ = toRadians(50);\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogDensity = 0.0001;\n\n    /**\n     * @protected\n     * @type {number}\n     */\n    this.fogSSEFactor = 25;\n\n    /**\n     * Limit the minimum distance to the terrain to 2m.\n     * @protected\n     * @type {number}\n     */\n    this.minimumZoomDistance = 2;\n\n    /**\n     * Limit the maximum distance to the earth to 10'000km.\n     * @protected\n     * @type {number}\n     */\n    this.maximumZoomDistance = 10000000;\n\n    // when closer to 3000m, restrict the available positions harder\n    /**\n     * @protected\n     * @param {number} height\n     */\n    this.limitCameraToBoundingSphereRatio = height => (height > 3000 ? 9 : 3);\n  }\n\n\n  /**\n   * @return {Promise.<olcs.OLCesium>}\n   */\n  load() {\n    if (!this.promise_) {\n      const cesiumLazyLoader = new olcsContribLazyLoader(this.cesiumUrl_);\n      this.promise_ = cesiumLazyLoader.load().then(() => this.onCesiumLoaded());\n    }\n    return this.promise_;\n  }\n\n\n  /**\n   * @protected\n   * @return {olcs.OLCesium}\n   */\n  onCesiumLoaded() {\n    if (this.cameraExtentInRadians) {\n      const rect = new Cesium.Rectangle(...this.cameraExtentInRadians);\n      // Set the fly home rectangle\n      Cesium.Camera.DEFAULT_VIEW_RECTANGLE = rect;\n      this.boundingSphere_ = Cesium.BoundingSphere.fromRectangle3D(rect, Cesium.Ellipsoid.WGS84, 300); // lux mean height is 300m\n    }\n\n    if (this.cesiumIonDefaultAccessToken_) {\n      Cesium.Ion.defaultAccessToken = this.cesiumIonDefaultAccessToken_;\n    }\n\n    this.ol3d = this.instantiateOLCesium();\n    const scene = this.ol3d.getCesiumScene();\n    this.configureForUsability(scene);\n    this.configureForPerformance(scene);\n    this.dispatchEvent('load');\n    return this.ol3d;\n  }\n\n\n  /**\n   * Application code should override this method.\n   * @return {olcs.OLCesium}\n   */\n  instantiateOLCesium() {\n    console.assert(this.map);\n    const ol3d = new OLCesium({map: this.map});\n    const scene = ol3d.getCesiumScene();\n    if (Cesium.createWorldTerrain) {\n      const terrainProvider = Cesium.createWorldTerrain();\n      scene.terrainProvider = terrainProvider;\n    } else {\n      // v107+\n      Cesium.createWorldTerrainAsync().then(tp => scene.terrainProvider = tp);\n    }\n\n    return ol3d;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForPerformance(scene) {\n    const fog = scene.fog;\n    fog.enabled = true;\n    fog.density = this.fogDensity;\n    fog.screenSpaceErrorFactor = this.fogSSEFactor;\n  }\n\n\n  /**\n   * @param {!Cesium.Scene} scene The scene, passed as parameter for convenience.\n   * @protected\n   */\n  configureForUsability(scene) {\n    const sscController = scene.screenSpaceCameraController;\n    sscController.minimumZoomDistance = this.minimumZoomDistance;\n    sscController.maximumZoomDistance = this.maximumZoomDistance;\n\n    // Do not see through the terrain. Seeing through the terrain does not make\n    // sense anyway, except for debugging\n    scene.globe.depthTestAgainstTerrain = true;\n\n    // Use white instead of the black default colour for the globe when tiles are missing\n    scene.globe.baseColor = Cesium.Color.WHITE;\n    scene.backgroundColor = Cesium.Color.WHITE;\n\n    if (this.boundingSphere_) {\n      scene.postRender.addEventListener(this.limitCameraToBoundingSphere.bind(this));\n    }\n    // Stop rendering Cesium when there is nothing to do. This drastically reduces CPU/GPU consumption.\n    this.ol3d.enableAutoRenderLoop();\n  }\n\n  /**\n   * Constrain the camera so that it stays close to the bounding sphere of the map extent.\n   * Near the ground the allowed distance is shorter.\n   * @protected\n   */\n  limitCameraToBoundingSphere() {\n    const scene = this.ol3d.getCesiumScene();\n    limitCameraToBoundingSphere(scene.camera, this.boundingSphere_, this.limitCameraToBoundingSphereRatio);\n  }\n\n  /**\n   * Enable or disable ol3d with a default animation.\n   * @export\n   * @return {Promise<undefined>}\n   */\n  toggle3d() {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      if (is3DCurrentlyEnabled) {\n        // Disable 3D\n        console.assert(this.map);\n        return resetToNorthZenith(this.map, scene).then(() => {\n          ol3d.setEnabled(false);\n          this.dispatchEvent('toggle');\n        });\n      } else {\n        // Enable 3D\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n        return rotateAroundBottomCenter(scene, this.cesiumInitialTilt_);\n      }\n    });\n  }\n\n\n  /**\n   * Enable ol3d with a view built from parameters.\n   *\n   * @export\n   * @param {number} lon\n   * @param {number} lat\n   * @param {number} elevation\n   * @param {number} headingDeg Heading value in degrees.\n   * @param {number} pitchDeg Pitch value in degrees.\n   * @returns {Promise<undefined>}\n   */\n  set3dWithView(lon, lat, elevation, headingDeg, pitchDeg) {\n    return this.load().then((/** @const {!olcs.OLCesium} */ ol3d) => {\n      const is3DCurrentlyEnabled = ol3d.getEnabled();\n      const scene = ol3d.getCesiumScene();\n      const camera = scene.camera;\n      const destination = Cesium.Cartesian3.fromDegrees(lon, lat, elevation);\n      const heading = Cesium.Math.toRadians(headingDeg);\n      const pitch = Cesium.Math.toRadians(pitchDeg);\n      const roll = 0;\n      const orientation = {heading, pitch, roll};\n\n      if (!is3DCurrentlyEnabled) {\n        ol3d.setEnabled(true);\n        this.dispatchEvent('toggle');\n      }\n\n      camera.setView({\n        destination,\n        orientation\n      });\n    });\n  }\n\n\n  /**\n   * @export\n   * @return {boolean}\n   */\n  is3dEnabled() {\n    return !!this.ol3d && this.ol3d.getEnabled();\n  }\n\n\n  /**\n   * @return {number}\n   */\n  getHeading() {\n    return this.map ? this.map.getView().getRotation() || 0 : 0;\n  }\n\n\n  /**\n   * @return {number|undefined}\n   */\n  getTiltOnGlobe() {\n    const scene = this.ol3d.getCesiumScene();\n    const tiltOnGlobe = computeSignedTiltAngleOnGlobe(scene);\n    return -tiltOnGlobe;\n  }\n\n\n  /**\n   * @param {number} angle\n   */\n  setHeading(angle) {\n    const scene = this.ol3d.getCesiumScene();\n    const bottom = pickBottomPoint(scene);\n    if (bottom) {\n      setHeadingUsingBottomCenter(scene, angle, bottom);\n    }\n  }\n\n  /**\n   * @export\n   * @return {olcs.OLCesium}\n   */\n  getOl3d() {\n    return this.ol3d;\n  }\n\n  /**\n   * @export\n   * @return {!ol.View}\n   */\n  getOlView() {\n    const view = this.map.getView();\n    console.assert(view);\n    return view;\n  }\n\n  /**\n   * @export\n   * @return {Cesium.Matrix4}\n   */\n  getCesiumViewMatrix() {\n    return this.ol3d.getCesiumScene().camera.viewMatrix;\n  }\n\n  /**\n   * @export\n   * @return {!Cesium.Scene}\n   */\n  getCesiumScene() {\n    return this.ol3d.getCesiumScene();\n  }\n\n  /**\n   * @export\n   * @param {!Cesium.Rectangle} rectangle\n   * @param {number=} offset in meters\n   * @return {Promise<undefined>}\n   */\n  flyToRectangle(rectangle, offset = 0) {\n    const camera = this.getCesiumScene().camera;\n    const destination = camera.getRectangleCameraCoordinates(rectangle);\n\n    const mag = Cesium.Cartesian3.magnitude(destination) + offset;\n    Cesium.Cartesian3.normalize(destination, destination);\n    Cesium.Cartesian3.multiplyByScalar(destination, mag, destination);\n\n    return new Promise((resolve, reject) => {\n      if (!this.cameraExtentInRadians) {\n        reject();\n        return;\n      }\n\n      camera.flyTo({\n        destination,\n        complete: () => resolve(),\n        cancel: () => reject(),\n        endTransform: Cesium.Matrix4.IDENTITY\n      });\n    });\n  }\n\n  /**\n   * @protected\n   * @return {Cesium.Rectangle|undefined}\n   */\n  getCameraExtentRectangle() {\n    if (this.cameraExtentInRadians) {\n      return new Cesium.Rectangle(...this.cameraExtentInRadians);\n    }\n  }\n};\n\n\nexport default Manager;\n","/**\n * @module olcs.core.OLImageryProvider\n */\nimport {getSourceProjection} from '../util.js';\nimport {Tile as TileSource} from 'ol/source.js';\nimport {attributionsFunctionToCredits} from '../core.ts';\n\n\nconst olUseNewCoordinates = (function() {\n  const tileSource = new TileSource({\n    projection: 'EPSG:3857',\n    wrapX: true\n  });\n  const tileCoord = tileSource.getTileCoordForTileUrlFunction([6, -31, 22]);\n  return tileCoord && tileCoord[1] === 33 && tileCoord[2] === 22;\n  // See b/test/spec/ol/source/tile.test.js\n  // of e9a30c5cb7e3721d9370025fbe5472c322847b35 in OpenLayers repository\n})();\n\n\nclass OLImageryProvider /* should not extend Cesium.ImageryProvider */ {\n  /**\n   * Special class derived from Cesium.ImageryProvider\n   * that is connected to the given ol.source.TileImage.\n   * @param {!ol.Map} olMap\n   * @param {!ol.source.TileImage} source\n   * @param {ol.proj.Projection=} opt_fallbackProj Projection to assume if the\n   *                                               projection of the source is not defined.\n   * @constructor\n   * @extends {Cesium.ImageryProvider}\n   */\n  constructor(olMap, source, opt_fallbackProj) {\n    // Do not extend or call super constructor from\n    // Cesium.ImageryProvider since this particular function is a\n    // 'non instanciable interface' which throws on instanciation.\n\n    /**\n     * @type {!ol.source.TileImage}\n     * @private\n     */\n    this.source_ = source;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.projection_ = null;\n\n    /**\n     * @type {?ol.proj.Projection}\n     * @private\n     */\n    this.fallbackProj_ = opt_fallbackProj || null;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.ready_ = false;\n\n    /**\n     * @type {?Cesium.TilingScheme}\n     * @private\n     */\n    this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(); // cesium v107+ don't wait for ready anymore\n\n    /**\n     * @type {?Cesium.Rectangle}\n     * @private\n     */\n    this.rectangle_ = null;\n\n    /**\n     * @type {!ol.Map}\n     * @private\n     */\n    this.map_ = olMap;\n\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.shouldRequestNextLevel = false;\n\n    const proxy = this.source_.get('olcs.proxy');\n    if (proxy) {\n      if (typeof proxy === 'function') {\n        this.proxy_ = {\n          'getURL': proxy\n        };\n      } else if (typeof proxy === 'string') {\n        this.proxy_ = new Cesium.DefaultProxy(proxy);\n      }\n    }\n\n    this.errorEvent_ = new Cesium.Event();\n\n    this.emptyCanvas_ = document.createElement('canvas');\n    this.emptyCanvas_.width = 1;\n    this.emptyCanvas_.height = 1;\n\n    this.source_.on('change', (e) => {\n      this.handleSourceChanged_();\n    });\n    this.handleSourceChanged_();\n  }\n\n  /**\n   * Checks if the underlying source is ready and cached required data.\n   * @private\n   */\n  handleSourceChanged_(frameState) {\n    if (!this.ready_ && this.source_.getState() == 'ready') {\n      this.projection_ = getSourceProjection(this.source_) || this.fallbackProj_;\n      const options = {numberOfLevelZeroTilesX: 1, numberOfLevelZeroTilesY: 1};\n\n      if (this.source_.tileGrid !== null) {\n        // Get the number of tiles at level 0 if it is defined\n        this.source_.tileGrid.forEachTileCoord(this.projection_.getExtent(), 0, ([zoom, xIndex, yIndex]) => {\n          options.numberOfLevelZeroTilesX = xIndex + 1;\n          options.numberOfLevelZeroTilesY = yIndex + 1;\n        });\n      }\n\n      if (this.projection_.getCode() === 'EPSG:4326') {\n        // Cesium zoom level 0 is OpenLayers zoom level 1 for layer in EPSG:4326 with a single tile on level 0\n        this.shouldRequestNextLevel = options.numberOfLevelZeroTilesX === 1 && options.numberOfLevelZeroTilesY === 1;\n        this.tilingScheme_ = new Cesium.GeographicTilingScheme(options);\n      } else if (this.projection_.getCode() === 'EPSG:3857') {\n        this.shouldRequestNextLevel = false;\n        this.tilingScheme_ = new Cesium.WebMercatorTilingScheme(options);\n      } else {\n        return;\n      }\n      this.rectangle_ = this.tilingScheme_.rectangle;\n\n      this.ready_ = true;\n    }\n  }\n\n  /**\n   * Generates the proper attributions for a given position and zoom\n   * level.\n   * @export\n   * @override\n   */\n  getTileCredits(x, y, level) {\n    const attributionsFunction = this.source_.getAttributions();\n    if (!attributionsFunction) {\n      return [];\n    }\n    const extent = this.map_.getView().calculateExtent(this.map_.getSize());\n    const center = this.map_.getView().getCenter();\n    const zoom = this.shouldRequestNextLevel ? level + 1 : level;\n    return attributionsFunctionToCredits(attributionsFunction, zoom, center, extent);\n  }\n\n  /**\n   * @export\n   * @override\n   */\n  requestImage(x, y, level) {\n    const tileUrlFunction = this.source_.getTileUrlFunction();\n    if (tileUrlFunction && this.projection_) {\n\n      const z_ = this.shouldRequestNextLevel ? level + 1 : level;\n\n      let y_ = y;\n      if (!olUseNewCoordinates) {\n        // OpenLayers version 3 to 5 tile coordinates increase from bottom to top\n        y_ = -y - 1;\n      }\n      let url = tileUrlFunction.call(this.source_, [z_, x, y_], 1, this.projection_);\n      if (this.proxy_) {\n        url = this.proxy_.getURL(url);\n      }\n      return url ? Cesium.ImageryProvider.loadImage(this, url) : this.emptyCanvas_;\n    } else {\n      // return empty canvas to stop Cesium from retrying later\n      return this.emptyCanvas_;\n    }\n  }\n}\n\n// definitions of getters that are required to be present\n// in the Cesium.ImageryProvider instance:\nObject.defineProperties(OLImageryProvider.prototype, {\n  'ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  '_ready': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.ready_;}\n  },\n\n  'rectangle': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.rectangle_;}\n  },\n\n  'tileWidth': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[0] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'tileHeight': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? (Array.isArray(tg.getTileSize(0)) ? tg.getTileSize(0)[1] : tg.getTileSize(0)) : 256;\n        }\n  },\n\n  'maximumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          const tg = this.source_.getTileGrid();\n          return tg ? tg.getMaxZoom() : 18;\n        }\n  },\n\n  'minimumLevel': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {\n          // WARNING: Do not use the minimum level (at least until the extent is\n          // properly set). Cesium assumes the minimumLevel to contain only\n          // a few tiles and tries to load them all at once -- this can\n          // freeze and/or crash the browser !\n          return 0;\n          //var tg = this.source_.getTileGrid();\n          //return tg ? tg.getMinZoom() : 0;\n        }\n  },\n\n  'tilingScheme': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.tilingScheme_;}\n  },\n\n  'tileDiscardPolicy': {\n    'get': function() {return undefined;}\n  },\n\n  'errorEvent': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.errorEvent_;}\n  },\n\n  'proxy': {\n    'get': /** @this {olcs.core.OLImageryProvider} */\n        function() {return this.proxy_;}\n  },\n\n  'hasAlphaChannel': {\n    'get': function() {return true;}\n  },\n\n  'pickFeatures': {\n    'get': function() {return undefined;}\n  }\n});\n\n\nexport default OLImageryProvider;\n","/**\n * Converts radians to to degrees.\n *\n * @param {number} angleInRadians Angle in radians.\n * @return {number} Angle in degrees.\n */\nexport function toDegrees(angleInRadians) {\n  return angleInRadians * 180 / Math.PI;\n}\n\n\n/**\n * Converts degrees to radians.\n *\n * @param {number} angleInDegrees Angle in degrees.\n * @return {number} Angle in radians.\n */\nexport function toRadians(angleInDegrees) {\n  return angleInDegrees * Math.PI / 180;\n}\n","/**\n * @module olcs.util\n */\n\n/**\n * Cast to object.\n * @param {Object} param\n * @return {Object}\n */\nexport function obj(param) {\n  return param;\n}\n\n/**\n * @type {boolean|undefined}\n * @private\n */\nlet supportsImageRenderingPixelatedResult_ = undefined;\n\n\n/**\n * @type {string|undefined}\n * @private\n */\nlet imageRenderingValueResult_ = undefined;\n\n\n/**\n * @return {boolean}\n */\nexport function supportsImageRenderingPixelated() {\n  if (supportsImageRenderingPixelatedResult_ === undefined) {\n    const canvas = document.createElement('canvas');\n    canvas.setAttribute('style', 'image-rendering: -moz-crisp-edges; image-rendering: pixelated;');\n    // canvas.style.imageRendering will be undefined, null or an\n    // empty string on unsupported browsers.\n    const tmp = canvas.style['imageRendering']; // non standard\n    supportsImageRenderingPixelatedResult_ = !!tmp;\n    if (supportsImageRenderingPixelatedResult_) {\n      imageRenderingValueResult_ = tmp;\n    }\n  }\n  return supportsImageRenderingPixelatedResult_;\n}\n\n\n/**\n * @return {string}\n */\nexport function imageRenderingValue() {\n  supportsImageRenderingPixelated();\n  return imageRenderingValueResult_ || '';\n}\n\n/**\n * Return the projection of the source that Cesium should use.\n *\n * @param {ol.source.Source} source Source.\n * @returns {ol.proj.Projection} The projection of the source.\n */\nexport function getSourceProjection(source) {\n  return /** @type {ol.proj.Projection} */ (source.get('olcs.projection'))\n  || source.getProjection();\n}\n\n\n/**\n * @param {ol.Observable} observable\n * @param {string} type\n * @param {Function} listener\n * @return {!ol.events.EventsKey}\n */\nexport function olcsListen(observable, type, listener) {\n  // See https://github.com/openlayers/openlayers/pull/8481\n  // ol.events.listen is internal so we use `on` instead.\n  // And since `on` as a convoluted API (can return an EventsKey or an array of them)\n  // we use a cast here.\n  return /** @type {!ol.events.EventsKey} */ (observable.on(type, listener));\n}\n\n/**\n * Counter for getUid.\n * @type {number}\n */\nlet uidCounter_ = 0;\n\n/**\n * Gets a unique ID for an object. This mutates the object so that further calls\n * with the same object as a parameter returns the same value. Unique IDs are generated\n * as a strictly increasing sequence. Adapted from goog.getUid.\n *\n * @param {Object} obj The object to get the unique ID for.\n * @return {number} The unique ID for the object.\n */\nexport function getUid(obj) {\n  return obj.olcs_uid || (obj.olcs_uid = ++uidCounter_);\n}\n\n/**\n * Sort the passed array such that the relative order of equal elements is preverved.\n * See https://en.wikipedia.org/wiki/Sorting_algorithm#Stability for details.\n * @param {Array<*>} arr The array to sort (modifies original).\n * @param {!function(*, *): number} compareFnc Comparison function.\n */\nexport function stableSort(arr, compareFnc) {\n  const length = arr.length;\n  const tmp = Array(arr.length);\n  for (let i = 0; i < length; i++) {\n    tmp[i] = {index: i, value: arr[i]};\n  }\n  tmp.sort((a, b) => compareFnc(a.value, b.value) || a.index - b.index);\n  for (let i = 0; i < arr.length; i++) {\n    arr[i] = tmp[i].value;\n  }\n}\n\n/**\n * @param {Node} node The node to remove.\n * @returns {Node} The node that was removed or null.\n */\nexport function removeNode(node) {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * @param {Node} node The node to remove the children from.\n */\nexport function removeChildren(node) {\n  while (node.lastChild) {\n    node.removeChild(node.lastChild);\n  }\n}\n\n/**\n * @param {Cesium.Scene} scene The scene.\n */\nexport function isGroundPolylinePrimitiveSupported(scene) {\n  const obj = Cesium.GroundPolylinePrimitive;\n  return obj && obj.isSupported(scene);\n}\n\n\nexport function waitReady(object) {\n  const p = object.readyPromise;\n  if (p) {\n    return p;\n  }\n  if (object.ready !== undefined) {\n    if (object.ready) {\n      return Promise.resolve(object);\n    }\n    return new Promise((resolve, _) => {\n      // FIXME: this is crazy\n      // alternative: intercept _ready = true\n      // altnerative: pass a timeout\n      const stopper = setInterval(() => {\n        if (object.ready) {\n          clearInterval(stopper);\n          resolve(object);\n        }\n      }, 20);\n    });\n  }\n  return Promise.reject('Not a readyable object');\n}\n\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import OLCesium from './olcs/OLCesium.ts';\n\nimport AbstractSynchronizer from './olcs/AbstractSynchronizer.ts';\nimport RasterSynchronizer from './olcs/RasterSynchronizer.ts';\nimport VectorSynchronizer from './olcs/VectorSynchronizer.ts';\n\nimport * as core from './olcs/core.ts';\nimport OLImageryProvider from './olcs/core/OLImageryProvider.js';\nimport VectorLayerCounterpart from './olcs/core/VectorLayerCounterpart.ts';\n\nimport LazyLoader from './olcs/contrib/LazyLoader.js';\nimport Manager from './olcs/contrib/Manager.js';\n\n\nexport default OLCesium;\n\nconst olcs = window['olcs'] = {};\nolcs.OLCesium = OLCesium;\n\nolcs.AbstractSynchronizer = AbstractSynchronizer;\nolcs.RasterSynchronizer = RasterSynchronizer;\nolcs.VectorSynchronizer = VectorSynchronizer;\n\nolcs.core = core;\nolcs.core.OLImageryProvider = OLImageryProvider;\nolcs.core.VectorLayerCounterpart = VectorLayerCounterpart;\n\nolcs.contrib = {};\nolcs.contrib.LazyLoader = LazyLoader;\nolcs.contrib.Manager = Manager;\n"],"names":["unByKey","olObservableUnByKey","LayerGroup","getUid","olcsListen","AbstractSynchronizer","constructor","map","scene","layerMap","olLayerListenKeys","olGroupListenKeys_","view","getView","olLayers","getLayerGroup","getLayers","mapLayerGroup","synchronize","destroyAll","addLayers_","orderLayers","root","fifo","layer","parents","length","olLayerWithParents","splice","olLayer","olLayerId","toString","console","assert","cesiumObjects","listenForGroupChanges_","createSingleLayerCounterparts","forEach","l","newOlLayerWithParents","concat","push","layerId","layerWithParents","onLayerChange","cesiumObjs","un","addCesiumObjects_","cesiumObject","addCesiumObject","removeAndDestroySingleLayer_","uid","counterparts","counterpart","removeSingleCesiumObject","destroyCesiumObject","unlistenSingleGroup_","group","keys","key","removeLayer_","done","uuid","undefined","listenKeyArray","contentKeys","listenAddRemove","collection","on","event","element","bind","e","el","i","indexOf","removeAllCesiumObjects","objKey","olGeomPoint","supportsImageRenderingPixelated","imageRenderingValue","ol4326CoordinateToCesiumCartesian","getTransform","olcsAutoRenderLoop","olcsCamera","olcsRasterSynchronizer","olcsVectorSynchronizer","olcsOverlaySynchronizer","BoundingSphereState","DONE","PENDING","FAILED","OLCesium","options","autoRenderLoop_","resolutionScale_","canvasClientWidth_","canvasClientHeight_","resolutionScaleChanged_","enabled_","pausedInteractions_","hiddenRootGroup_","lastFrameTime_","targetFrameRate_","Number","POSITIVE_INFINITY","blockCesiumRendering_","warmingUp_","trackedFeature_","trackedEntity_","entityView_","needTrackedEntityUpdate_","boundingSphereScratch_","Cesium","BoundingSphere","map_","time_","time","JulianDate","now","to4326Transform_","getProjection","fillArea","container_","document","createElement","containerAttribute","createAttribute","value","setAttributeNode","targetElement","target","getViewport","getElementById","appendChild","isOverMap_","stopOpenLayersEventsPropagation","overlayEvents","ii","addEventListener","evt","stopPropagation","canvas_","canvasAttribute","style","oncontextmenu","onselectstart","sceneOptions","canvas","scene3DOnly","scene_","Scene","sscc","screenSpaceCameraController","Array","isArray","tiltEventTypes","log","CameraEventType","LEFT_DRAG","KeyboardEventModifier","SHIFT","ALT","enableLook","camera","constrainedAxis","Cartesian3","UNIT_Z","camera_","globe_","Globe","Ellipsoid","WGS84","baseColor","Color","WHITE","globe","skyAtmosphere","SkyAtmosphere","firstImageryProvider","SingleTileImageryProvider","tileHeight","tileWidth","url","rectangle","Rectangle","fromDegrees","imageryLayers","addImageryProvider","dataSourceCollection_","DataSourceCollection","dataSourceDisplay_","DataSourceDisplay","dataSourceCollection","synchronizers_","createSynchronizers","handleResize_","eventHelper","EventHelper","add","postRender","prototype","updateTrackedEntity_","destroy","cancelAnimationFrame","renderId_","synchronizer","_postRender","remove","render_","requestAnimationFrame","onAnimationFrame_","frameTime","interval","delta","julianDate","initializeFrame","update","trackedEntity","trackedState","getBoundingSphere","radius","render","checkCameraChange","state","enableTilt","bs","EntityView","mapProjection","ellipsoid","width","clientWidth","height","clientHeight","resolutionScale","window","devicePixelRatio","frustum","aspectRatio","getCamera","getOlMap","getOlView","getCesiumScene","getDataSources","getDataSourceDisplay","getEnabled","setEnabled","enable","visibility","interactions","throwOnUnitializedMap_","getInteractions","arr","clear","addInteraction","interaction","removeInteraction","interactionRemoved","filter","removed","rootGroup","getVisible","setVisible","getOverlayContainer","classList","readFromView","updateView","warmUp","timeout","csCamera","position","cartesianToCartographic","cartographicToCartesian","setTimeout","setBlockCesiumRendering","block","enableAutoRenderLoop","getAutoRenderLoop","setResolutionScale","Math","max","restartRenderLoop","setTargetFrameRate","center","getCenter","isDef","isNaN","Error","getResolution","trackedFeature","feature","getGeometry","defaultDataSource","entities","lookAtTransform","Matrix4","IDENTITY","to4326Transform","toCesiumPosition","geometry","coo","getCoordinates","coo4326","CallbackProperty","result","point","pixelSize","color","TRANSPARENT","stableSort","olcsAbstractSynchronizer","tileLayerToImageryLayer","updateCesiumLayerProperties","BaseVectorLayer","RasterSynchronizer","cesiumLayers_","ourLayers_","ImageryLayerCollection","object","get","removeAll","convertLayerToCesiumImageries","viewProj","olLayerItem","previousStyleFunction","getStyleFunction","currentStyleFunction","csObj","_imageryCache","ip","imageryProvider","_ip$tileCache","tileCache","styleFunction_","requestRender","layers","zIndices","queue","getZIndex","sublayers","unshift","getArray","layer1","layer2","raiseToTop","olSourceVector","olLayerLayer","olSourceCluster","olLayerVector","olLayerVectorTile","olcsFeatureConverter","VectorSynchronizer","opt_converter","converter","csAllPrimitives_","PrimitiveCollection","primitives","destroyPrimitives","getRootPrimitive","updateLayerVisibility","csPrimitive","visible","layerVisible","show","source","getSource","featurePrimitiveMap","olVectorLayerToCesium","csPrimitives","olListenKeys","onAddFeature","context","prim","convert","onRemoveFeature","id","bbs","featureToCesiumMap","bb","Billboard","billboards","linear","linearEasing","olLayerTile","olLayerImage","transformExtent","olSourceImageStatic","olSourceImageWMS","olSourceTileImage","olSourceTileWMS","olSourceVectorTile","defaultImageLoadFunction","olcsCoreOLImageryProvider","getSourceProjection","MVTImageryProvider","VectorTileLayer","getExtentCenter","computePixelSizeAtCoordinate","distance","magnitude","subtract","getPixelDimensions","pixelRatio","Cartesian2","computeBoundingBoxAtTarget","amount","transform","Transforms","eastNorthUpToFixedFrame","bottomLeft","multiplyByPoint","x","y","topRight","cartesianArrayToCartographicArray","applyHeightOffsetToGeometry","applyTransform","input","output","stride","createMatrixAtCoordinates","coordinates","rotation","translation","scale","ZERO","rawMatrix","quaternion","Quaternion","fromAxisAngle","rotationMatrix","fromTranslationQuaternionRotationScale","multiply","rotateAroundAxis","angle","axis","opt_options","clamp","defaultValue","duration","easing","callback","lastProgress","oldTransform","start","Date","step","timestamp","timeDifference","progress","clone","stepAngle","rotate","setHeadingUsingBottomCenter","heading","bottomCenter","angleToZenith","computeAngleToZenith","right","Matrix3","fromQuaternion","vector","zenith","multiplyByVector","fromTranslation","pickOnTerrainOrEllipsoid","pixel","ray","getPickRay","pick","pickEllipsoid","pickBottomPoint","bottom","pickCenterPoint","computeSignedTiltAngleOnGlobe","Ray","direction","obj","IntersectionTests","rayEllipsoid","getPoint","normal","geocentricSurfaceNormal","angleBetween","signedAngleBetween","PI","convertLongitudeRange","bottomFovRay","fovy2","fovy","matrix","first","second","a","b","c","normalize","cross","cosine","dot","sine","sign","atan2","pivot","fy","negate","left","extentToRectangle","extent","projection","ext","sourceToImageryProvider","olMap","skip","provider","getUrl","getImageLoadFunction","sourceProps","attributions","getAttributions","params","getParams","setProperties","isCesiumProjection","getImageExtent","fromCode","getCode","split","urls","u","replace","getExtent","minimumLevel","attributionsFunction","styleFunction","credit","attributionsFunctionToCredits","layerOptions","forcedExtent","cesiumLayer","ImageryLayer","csLayer","opacity","layerOpacity","getOpacity","alpha","coordinate","ol4326CoordinateArrayToCsCartesians","toCartesian","cartesians","olGeometryCloneTo4326","proj4326","proj","properties","getProperties","convertColorToCesium","olColor","byteToFloat","fromCssColorString","CanvasPattern","CanvasGradient","ctx","getContext","fillStyle","fillRect","ImageMaterialProperty","image","convertUrlToCesium","subdomains","re","match","exec","startCharCode","charCodeAt","stopCharCode","charCode","String","fromCharCode","resetToNorthZenith","Promise","resolve","reject","currentHeading","getRotation","normalizeView","rotateAroundBottomCenter","resolution","setRotation","constrainResolution","setResolution","getConstrainedResolution","is3857","is4326","zoom","viewState","html","Credit","calcDistanceForResolution","latitude","metersPerUnit","getMetersPerUnit","visibleMapUnits","relativeCircumference","cos","abs","visibleMeters","requiredDistance","tan","calcResolutionForDistance","limitCameraToBoundingSphere","boundingSphere","ratio","blockLimiter","carto","Cartographic","fromCartesian","currentlyFlying","flying","unblockLimiter","flyToBoundingSphere","complete","cancel","VectorLayerCounterpart","layerProjection","BillboardCollection","rootCollection_","AutoRenderLoop","ol3d","_boundNotifyRepaintRequired","notifyRepaintRequired","repaintEventNames_","requestRenderMode","maximumRenderTimeChange","repaintKey","disable","removeEventListener","toRadians","toDegrees","Camera","cam_","view_","viewListenKey_","toLonLat_","identityProjection","fromLonLat_","tilt_","distance_","lastCameraViewMatrix_","viewUpdateInProgress_","setView_","opt_output","opt_dimension","dim","toLonLat","fromLonLat","handleViewEvent_","setHeading","getHeading","setTilt","tilt","updateCamera_","getTilt","setDistance","getDistance","setCenter","setPosition","ll","getAltitude","setView","destination","getPosition","pos","longitude","setAltitude","altitude","getHeight","orientation","pitch","PI_OVER_TWO","roll","moveBackward","bestTarget","positionCartographic","bestTargetCartographic","targetNormal","targetToCamera","up","z","tiltAngle","acos","opt_dontSync","old","current","viewMatrix","equalsEpsilon","olGeomGeometry","olStyleIcon","circular","olCreateCircularPolygon","boundingExtent","olGeomSimpleGeometry","olcsCoreVectorLayerCounterpart","isGroundPolylinePrimitiveSupported","waitReady","FeatureConverter","boundOnRemoveOrClearFeatureListener_","onRemoveOrClearFeature_","defaultBillboardEyeOffset_","cancellers","canceller","hasOwnProperty","setReferenceForPicking","primitive","olFeature","createColoredPrimitive","olGeometry","opt_lineWidth","createInstance","instance","GeometryInstance","attributes","ColorGeometryInstanceAttribute","fromColor","flat","renderState","depthTest","enabled","lineWidth","instances","heightReference","getHeightReference","HeightReference","CLAMP_TO_GROUND","ctor","GroundPrimitive","geometryInstances","Primitive","dataUri","getValue","toDataURL","appearance","MaterialAppearance","material","Material","fabric","type","uniforms","translucent","shadows","extractColorFromOlStyle","outline","fillColor","getFill","getColor","strokeColor","getStroke","extractLineWidthFromOlStyle","getWidth","wrapFillAndOutlineGeometries","fillGeometry","outlineGeometry","olStyle","outlineColor","p1","p2","addTextStyle","getText","text","label","olGeometry4326TextPartToCesium","csAddBillboard","bbOptions","eyeOffset","olCircleGeometryToCesium","getType","slice","getRadius","CircleGeometry","outlinePrimitive","circlePolygon","positions","getLinearRing","createStackedGroundCorridors","GroundPolylinePrimitive","GroundPolylineGeometry","PolylineMaterialAppearance","olStyleToCesium","classificationType","ClassificationType","TERRAIN","then","_primitive","CircleOutlineGeometry","extrudedHeight","previousDistance","geometryOptions","vertexFormat","VertexFormat","POSITION_ONLY","linePositions","CorridorGeometry","distanceDisplayCondition","DistanceDisplayConditionGeometryInstanceAttribute","olLineStringGeometryToCesium","primitiveOptions","PolylineGeometry","olPolygonGeometryToCesium","maxHeight","featureExtrudedHeight","getProperty","RectangleGeometry","RectangleOutlineGeometry","rings","getLinearRings","hierarchy","polygonHierarchy","olPos","holes","PolygonGeometry","perPositionHeight","polylineGeometry","PolygonOutlineGeometry","altitudeMode","NONE","RELATIVE_TO_GROUND","createBillboardFromImage","imageStyle","opt_newBillboardCallback","load","getImage","isImageLoaded","src","naturalHeight","naturalWidth","reallyCreateBillboard","HTMLCanvasElement","Image","HTMLImageElement","getScale","Object","assign","anchor","getAnchor","pixelOffset","cancelled","fuid","listener","isDestroyed","olPointGeometryToCesium","modelPrimitive","olcsModelFunction","olcsModel","cesiumOptions","Model","fromGltf","model","fromGltfAsync","debugModelMatrix","DebugModelMatrixPrimitive","modelMatrix","olMultiGeometryToCesium","accumulate","geometries","functor","subgeos","getPoints","getLineStrings","getPolygons","labels","LabelCollection","extentCenter","getFirstCoordinate","offsetX","getOffsetX","offsetY","getOffsetY","offset","font","getFont","labelStyle","LabelStyle","FILL","outlineWidth","OUTLINE","FILL_AND_OUTLINE","horizontalOrigin","getTextAlign","HorizontalOrigin","LEFT","RIGHT","CENTER","getTextBaseline","verticalOrigin","VerticalOrigin","TOP","BOTTOM","fill","stroke","getLineDash","fromType","horizontal","repeat","evenColor","oddColor","computePlainStyle","fallbackStyleFunction","featureStyleFunction","getGeometryFromFeature","opt_geom","geom3d","geomFuncRes","getGeometryFunction","olFeatureToCesium","geom","newBillboardAddedCallback","featureBb","getGeometries","prims","result2","olView","features","getFeatures","layerStyle","styles","MVT","Style","Stroke","toContext","VERSION","OL_VERSION","LRUCache","getForProjection","getTilegridForProjection","createFromTemplates","createTileUrlFunctions","format","ready","readyPromise","maximumLevel","tilingScheme","WebMercatorTilingScheme","errorEvent","Event","hasAlphaChannel","projection_","emptyCanvas_","tileRectangle_","cacheSize","featureCache","tileGrid","tileFunction_","getTileCredits","pickFeatures","getTileFeatures","cacheKey","getCacheKey_","promise","containsKey","getUrl_","fetch","r","ok","arrayBuffer","buffer","readFeaturesFromBuffer","set","getCount","highWaterMark","canExpireCache","pop","dataProjection","featureProjection","readFeatures","scaleFactor","f","flatCoordinates","getFlatCoordinates","flip","requestImage","request","tileXYToNativeRectangle","east","west","rasterizeFeatures","trace","raiseEvent","vectorContext","size","setStyle","drawGeometry","olcsSynchronizedOverlay","OverlaySynchronizer","overlays_","getOverlays","overlayContainerStopEvent_","className","parentElement","overlayContainer_","overlayMap_","getOverlayContainerStopEvent","addOverlays","addOverlayFromEvent_","removeOverlayFromEvent_","overlay","addOverlay","cesiumOverlay","parent","overlayId","removedOverlay","removeOverlay","csOverlay","olOverlay","removeNode","removeChildren","SynchronizedOverlay","getOptions","scenePostRenderListenerRemover_","synchronizer_","parent_","positionWGS84_","observer_","MutationObserver","handleElementChanged","attributeObserver_","listenerKeys_","setPropertyFromEvent","setPropertyFromEvent_","handleMapChanged","observeTarget_","disconnect","observe","childList","characterData","subtree","observer","childNodes","node","nodeType","getScene","updatePixelPosition","container","stopEvent","insertFirst","insertBefore","handlePositionChanged","sourceProjection","getMap","cloneNode","nodeName","drawImage","Node","TEXT_NODE","dispatchEvent","MouseEvent","nodes","getElement","parentNode","clonedNode","globeHeight","tilesLoaded","cartesian","ellipsoidBoundingSphere","occluder","Occluder","isPointVisible","cullingVolume","computeCullingVolume","computeVisibility","pixelCartesian","cartesianToCanvasCoordinates","mapSize","updateRenderedPosition","LazyLoader","url_","script","onload","onerror","head","olcsContribLazyLoader","olObservable","Manager","cesiumUrl","_temp","cameraExtentInRadians","cesiumIonDefaultAccessToken","cesiumUrl_","boundingSphere_","promise_","cesiumIonDefaultAccessToken_","cesiumInitialTilt_","fogDensity","fogSSEFactor","minimumZoomDistance","maximumZoomDistance","limitCameraToBoundingSphereRatio","cesiumLazyLoader","onCesiumLoaded","rect","DEFAULT_VIEW_RECTANGLE","fromRectangle3D","Ion","defaultAccessToken","instantiateOLCesium","configureForUsability","configureForPerformance","createWorldTerrain","terrainProvider","createWorldTerrainAsync","tp","fog","density","screenSpaceErrorFactor","sscController","depthTestAgainstTerrain","backgroundColor","toggle3d","is3DCurrentlyEnabled","set3dWithView","lon","lat","elevation","headingDeg","pitchDeg","is3dEnabled","getTiltOnGlobe","tiltOnGlobe","getOl3d","getCesiumViewMatrix","flyToRectangle","getRectangleCameraCoordinates","mag","multiplyByScalar","flyTo","endTransform","getCameraExtentRectangle","Tile","TileSource","olUseNewCoordinates","tileSource","wrapX","tileCoord","getTileCoordForTileUrlFunction","OLImageryProvider","opt_fallbackProj","source_","fallbackProj_","ready_","tilingScheme_","rectangle_","shouldRequestNextLevel","proxy","proxy_","DefaultProxy","errorEvent_","handleSourceChanged_","frameState","getState","numberOfLevelZeroTilesX","numberOfLevelZeroTilesY","forEachTileCoord","_ref","xIndex","yIndex","GeographicTilingScheme","level","calculateExtent","getSize","tileUrlFunction","getTileUrlFunction","z_","y_","call","getURL","ImageryProvider","loadImage","defineProperties","tg","getTileGrid","getTileSize","getMaxZoom","angleInRadians","angleInDegrees","param","supportsImageRenderingPixelatedResult_","imageRenderingValueResult_","setAttribute","tmp","observable","uidCounter_","olcs_uid","compareFnc","index","sort","removeChild","lastChild","isSupported","p","_","stopper","setInterval","clearInterval"],"sourceRoot":""}